ae5b41d13eb9a6e4ec2402e1a9b4f38e
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const axios_1 = tslib_1.__importDefault(require("axios"));
const toolkit_1 = require("@reduxjs/toolkit");
const sinon_1 = tslib_1.__importDefault(require("sinon"));
const produit_model_1 = require("app/shared/model/produit.model");
const produit_reducer_1 = tslib_1.__importStar(require("./produit.reducer"));
describe('Entities reducer tests', () => {
    function isEmpty(element) {
        if (element instanceof Array) {
            return element.length === 0;
        }
        else {
            return Object.keys(element).length === 0;
        }
    }
    const initialState = {
        loading: false,
        errorMessage: null,
        entities: [],
        entity: produit_model_1.defaultValue,
        totalItems: 0,
        updating: false,
        updateSuccess: false,
    };
    function testInitialState(state) {
        expect(state).toMatchObject({
            loading: false,
            errorMessage: null,
            updating: false,
            updateSuccess: false,
        });
        expect(isEmpty(state.entities));
        expect(isEmpty(state.entity));
    }
    function testMultipleTypes(types, payload, testFunction, error) {
        types.forEach(e => {
            testFunction((0, produit_reducer_1.default)(undefined, { type: e, payload, error }));
        });
    }
    describe('Common', () => {
        it('should return the initial state', () => {
            testInitialState((0, produit_reducer_1.default)(undefined, { type: '' }));
        });
    });
    describe('Requests', () => {
        it('should set state to loading', () => {
            testMultipleTypes([produit_reducer_1.getEntities.pending.type, produit_reducer_1.getEntity.pending.type], {}, state => {
                expect(state).toMatchObject({
                    errorMessage: null,
                    updateSuccess: false,
                    loading: true,
                });
            });
        });
        it('should set state to updating', () => {
            testMultipleTypes([produit_reducer_1.createEntity.pending.type, produit_reducer_1.updateEntity.pending.type, produit_reducer_1.partialUpdateEntity.pending.type, produit_reducer_1.deleteEntity.pending.type], {}, state => {
                expect(state).toMatchObject({
                    errorMessage: null,
                    updateSuccess: false,
                    updating: true,
                });
            });
        });
        it('should reset the state', () => {
            expect((0, produit_reducer_1.default)(Object.assign(Object.assign({}, initialState), { loading: true }), (0, produit_reducer_1.reset)())).toEqual(Object.assign({}, initialState));
        });
    });
    describe('Failures', () => {
        it('should set a message in errorMessage', () => {
            testMultipleTypes([
                produit_reducer_1.getEntities.rejected.type,
                produit_reducer_1.getEntity.rejected.type,
                produit_reducer_1.createEntity.rejected.type,
                produit_reducer_1.updateEntity.rejected.type,
                produit_reducer_1.partialUpdateEntity.rejected.type,
                produit_reducer_1.deleteEntity.rejected.type,
            ], 'some message', state => {
                expect(state).toMatchObject({
                    errorMessage: null,
                    updateSuccess: false,
                    updating: false,
                });
            }, {
                message: 'error message',
            });
        });
    });
    describe('Successes', () => {
        it('should fetch all entities', () => {
            const payload = { data: [{ 1: 'fake1' }, { 2: 'fake2' }], headers: { 'x-total-count': 123 } };
            expect((0, produit_reducer_1.default)(undefined, {
                type: produit_reducer_1.getEntities.fulfilled.type,
                payload,
            })).toEqual(Object.assign(Object.assign({}, initialState), { loading: false, totalItems: payload.headers['x-total-count'], entities: payload.data }));
        });
        it('should fetch a single entity', () => {
            const payload = { data: { 1: 'fake1' } };
            expect((0, produit_reducer_1.default)(undefined, {
                type: produit_reducer_1.getEntity.fulfilled.type,
                payload,
            })).toEqual(Object.assign(Object.assign({}, initialState), { loading: false, entity: payload.data }));
        });
        it('should create/update entity', () => {
            const payload = { data: 'fake payload' };
            expect((0, produit_reducer_1.default)(undefined, {
                type: produit_reducer_1.createEntity.fulfilled.type,
                payload,
            })).toEqual(Object.assign(Object.assign({}, initialState), { updating: false, updateSuccess: true, entity: payload.data }));
        });
        it('should delete entity', () => {
            const payload = 'fake payload';
            const toTest = (0, produit_reducer_1.default)(undefined, {
                type: produit_reducer_1.deleteEntity.fulfilled.type,
                payload,
            });
            expect(toTest).toMatchObject({
                updating: false,
                updateSuccess: true,
            });
        });
    });
    describe('Actions', () => {
        let store;
        const resolvedObject = { value: 'whatever' };
        const getState = jest.fn();
        const dispatch = jest.fn();
        const extra = {};
        beforeEach(() => {
            store = (0, toolkit_1.configureStore)({
                reducer: (state = [], action) => [...state, action],
            });
            axios_1.default.get = sinon_1.default.stub().returns(Promise.resolve(resolvedObject));
            axios_1.default.post = sinon_1.default.stub().returns(Promise.resolve(resolvedObject));
            axios_1.default.put = sinon_1.default.stub().returns(Promise.resolve(resolvedObject));
            axios_1.default.patch = sinon_1.default.stub().returns(Promise.resolve(resolvedObject));
            axios_1.default.delete = sinon_1.default.stub().returns(Promise.resolve(resolvedObject));
        });
        it('dispatches FETCH_PRODUIT_LIST actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const arg = {};
            const result = yield (0, produit_reducer_1.getEntities)(arg)(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(produit_reducer_1.getEntities.fulfilled.match(result)).toBe(true);
        }));
        it('dispatches FETCH_PRODUIT actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const arg = 42666;
            const result = yield (0, produit_reducer_1.getEntity)(arg)(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(produit_reducer_1.getEntity.fulfilled.match(result)).toBe(true);
        }));
        it('dispatches CREATE_PRODUIT actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const arg = { id: 456 };
            const result = yield (0, produit_reducer_1.createEntity)(arg)(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(produit_reducer_1.createEntity.fulfilled.match(result)).toBe(true);
        }));
        it('dispatches UPDATE_PRODUIT actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const arg = { id: 456 };
            const result = yield (0, produit_reducer_1.updateEntity)(arg)(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(produit_reducer_1.updateEntity.fulfilled.match(result)).toBe(true);
        }));
        it('dispatches PARTIAL_UPDATE_PRODUIT actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const arg = { id: 123 };
            const result = yield (0, produit_reducer_1.partialUpdateEntity)(arg)(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(produit_reducer_1.partialUpdateEntity.fulfilled.match(result)).toBe(true);
        }));
        it('dispatches DELETE_PRODUIT actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const arg = 42666;
            const result = yield (0, produit_reducer_1.deleteEntity)(arg)(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(produit_reducer_1.deleteEntity.fulfilled.match(result)).toBe(true);
        }));
        it('dispatches RESET actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            yield store.dispatch((0, produit_reducer_1.reset)());
            expect(store.getState()).toEqual([expect.any(Object), expect.objectContaining((0, produit_reducer_1.reset)())]);
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3BjY28wNTYvRG9jdW1lbnRzL0NvdXJzIElUVS9yaWJvdWNob24vbWFnaWN2ZW50ZXN0b2NrL3NyYy9tYWluL3dlYmFwcC9hcHAvZW50aXRpZXMvcHJvZHVpdC9wcm9kdWl0LXJlZHVjZXIuc3BlYy50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSwwREFBMEI7QUFFMUIsOENBQWtEO0FBQ2xELDBEQUEwQjtBQUcxQixrRUFBd0U7QUFDeEUsNkVBQTBJO0FBRTFJLFFBQVEsQ0FBQyx3QkFBd0IsRUFBRSxHQUFHLEVBQUU7SUFDdEMsU0FBUyxPQUFPLENBQUMsT0FBTztRQUN0QixJQUFJLE9BQU8sWUFBWSxLQUFLLEVBQUUsQ0FBQztZQUM3QixPQUFPLE9BQU8sQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDO1FBQzlCLENBQUM7YUFBTSxDQUFDO1lBQ04sT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUM7UUFDM0MsQ0FBQztJQUNILENBQUM7SUFFRCxNQUFNLFlBQVksR0FBMEI7UUFDMUMsT0FBTyxFQUFFLEtBQUs7UUFDZCxZQUFZLEVBQUUsSUFBSTtRQUNsQixRQUFRLEVBQUUsRUFBRTtRQUNaLE1BQU0sRUFBRSw0QkFBWTtRQUNwQixVQUFVLEVBQUUsQ0FBQztRQUNiLFFBQVEsRUFBRSxLQUFLO1FBQ2YsYUFBYSxFQUFFLEtBQUs7S0FDckIsQ0FBQztJQUVGLFNBQVMsZ0JBQWdCLENBQUMsS0FBSztRQUM3QixNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsYUFBYSxDQUFDO1lBQzFCLE9BQU8sRUFBRSxLQUFLO1lBQ2QsWUFBWSxFQUFFLElBQUk7WUFDbEIsUUFBUSxFQUFFLEtBQUs7WUFDZixhQUFhLEVBQUUsS0FBSztTQUNyQixDQUFDLENBQUM7UUFDSCxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQ2hDLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FB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QUMsQ0FBQyxDQUFDO1FBQzNGLENBQUMsQ0FBQSxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9wY2NvMDU2L0RvY3VtZW50cy9Db3VycyBJVFUvcmlib3VjaG9uL21hZ2ljdmVudGVzdG9jay9zcmMvbWFpbi93ZWJhcHAvYXBwL2VudGl0aWVzL3Byb2R1aXQvcHJvZHVpdC1yZWR1Y2VyLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcblxuaW1wb3J0IHsgY29uZmlndXJlU3RvcmUgfSBmcm9tICdAcmVkdXhqcy90b29sa2l0JztcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5cbmltcG9ydCB7IEVudGl0eVN0YXRlIH0gZnJvbSAnYXBwL3NoYXJlZC9yZWR1Y2Vycy9yZWR1Y2VyLnV0aWxzJztcbmltcG9ydCB7IElQcm9kdWl0LCBkZWZhdWx0VmFsdWUgfSBmcm9tICdhcHAvc2hhcmVkL21vZGVsL3Byb2R1aXQubW9kZWwnO1xuaW1wb3J0IHJlZHVjZXIsIHsgY3JlYXRlRW50aXR5LCBkZWxldGVFbnRpdHksIGdldEVudGl0aWVzLCBnZXRFbnRpdHksIHVwZGF0ZUVudGl0eSwgcGFydGlhbFVwZGF0ZUVudGl0eSwgcmVzZXQgfSBmcm9tICcuL3Byb2R1aXQucmVkdWNlcic7XG5cbmRlc2NyaWJlKCdFbnRpdGllcyByZWR1Y2VyIHRlc3RzJywgKCkgPT4ge1xuICBmdW5jdGlvbiBpc0VtcHR5KGVsZW1lbnQpOiBib29sZWFuIHtcbiAgICBpZiAoZWxlbWVudCBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICByZXR1cm4gZWxlbWVudC5sZW5ndGggPT09IDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBPYmplY3Qua2V5cyhlbGVtZW50KS5sZW5ndGggPT09IDA7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgaW5pdGlhbFN0YXRlOiBFbnRpdHlTdGF0ZTxJUHJvZHVpdD4gPSB7XG4gICAgbG9hZGluZzogZmFsc2UsXG4gICAgZXJyb3JNZXNzYWdlOiBudWxsLFxuICAgIGVudGl0aWVzOiBbXSxcbiAgICBlbnRpdHk6IGRlZmF1bHRWYWx1ZSxcbiAgICB0b3RhbEl0ZW1zOiAwLFxuICAgIHVwZGF0aW5nOiBmYWxzZSxcbiAgICB1cGRhdGVTdWNjZXNzOiBmYWxzZSxcbiAgfTtcblxuICBmdW5jdGlvbiB0ZXN0SW5pdGlhbFN0YXRlKHN0YXRlKSB7XG4gICAgZXhwZWN0KHN0YXRlKS50b01hdGNoT2JqZWN0KHtcbiAgICAgIGxvYWRpbmc6IGZhbHNlLFxuICAgICAgZXJyb3JNZXNzYWdlOiBudWxsLFxuICAgICAgdXBkYXRpbmc6IGZhbHNlLFxuICAgICAgdXBkYXRlU3VjY2VzczogZmFsc2UsXG4gICAgfSk7XG4gICAgZXhwZWN0KGlzRW1wdHkoc3RhdGUuZW50aXRpZXMpKTtcbiAgICBleHBlY3QoaXNFbXB0eShzdGF0ZS5lbnRpdHkpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHRlc3RNdWx0aXBsZVR5cGVzKHR5cGVzLCBwYXlsb2FkLCB0ZXN0RnVuY3Rpb24sIGVycm9yPykge1xuICAgIHR5cGVzLmZvckVhY2goZSA9PiB7XG4gICAgICB0ZXN0RnVuY3Rpb24ocmVkdWNlcih1bmRlZmluZWQsIHsgdHlwZTogZSwgcGF5bG9hZCwgZXJyb3IgfSkpO1xuICAgIH0pO1xuICB9XG5cbiAgZGVzY3JpYmUoJ0NvbW1vbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB0aGUgaW5pdGlhbCBzdGF0ZScsICgpID0+IHtcbiAgICAgIHRlc3RJbml0aWFsU3RhdGUocmVkdWNlcih1bmRlZmluZWQsIHsgdHlwZTogJycgfSkpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUmVxdWVzdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzZXQgc3RhdGUgdG8gbG9hZGluZycsICgpID0+IHtcbiAgICAgIHRlc3RNdWx0aXBsZVR5cGVzKFtnZXRFbnRpdGllcy5wZW5kaW5nLnR5cGUsIGdldEVudGl0eS5wZW5kaW5nLnR5cGVdLCB7fSwgc3RhdGUgPT4ge1xuICAgICAgICBleHBlY3Qoc3RhdGUpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICAgIGVycm9yTWVzc2FnZTogbnVsbCxcbiAgICAgICAgICB1cGRhdGVTdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBsb2FkaW5nOiB0cnVlLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzZXQgc3RhdGUgdG8gdXBkYXRpbmcnLCAoKSA9PiB7XG4gICAgICB0ZXN0TXVsdGlwbGVUeXBlcyhcbiAgICAgICAgW2NyZWF0ZUVudGl0eS5wZW5kaW5nLnR5cGUsIHVwZGF0ZUVudGl0eS5wZW5kaW5nLnR5cGUsIHBhcnRpYWxVcGRhdGVFbnRpdHkucGVuZGluZy50eXBlLCBkZWxldGVFbnRpdHkucGVuZGluZy50eXBlXSxcbiAgICAgICAge30sXG4gICAgICAgIHN0YXRlID0+IHtcbiAgICAgICAgICBleHBlY3Qoc3RhdGUpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICAgICAgZXJyb3JNZXNzYWdlOiBudWxsLFxuICAgICAgICAgICAgdXBkYXRlU3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICB1cGRhdGluZzogdHJ1ZSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlc2V0IHRoZSBzdGF0ZScsICgpID0+IHtcbiAgICAgIGV4cGVjdChyZWR1Y2VyKHsgLi4uaW5pdGlhbFN0YXRlLCBsb2FkaW5nOiB0cnVlIH0sIHJlc2V0KCkpKS50b0VxdWFsKHtcbiAgICAgICAgLi4uaW5pdGlhbFN0YXRlLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdGYWlsdXJlcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNldCBhIG1lc3NhZ2UgaW4gZXJyb3JNZXNzYWdlJywgKCkgPT4ge1xuICAgICAgdGVzdE11bHRpcGxlVHlwZXMoXG4gICAgICAgIFtcbiAgICAgICAgICBnZXRFbnRpdGllcy5yZWplY3RlZC50eXBlLFxuICAgICAgICAgIGdldEVudGl0eS5yZWplY3RlZC50eXBlLFxuICAgICAgICAgIGNyZWF0ZUVudGl0eS5yZWplY3RlZC50eXBlLFxuICAgICAgICAgIHVwZGF0ZUVudGl0eS5yZWplY3RlZC50eXBlLFxuICAgICAgICAgIHBhcnRpYWxVcGRhdGVFbnRpdHkucmVqZWN0ZWQudHlwZSxcbiAgICAgICAgICBkZWxldGVFbnRpdHkucmVqZWN0ZWQudHlwZSxcbiAgICAgICAgXSxcbiAgICAgICAgJ3NvbWUgbWVzc2FnZScsXG4gICAgICAgIHN0YXRlID0+IHtcbiAgICAgICAgICBleHBlY3Qoc3RhdGUpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICAgICAgZXJyb3JNZXNzYWdlOiBudWxsLFxuICAgICAgICAgICAgdXBkYXRlU3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICB1cGRhdGluZzogZmFsc2UsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBtZXNzYWdlOiAnZXJyb3IgbWVzc2FnZScsXG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU3VjY2Vzc2VzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZmV0Y2ggYWxsIGVudGl0aWVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGF5bG9hZCA9IHsgZGF0YTogW3sgMTogJ2Zha2UxJyB9LCB7IDI6ICdmYWtlMicgfV0sIGhlYWRlcnM6IHsgJ3gtdG90YWwtY291bnQnOiAxMjMgfSB9O1xuICAgICAgZXhwZWN0KFxuICAgICAgICByZWR1Y2VyKHVuZGVmaW5lZCwge1xuICAgICAgICAgIHR5cGU6IGdldEVudGl0aWVzLmZ1bGZpbGxlZC50eXBlLFxuICAgICAgICAgIHBheWxvYWQsXG4gICAgICAgIH0pLFxuICAgICAgKS50b0VxdWFsKHtcbiAgICAgICAgLi4uaW5pdGlhbFN0YXRlLFxuICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgdG90YWxJdGVtczogcGF5bG9hZC5oZWFkZXJzWyd4LXRvdGFsLWNvdW50J10sXG4gICAgICAgIGVudGl0aWVzOiBwYXlsb2FkLmRhdGEsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmV0Y2ggYSBzaW5nbGUgZW50aXR5JywgKCkgPT4ge1xuICAgICAgY29uc3QgcGF5bG9hZCA9IHsgZGF0YTogeyAxOiAnZmFrZTEnIH0gfTtcbiAgICAgIGV4cGVjdChcbiAgICAgICAgcmVkdWNlcih1bmRlZmluZWQsIHtcbiAgICAgICAgICB0eXBlOiBnZXRFbnRpdHkuZnVsZmlsbGVkLnR5cGUsXG4gICAgICAgICAgcGF5bG9hZCxcbiAgICAgICAgfSksXG4gICAgICApLnRvRXF1YWwoe1xuICAgICAgICAuLi5pbml0aWFsU3RhdGUsXG4gICAgICAgIGxvYWRpbmc6IGZhbHNlLFxuICAgICAgICBlbnRpdHk6IHBheWxvYWQuZGF0YSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUvdXBkYXRlIGVudGl0eScsICgpID0+IHtcbiAgICAgIGNvbnN0IHBheWxvYWQgPSB7IGRhdGE6ICdmYWtlIHBheWxvYWQnIH07XG4gICAgICBleHBlY3QoXG4gICAgICAgIHJlZHVjZXIodW5kZWZpbmVkLCB7XG4gICAgICAgICAgdHlwZTogY3JlYXRlRW50aXR5LmZ1bGZpbGxlZC50eXBlLFxuICAgICAgICAgIHBheWxvYWQsXG4gICAgICAgIH0pLFxuICAgICAgKS50b0VxdWFsKHtcbiAgICAgICAgLi4uaW5pdGlhbFN0YXRlLFxuICAgICAgICB1cGRhdGluZzogZmFsc2UsXG4gICAgICAgIHVwZGF0ZVN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGVudGl0eTogcGF5bG9hZC5kYXRhLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRlbGV0ZSBlbnRpdHknLCAoKSA9PiB7XG4gICAgICBjb25zdCBwYXlsb2FkID0gJ2Zha2UgcGF5bG9hZCc7XG4gICAgICBjb25zdCB0b1Rlc3QgPSByZWR1Y2VyKHVuZGVmaW5lZCwge1xuICAgICAgICB0eXBlOiBkZWxldGVFbnRpdHkuZnVsZmlsbGVkLnR5cGUsXG4gICAgICAgIHBheWxvYWQsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdCh0b1Rlc3QpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICB1cGRhdGluZzogZmFsc2UsXG4gICAgICAgIHVwZGF0ZVN1Y2Nlc3M6IHRydWUsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0FjdGlvbnMnLCAoKSA9PiB7XG4gICAgbGV0IHN0b3JlO1xuXG4gICAgY29uc3QgcmVzb2x2ZWRPYmplY3QgPSB7IHZhbHVlOiAnd2hhdGV2ZXInIH07XG4gICAgY29uc3QgZ2V0U3RhdGUgPSBqZXN0LmZuKCk7XG4gICAgY29uc3QgZGlzcGF0Y2ggPSBqZXN0LmZuKCk7XG4gICAgY29uc3QgZXh0cmEgPSB7fTtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIHN0b3JlID0gY29uZmlndXJlU3RvcmUoe1xuICAgICAgICByZWR1Y2VyOiAoc3RhdGUgPSBbXSwgYWN0aW9uKSA9PiBbLi4uc3RhdGUsIGFjdGlvbl0sXG4gICAgICB9KTtcbiAgICAgIGF4aW9zLmdldCA9IHNpbm9uLnN0dWIoKS5yZXR1cm5zKFByb21pc2UucmVzb2x2ZShyZXNvbHZlZE9iamVjdCkpO1xuICAgICAgYXhpb3MucG9zdCA9IHNpbm9uLnN0dWIoKS5yZXR1cm5zKFByb21pc2UucmVzb2x2ZShyZXNvbHZlZE9iamVjdCkpO1xuICAgICAgYXhpb3MucHV0ID0gc2lub24uc3R1YigpLnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKHJlc29sdmVkT2JqZWN0KSk7XG4gICAgICBheGlvcy5wYXRjaCA9IHNpbm9uLnN0dWIoKS5yZXR1cm5zKFByb21pc2UucmVzb2x2ZShyZXNvbHZlZE9iamVjdCkpO1xuICAgICAgYXhpb3MuZGVsZXRlID0gc2lub24uc3R1YigpLnJldHVybnMoUHJvbWlzZS5yZXNvbHZlKHJlc29sdmVkT2JqZWN0KSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGlzcGF0Y2hlcyBGRVRDSF9QUk9EVUlUX0xJU1QgYWN0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGFyZyA9IHt9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRFbnRpdGllcyhhcmcpKGRpc3BhdGNoLCBnZXRTdGF0ZSwgZXh0cmEpO1xuXG4gICAgICBjb25zdCBwZW5kaW5nQWN0aW9uID0gZGlzcGF0Y2gubW9jay5jYWxsc1swXVswXTtcbiAgICAgIGV4cGVjdChwZW5kaW5nQWN0aW9uLm1ldGEucmVxdWVzdFN0YXR1cykudG9CZSgncGVuZGluZycpO1xuICAgICAgZXhwZWN0KGdldEVudGl0aWVzLmZ1bGZpbGxlZC5tYXRjaChyZXN1bHQpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2Rpc3BhdGNoZXMgRkVUQ0hfUFJPRFVJVCBhY3Rpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYXJnID0gNDI2NjY7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldEVudGl0eShhcmcpKGRpc3BhdGNoLCBnZXRTdGF0ZSwgZXh0cmEpO1xuXG4gICAgICBjb25zdCBwZW5kaW5nQWN0aW9uID0gZGlzcGF0Y2gubW9jay5jYWxsc1swXVswXTtcbiAgICAgIGV4cGVjdChwZW5kaW5nQWN0aW9uLm1ldGEucmVxdWVzdFN0YXR1cykudG9CZSgncGVuZGluZycpO1xuICAgICAgZXhwZWN0KGdldEVudGl0eS5mdWxmaWxsZWQubWF0Y2gocmVzdWx0KSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkaXNwYXRjaGVzIENSRUFURV9QUk9EVUlUIGFjdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhcmcgPSB7IGlkOiA0NTYgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY3JlYXRlRW50aXR5KGFyZykoZGlzcGF0Y2gsIGdldFN0YXRlLCBleHRyYSk7XG5cbiAgICAgIGNvbnN0IHBlbmRpbmdBY3Rpb24gPSBkaXNwYXRjaC5tb2NrLmNhbGxzWzBdWzBdO1xuICAgICAgZXhwZWN0KHBlbmRpbmdBY3Rpb24ubWV0YS5yZXF1ZXN0U3RhdHVzKS50b0JlKCdwZW5kaW5nJyk7XG4gICAgICBleHBlY3QoY3JlYXRlRW50aXR5LmZ1bGZpbGxlZC5tYXRjaChyZXN1bHQpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2Rpc3BhdGNoZXMgVVBEQVRFX1BST0RVSVQgYWN0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGFyZyA9IHsgaWQ6IDQ1NiB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1cGRhdGVFbnRpdHkoYXJnKShkaXNwYXRjaCwgZ2V0U3RhdGUsIGV4dHJhKTtcblxuICAgICAgY29uc3QgcGVuZGluZ0FjdGlvbiA9IGRpc3BhdGNoLm1vY2suY2FsbHNbMF1bMF07XG4gICAgICBleHBlY3QocGVuZGluZ0FjdGlvbi5tZXRhLnJlcXVlc3RTdGF0dXMpLnRvQmUoJ3BlbmRpbmcnKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVFbnRpdHkuZnVsZmlsbGVkLm1hdGNoKHJlc3VsdCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGlzcGF0Y2hlcyBQQVJUSUFMX1VQREFURV9QUk9EVUlUIGFjdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhcmcgPSB7IGlkOiAxMjMgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGFydGlhbFVwZGF0ZUVudGl0eShhcmcpKGRpc3BhdGNoLCBnZXRTdGF0ZSwgZXh0cmEpO1xuXG4gICAgICBjb25zdCBwZW5kaW5nQWN0aW9uID0gZGlzcGF0Y2gubW9jay5jYWxsc1swXVswXTtcbiAgICAgIGV4cGVjdChwZW5kaW5nQWN0aW9uLm1ldGEucmVxdWVzdFN0YXR1cykudG9CZSgncGVuZGluZycpO1xuICAgICAgZXhwZWN0KHBhcnRpYWxVcGRhdGVFbnRpdHkuZnVsZmlsbGVkLm1hdGNoKHJlc3VsdCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGlzcGF0Y2hlcyBERUxFVEVfUFJPRFVJVCBhY3Rpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYXJnID0gNDI2NjY7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRlbGV0ZUVudGl0eShhcmcpKGRpc3BhdGNoLCBnZXRTdGF0ZSwgZXh0cmEpO1xuXG4gICAgICBjb25zdCBwZW5kaW5nQWN0aW9uID0gZGlzcGF0Y2gubW9jay5jYWxsc1swXVswXTtcbiAgICAgIGV4cGVjdChwZW5kaW5nQWN0aW9uLm1ldGEucmVxdWVzdFN0YXR1cykudG9CZSgncGVuZGluZycpO1xuICAgICAgZXhwZWN0KGRlbGV0ZUVudGl0eS5mdWxmaWxsZWQubWF0Y2gocmVzdWx0KSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkaXNwYXRjaGVzIFJFU0VUIGFjdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBzdG9yZS5kaXNwYXRjaChyZXNldCgpKTtcbiAgICAgIGV4cGVjdChzdG9yZS5nZXRTdGF0ZSgpKS50b0VxdWFsKFtleHBlY3QuYW55KE9iamVjdCksIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHJlc2V0KCkpXSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=