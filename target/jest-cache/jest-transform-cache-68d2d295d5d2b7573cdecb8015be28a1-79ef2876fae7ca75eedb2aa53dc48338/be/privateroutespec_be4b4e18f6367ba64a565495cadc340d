d4202ca79b2d05aea9ae206ff554f2e8
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const react_1 = tslib_1.__importDefault(require("react"));
const react_router_dom_1 = require("react-router-dom");
const react_2 = require("@testing-library/react");
const redux_mock_store_1 = tslib_1.__importDefault(require("redux-mock-store"));
const react_redux_1 = require("react-redux");
const constants_1 = require("app/config/constants");
const private_route_1 = tslib_1.__importStar(require("./private-route"));
const TestComp = () => react_1.default.createElement("div", null, "Test");
describe('private-route component', () => {
    const mockStore = (0, redux_mock_store_1.default)();
    const wrapper = (Elem, authentication) => {
        const store = mockStore({ authentication });
        return (0, react_2.render)(react_1.default.createElement(react_redux_1.Provider, { store: store },
            react_1.default.createElement(react_router_dom_1.MemoryRouter, null, Elem)));
    };
    // All tests will go here
    it('Should throw error when falsy children are provided', () => {
        const originalError = console.error;
        console.error = jest.fn();
        expect(() => wrapper(react_1.default.createElement(private_route_1.default, null, null), {
            isAuthenticated: true,
            sessionHasBeenFetched: true,
            account: {
                authorities: [],
            },
        })).toThrow(Error);
        console.error = originalError;
    });
    it('Should render an error message when the user has no authorities', () => {
        const { container } = wrapper(react_1.default.createElement(private_route_1.default, null,
            react_1.default.createElement(TestComp, null)), {
            isAuthenticated: true,
            sessionHasBeenFetched: true,
            account: {
                authorities: [],
            },
        });
        expect(container.innerHTML).toMatch(/<div class="insufficient-authority"><div class="alert alert-danger">.*<\/div><\/div>/);
    });
    it('Should render a route for the component provided when authenticated', () => {
        const { container } = wrapper(react_1.default.createElement(private_route_1.default, null,
            react_1.default.createElement(TestComp, null)), {
            isAuthenticated: true,
            sessionHasBeenFetched: true,
            account: {
                authorities: ['ADMIN'],
            },
        });
        expect(container.innerHTML).toEqual('<div>Test</div>');
    });
    it('Should redirect when not authenticated', () => {
        const { container } = wrapper(react_1.default.createElement(react_router_dom_1.Routes, null,
            react_1.default.createElement(react_router_dom_1.Route, { path: "/", element: react_1.default.createElement(private_route_1.default, null,
                    react_1.default.createElement(TestComp, null)) }),
            react_1.default.createElement(react_router_dom_1.Route, { path: "/login", element: react_1.default.createElement("div", null, "Login") })), {
            isAuthenticated: false,
            sessionHasBeenFetched: true,
            account: {
                authorities: ['ADMIN'],
            },
        });
        expect(container.innerHTML).not.toEqual('<div>Test</div>');
        expect(container.innerHTML).toEqual('<div>Login</div>');
    });
});
describe('hasAnyAuthority', () => {
    // All tests will go here
    it('Should return false when authorities is invalid', () => {
        expect((0, private_route_1.hasAnyAuthority)(undefined, undefined)).toEqual(false);
        expect((0, private_route_1.hasAnyAuthority)(null, [])).toEqual(false);
        expect((0, private_route_1.hasAnyAuthority)([], [])).toEqual(false);
        expect((0, private_route_1.hasAnyAuthority)([], [constants_1.AUTHORITIES.USER])).toEqual(false);
    });
    it('Should return true when authorities is valid and hasAnyAuthorities is empty', () => {
        expect((0, private_route_1.hasAnyAuthority)([constants_1.AUTHORITIES.USER], [])).toEqual(true);
    });
    it('Should return true when authorities is valid and hasAnyAuthorities contains an authority', () => {
        expect((0, private_route_1.hasAnyAuthority)([constants_1.AUTHORITIES.USER], [constants_1.AUTHORITIES.USER])).toEqual(true);
        expect((0, private_route_1.hasAnyAuthority)([constants_1.AUTHORITIES.USER, constants_1.AUTHORITIES.ADMIN], [constants_1.AUTHORITIES.USER])).toEqual(true);
        expect((0, private_route_1.hasAnyAuthority)([constants_1.AUTHORITIES.USER, constants_1.AUTHORITIES.ADMIN], [constants_1.AUTHORITIES.USER, constants_1.AUTHORITIES.ADMIN])).toEqual(true);
        expect((0, private_route_1.hasAnyAuthority)([constants_1.AUTHORITIES.USER, constants_1.AUTHORITIES.ADMIN], [constants_1.AUTHORITIES.USER, 'ROLEADMIN'])).toEqual(true);
        expect((0, private_route_1.hasAnyAuthority)([constants_1.AUTHORITIES.USER, constants_1.AUTHORITIES.ADMIN], [constants_1.AUTHORITIES.ADMIN])).toEqual(true);
    });
    it('Should return false when authorities is valid and hasAnyAuthorities does not contain an authority', () => {
        expect((0, private_route_1.hasAnyAuthority)([constants_1.AUTHORITIES.USER], [constants_1.AUTHORITIES.ADMIN])).toEqual(false);
        expect((0, private_route_1.hasAnyAuthority)([constants_1.AUTHORITIES.USER, constants_1.AUTHORITIES.ADMIN], ['ROLE_USERSS'])).toEqual(false);
        expect((0, private_route_1.hasAnyAuthority)([constants_1.AUTHORITIES.USER, constants_1.AUTHORITIES.ADMIN], ['ROLEUSER', 'ROLEADMIN'])).toEqual(false);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3BjY28wNTYvRG9jdW1lbnRzL0NvdXJzIElUVS9yaWJvdWNob24vbWFnaWN2ZW50ZXN0b2NrL3NyYy9tYWluL3dlYmFwcC9hcHAvc2hhcmVkL2F1dGgvcHJpdmF0ZS1yb3V0ZS5zcGVjLnRzeCIsIm1hcHBpbmdzIjoiOzs7QUFBQSwwREFBMEI7QUFDMUIsdURBQStEO0FBQy9ELGtEQUFnRDtBQUNoRCxnRkFBOEM7QUFDOUMsNkNBQXVDO0FBRXZDLG9EQUFtRDtBQUNuRCx5RUFBZ0U7QUFFaEUsTUFBTSxRQUFRLEdBQUcsR0FBRyxFQUFFLENBQUMsa0RBQWUsQ0FBQztBQUV2QyxRQUFRLENBQUMseUJBQXlCLEVBQUUsR0FBRyxFQUFFO0lBQ3ZDLE1BQU0sU0FBUyxHQUFHLElBQUEsMEJBQWMsR0FBRSxDQUFDO0lBQ25DLE1BQU0sT0FBTyxHQUFHLENBQUMsSUFBaUIsRUFBRSxjQUFjLEVBQUUsRUFBRTtRQUNwRCxNQUFNLEtBQUssR0FBRyxTQUFTLENBQUMsRUFBRSxjQUFjLEVBQUUsQ0FBQyxDQUFDO1FBQzVDLE9BQU8sSUFBQSxjQUFNLEVBQ1gsOEJBQUMsc0JBQVEsSUFBQyxLQUFLLEVBQUUsS0FBSztZQUNwQiw4QkFBQywrQkFBWSxRQUFFLElBQUksQ0FBZ0IsQ0FDMUIsQ0FDWixDQUFDO0lBQ0osQ0FBQyxDQUFDO0lBRUYseUJBQXlCO0lBQ3pCLEVBQUUsQ0FBQyxxREFBcUQsRUFBRSxHQUFHLEVBQUU7UUFDN0QsTUFBTSxhQUFhLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQztRQUNwQyxPQUFPLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUMxQixNQUFNLENBQUMsR0FBRyxFQUFFLENBQ1YsT0FBTyxDQUFDLDhCQUFDLHVCQUFZLFFBQUUsSUFBSSxDQUFnQixFQUFFO1lBQzNDLGVBQWUsRUFBRSxJQUFJO1lBQ3JCLHFCQUFxQixFQUFFLElBQUk7WUFDM0IsT0FBTyxFQUFFO2dCQUNQLFdBQVcsRUFBRSxFQUFFO2FBQ2hCO1NBQ0YsQ0FB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QyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDcEcsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsbUdBQW1HLEVBQUUsR0FBRyxFQUFFO1FBQzNHLE1BQU0sQ0FBQyxJQUFBLCtCQUFlLEVBQUMsQ0FBQyx1QkFBVyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsdUJBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hGLE1BQU0sQ0FBQyxJQUFBLCtCQUFlLEVBQUMsQ0FBQyx1QkFBVyxDQUFDLElBQUksRUFBRSx1QkFBVyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMvRixNQUFNLENBQUMsSUFBQSwrQkFBZSxFQUFDLENBQUMsdUJBQVcsQ0FBQyxJQUFJLEVBQUUsdUJBQVcsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzNHLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL3BjY28wNTYvRG9jdW1lbnRzL0NvdXJzIElUVS9yaWJvdWNob24vbWFnaWN2ZW50ZXN0b2NrL3NyYy9tYWluL3dlYmFwcC9hcHAvc2hhcmVkL2F1dGgvcHJpdmF0ZS1yb3V0ZS5zcGVjLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgTWVtb3J5Um91dGVyLCBSb3V0ZSwgUm91dGVzIH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSc7XG5pbXBvcnQgeyByZW5kZXIgfSBmcm9tICdAdGVzdGluZy1saWJyYXJ5L3JlYWN0JztcbmltcG9ydCBjb25maWd1cmVTdG9yZSBmcm9tICdyZWR1eC1tb2NrLXN0b3JlJztcbmltcG9ydCB7IFByb3ZpZGVyIH0gZnJvbSAncmVhY3QtcmVkdXgnO1xuXG5pbXBvcnQgeyBBVVRIT1JJVElFUyB9IGZyb20gJ2FwcC9jb25maWcvY29uc3RhbnRzJztcbmltcG9ydCBQcml2YXRlUm91dGUsIHsgaGFzQW55QXV0aG9yaXR5IH0gZnJvbSAnLi9wcml2YXRlLXJvdXRlJztcblxuY29uc3QgVGVzdENvbXAgPSAoKSA9PiA8ZGl2PlRlc3Q8L2Rpdj47XG5cbmRlc2NyaWJlKCdwcml2YXRlLXJvdXRlIGNvbXBvbmVudCcsICgpID0+IHtcbiAgY29uc3QgbW9ja1N0b3JlID0gY29uZmlndXJlU3RvcmUoKTtcbiAgY29uc3Qgd3JhcHBlciA9IChFbGVtOiBKU1guRWxlbWVudCwgYXV0aGVudGljYXRpb24pID0+IHtcbiAgICBjb25zdCBzdG9yZSA9IG1vY2tTdG9yZSh7IGF1dGhlbnRpY2F0aW9uIH0pO1xuICAgIHJldHVybiByZW5kZXIoXG4gICAgICA8UHJvdmlkZXIgc3RvcmU9e3N0b3JlfT5cbiAgICAgICAgPE1lbW9yeVJvdXRlcj57RWxlbX08L01lbW9yeVJvdXRlcj5cbiAgICAgIDwvUHJvdmlkZXI+LFxuICAgICk7XG4gIH07XG5cbiAgLy8gQWxsIHRlc3RzIHdpbGwgZ28gaGVyZVxuICBpdCgnU2hvdWxkIHRocm93IGVycm9yIHdoZW4gZmFsc3kgY2hpbGRyZW4gYXJlIHByb3ZpZGVkJywgKCkgPT4ge1xuICAgIGNvbnN0IG9yaWdpbmFsRXJyb3IgPSBjb25zb2xlLmVycm9yO1xuICAgIGNvbnNvbGUuZXJyb3IgPSBqZXN0LmZuKCk7XG4gICAgZXhwZWN0KCgpID0+XG4gICAgICB3cmFwcGVyKDxQcml2YXRlUm91dGU+e251bGx9PC9Qcml2YXRlUm91dGU+LCB7XG4gICAgICAgIGlzQXV0aGVudGljYXRlZDogdHJ1ZSxcbiAgICAgICAgc2Vzc2lvbkhhc0JlZW5GZXRjaGVkOiB0cnVlLFxuICAgICAgICBhY2NvdW50OiB7XG4gICAgICAgICAgYXV0aG9yaXRpZXM6IFtdLFxuICAgICAgICB9LFxuICAgICAgfSksXG4gICAgKS50b1Rocm93KEVycm9yKTtcbiAgICBjb25zb2xlLmVycm9yID0gb3JpZ2luYWxFcnJvcjtcbiAgfSk7XG5cbiAgaXQoJ1Nob3VsZCByZW5kZXIgYW4gZXJyb3IgbWVzc2FnZSB3aGVuIHRoZSB1c2VyIGhhcyBubyBhdXRob3JpdGllcycsICgpID0+IHtcbiAgICBjb25zdCB7IGNvbnRhaW5lciB9ID0gd3JhcHBlcihcbiAgICAgIDxQcml2YXRlUm91dGU+XG4gICAgICAgIDxUZXN0Q29tcCAvPlxuICAgICAgPC9Qcml2YXRlUm91dGU+LFxuICAgICAge1xuICAgICAgICBpc0F1dGhlbnRpY2F0ZWQ6IHRydWUsXG4gICAgICAgIHNlc3Npb25IYXNCZWVuRmV0Y2hlZDogdHJ1ZSxcbiAgICAgICAgYWNjb3VudDoge1xuICAgICAgICAgIGF1dGhvcml0aWVzOiBbXSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgKTtcbiAgICBleHBlY3QoY29udGFpbmVyLmlubmVySFRNTCkudG9NYXRjaCgvPGRpdiBjbGFzcz1cImluc3VmZmljaWVudC1hdXRob3JpdHlcIj48ZGl2IGNsYXNzPVwiYWxlcnQgYWxlcnQtZGFuZ2VyXCI+Lio8XFwvZGl2PjxcXC9kaXY+Lyk7XG4gIH0pO1xuXG4gIGl0KCdTaG91bGQgcmVuZGVyIGEgcm91dGUgZm9yIHRoZSBjb21wb25lbnQgcHJvdmlkZWQgd2hlbiBhdXRoZW50aWNhdGVkJywgKCkgPT4ge1xuICAgIGNvbnN0IHsgY29udGFpbmVyIH0gPSB3cmFwcGVyKFxuICAgICAgPFByaXZhdGVSb3V0ZT5cbiAgICAgICAgPFRlc3RDb21wIC8+XG4gICAgICA8L1ByaXZhdGVSb3V0ZT4sXG4gICAgICB7XG4gICAgICAgIGlzQXV0aGVudGljYXRlZDogdHJ1ZSxcbiAgICAgICAgc2Vzc2lvbkhhc0JlZW5GZXRjaGVkOiB0cnVlLFxuICAgICAgICBhY2NvdW50OiB7XG4gICAgICAgICAgYXV0aG9yaXRpZXM6IFsnQURNSU4nXSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgKTtcbiAgICBleHBlY3QoY29udGFpbmVyLmlubmVySFRNTCkudG9FcXVhbCgnPGRpdj5UZXN0PC9kaXY+Jyk7XG4gIH0pO1xuXG4gIGl0KCdTaG91bGQgcmVkaXJlY3Qgd2hlbiBub3QgYXV0aGVudGljYXRlZCcsICgpID0+IHtcbiAgICBjb25zdCB7IGNvbnRhaW5lciB9ID0gd3JhcHBlcihcbiAgICAgIDxSb3V0ZXM+XG4gICAgICAgIDxSb3V0ZVxuICAgICAgICAgIHBhdGg9XCIvXCJcbiAgICAgICAgICBlbGVtZW50PXtcbiAgICAgICAgICAgIDxQcml2YXRlUm91dGU+XG4gICAgICAgICAgICAgIDxUZXN0Q29tcCAvPlxuICAgICAgICAgICAgPC9Qcml2YXRlUm91dGU+XG4gICAgICAgICAgfVxuICAgICAgICAvPlxuICAgICAgICA8Um91dGUgcGF0aD1cIi9sb2dpblwiIGVsZW1lbnQ9ezxkaXY+TG9naW48L2Rpdj59IC8+XG4gICAgICA8L1JvdXRlcz4sXG4gICAgICB7XG4gICAgICAgIGlzQXV0aGVudGljYXRlZDogZmFsc2UsXG4gICAgICAgIHNlc3Npb25IYXNCZWVuRmV0Y2hlZDogdHJ1ZSxcbiAgICAgICAgYWNjb3VudDoge1xuICAgICAgICAgIGF1dGhvcml0aWVzOiBbJ0FETUlOJ10sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICk7XG4gICAgZXhwZWN0KGNvbnRhaW5lci5pbm5lckhUTUwpLm5vdC50b0VxdWFsKCc8ZGl2PlRlc3Q8L2Rpdj4nKTtcbiAgICBleHBlY3QoY29udGFpbmVyLmlubmVySFRNTCkudG9FcXVhbCgnPGRpdj5Mb2dpbjwvZGl2PicpO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnaGFzQW55QXV0aG9yaXR5JywgKCkgPT4ge1xuICAvLyBBbGwgdGVzdHMgd2lsbCBnbyBoZXJlXG4gIGl0KCdTaG91bGQgcmV0dXJuIGZhbHNlIHdoZW4gYXV0aG9yaXRpZXMgaXMgaW52YWxpZCcsICgpID0+IHtcbiAgICBleHBlY3QoaGFzQW55QXV0aG9yaXR5KHVuZGVmaW5lZCwgdW5kZWZpbmVkKSkudG9FcXVhbChmYWxzZSk7XG4gICAgZXhwZWN0KGhhc0FueUF1dGhvcml0eShudWxsLCBbXSkpLnRvRXF1YWwoZmFsc2UpO1xuICAgIGV4cGVjdChoYXNBbnlBdXRob3JpdHkoW10sIFtdKSkudG9FcXVhbChmYWxzZSk7XG4gICAgZXhwZWN0KGhhc0FueUF1dGhvcml0eShbXSwgW0FVVEhPUklUSUVTLlVTRVJdKSkudG9FcXVhbChmYWxzZSk7XG4gIH0pO1xuXG4gIGl0KCdTaG91bGQgcmV0dXJuIHRydWUgd2hlbiBhdXRob3JpdGllcyBpcyB2YWxpZCBhbmQgaGFzQW55QXV0aG9yaXRpZXMgaXMgZW1wdHknLCAoKSA9PiB7XG4gICAgZXhwZWN0KGhhc0FueUF1dGhvcml0eShbQVVUSE9SSVRJRVMuVVNFUl0sIFtdKSkudG9FcXVhbCh0cnVlKTtcbiAgfSk7XG5cbiAgaXQoJ1Nob3VsZCByZXR1cm4gdHJ1ZSB3aGVuIGF1dGhvcml0aWVzIGlzIHZhbGlkIGFuZCBoYXNBbnlBdXRob3JpdGllcyBjb250YWlucyBhbiBhdXRob3JpdHknLCAoKSA9PiB7XG4gICAgZXhwZWN0KGhhc0FueUF1dGhvcml0eShbQVVUSE9SSVRJRVMuVVNFUl0sIFtBVVRIT1JJVElFUy5VU0VSXSkpLnRvRXF1YWwodHJ1ZSk7XG4gICAgZXhwZWN0KGhhc0FueUF1dGhvcml0eShbQVVUSE9SSVRJRVMuVVNFUiwgQVVUSE9SSVRJRVMuQURNSU5dLCBbQVVUSE9SSVRJRVMuVVNFUl0pKS50b0VxdWFsKHRydWUpO1xuICAgIGV4cGVjdChoYXNBbnlBdXRob3JpdHkoW0FVVEhPUklUSUVTLlVTRVIsIEFVVEhPUklUSUVTLkFETUlOXSwgW0FVVEhPUklUSUVTLlVTRVIsIEFVVEhPUklUSUVTLkFETUlOXSkpLnRvRXF1YWwodHJ1ZSk7XG4gICAgZXhwZWN0KGhhc0FueUF1dGhvcml0eShbQVVUSE9SSVRJRVMuVVNFUiwgQVVUSE9SSVRJRVMuQURNSU5dLCBbQVVUSE9SSVRJRVMuVVNFUiwgJ1JPTEVBRE1JTiddKSkudG9FcXVhbCh0cnVlKTtcbiAgICBleHBlY3QoaGFzQW55QXV0aG9yaXR5KFtBVVRIT1JJVElFUy5VU0VSLCBBVVRIT1JJVElFUy5BRE1JTl0sIFtBVVRIT1JJVElFUy5BRE1JTl0pKS50b0VxdWFsKHRydWUpO1xuICB9KTtcblxuICBpdCgnU2hvdWxkIHJldHVybiBmYWxzZSB3aGVuIGF1dGhvcml0aWVzIGlzIHZhbGlkIGFuZCBoYXNBbnlBdXRob3JpdGllcyBkb2VzIG5vdCBjb250YWluIGFuIGF1dGhvcml0eScsICgpID0+IHtcbiAgICBleHBlY3QoaGFzQW55QXV0aG9yaXR5KFtBVVRIT1JJVElFUy5VU0VSXSwgW0FVVEhPUklUSUVTLkFETUlOXSkpLnRvRXF1YWwoZmFsc2UpO1xuICAgIGV4cGVjdChoYXNBbnlBdXRob3JpdHkoW0FVVEhPUklUSUVTLlVTRVIsIEFVVEhPUklUSUVTLkFETUlOXSwgWydST0xFX1VTRVJTUyddKSkudG9FcXVhbChmYWxzZSk7XG4gICAgZXhwZWN0KGhhc0FueUF1dGhvcml0eShbQVVUSE9SSVRJRVMuVVNFUiwgQVVUSE9SSVRJRVMuQURNSU5dLCBbJ1JPTEVVU0VSJywgJ1JPTEVBRE1JTiddKSkudG9FcXVhbChmYWxzZSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=