77b378678219626cdd77b4209369da9d
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const axios_1 = tslib_1.__importDefault(require("axios"));
const toolkit_1 = require("@reduxjs/toolkit");
const sinon_1 = tslib_1.__importDefault(require("sinon"));
const produit_jour_model_1 = require("app/shared/model/produit-jour.model");
const produit_jour_reducer_1 = tslib_1.__importStar(require("./produit-jour.reducer"));
describe('Entities reducer tests', () => {
    function isEmpty(element) {
        if (element instanceof Array) {
            return element.length === 0;
        }
        else {
            return Object.keys(element).length === 0;
        }
    }
    const initialState = {
        loading: false,
        errorMessage: null,
        entities: [],
        entity: produit_jour_model_1.defaultValue,
        totalItems: 0,
        updating: false,
        updateSuccess: false,
    };
    function testInitialState(state) {
        expect(state).toMatchObject({
            loading: false,
            errorMessage: null,
            updating: false,
            updateSuccess: false,
        });
        expect(isEmpty(state.entities));
        expect(isEmpty(state.entity));
    }
    function testMultipleTypes(types, payload, testFunction, error) {
        types.forEach(e => {
            testFunction((0, produit_jour_reducer_1.default)(undefined, { type: e, payload, error }));
        });
    }
    describe('Common', () => {
        it('should return the initial state', () => {
            testInitialState((0, produit_jour_reducer_1.default)(undefined, { type: '' }));
        });
    });
    describe('Requests', () => {
        it('should set state to loading', () => {
            testMultipleTypes([produit_jour_reducer_1.getEntities.pending.type, produit_jour_reducer_1.getEntity.pending.type], {}, state => {
                expect(state).toMatchObject({
                    errorMessage: null,
                    updateSuccess: false,
                    loading: true,
                });
            });
        });
        it('should set state to updating', () => {
            testMultipleTypes([produit_jour_reducer_1.createEntity.pending.type, produit_jour_reducer_1.updateEntity.pending.type, produit_jour_reducer_1.partialUpdateEntity.pending.type, produit_jour_reducer_1.deleteEntity.pending.type], {}, state => {
                expect(state).toMatchObject({
                    errorMessage: null,
                    updateSuccess: false,
                    updating: true,
                });
            });
        });
        it('should reset the state', () => {
            expect((0, produit_jour_reducer_1.default)(Object.assign(Object.assign({}, initialState), { loading: true }), (0, produit_jour_reducer_1.reset)())).toEqual(Object.assign({}, initialState));
        });
    });
    describe('Failures', () => {
        it('should set a message in errorMessage', () => {
            testMultipleTypes([
                produit_jour_reducer_1.getEntities.rejected.type,
                produit_jour_reducer_1.getEntity.rejected.type,
                produit_jour_reducer_1.createEntity.rejected.type,
                produit_jour_reducer_1.updateEntity.rejected.type,
                produit_jour_reducer_1.partialUpdateEntity.rejected.type,
                produit_jour_reducer_1.deleteEntity.rejected.type,
            ], 'some message', state => {
                expect(state).toMatchObject({
                    errorMessage: null,
                    updateSuccess: false,
                    updating: false,
                });
            }, {
                message: 'error message',
            });
        });
    });
    describe('Successes', () => {
        it('should fetch all entities', () => {
            const payload = { data: [{ 1: 'fake1' }, { 2: 'fake2' }], headers: { 'x-total-count': 123 } };
            expect((0, produit_jour_reducer_1.default)(undefined, {
                type: produit_jour_reducer_1.getEntities.fulfilled.type,
                payload,
            })).toEqual(Object.assign(Object.assign({}, initialState), { loading: false, totalItems: payload.headers['x-total-count'], entities: payload.data }));
        });
        it('should fetch a single entity', () => {
            const payload = { data: { 1: 'fake1' } };
            expect((0, produit_jour_reducer_1.default)(undefined, {
                type: produit_jour_reducer_1.getEntity.fulfilled.type,
                payload,
            })).toEqual(Object.assign(Object.assign({}, initialState), { loading: false, entity: payload.data }));
        });
        it('should create/update entity', () => {
            const payload = { data: 'fake payload' };
            expect((0, produit_jour_reducer_1.default)(undefined, {
                type: produit_jour_reducer_1.createEntity.fulfilled.type,
                payload,
            })).toEqual(Object.assign(Object.assign({}, initialState), { updating: false, updateSuccess: true, entity: payload.data }));
        });
        it('should delete entity', () => {
            const payload = 'fake payload';
            const toTest = (0, produit_jour_reducer_1.default)(undefined, {
                type: produit_jour_reducer_1.deleteEntity.fulfilled.type,
                payload,
            });
            expect(toTest).toMatchObject({
                updating: false,
                updateSuccess: true,
            });
        });
    });
    describe('Actions', () => {
        let store;
        const resolvedObject = { value: 'whatever' };
        const getState = jest.fn();
        const dispatch = jest.fn();
        const extra = {};
        beforeEach(() => {
            store = (0, toolkit_1.configureStore)({
                reducer: (state = [], action) => [...state, action],
            });
            axios_1.default.get = sinon_1.default.stub().returns(Promise.resolve(resolvedObject));
            axios_1.default.post = sinon_1.default.stub().returns(Promise.resolve(resolvedObject));
            axios_1.default.put = sinon_1.default.stub().returns(Promise.resolve(resolvedObject));
            axios_1.default.patch = sinon_1.default.stub().returns(Promise.resolve(resolvedObject));
            axios_1.default.delete = sinon_1.default.stub().returns(Promise.resolve(resolvedObject));
        });
        it('dispatches FETCH_PRODUITJOUR_LIST actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const arg = {};
            const result = yield (0, produit_jour_reducer_1.getEntities)(arg)(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(produit_jour_reducer_1.getEntities.fulfilled.match(result)).toBe(true);
        }));
        it('dispatches FETCH_PRODUITJOUR actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const arg = 42666;
            const result = yield (0, produit_jour_reducer_1.getEntity)(arg)(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(produit_jour_reducer_1.getEntity.fulfilled.match(result)).toBe(true);
        }));
        it('dispatches CREATE_PRODUITJOUR actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const arg = { id: 456 };
            const result = yield (0, produit_jour_reducer_1.createEntity)(arg)(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(produit_jour_reducer_1.createEntity.fulfilled.match(result)).toBe(true);
        }));
        it('dispatches UPDATE_PRODUITJOUR actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const arg = { id: 456 };
            const result = yield (0, produit_jour_reducer_1.updateEntity)(arg)(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(produit_jour_reducer_1.updateEntity.fulfilled.match(result)).toBe(true);
        }));
        it('dispatches PARTIAL_UPDATE_PRODUITJOUR actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const arg = { id: 123 };
            const result = yield (0, produit_jour_reducer_1.partialUpdateEntity)(arg)(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(produit_jour_reducer_1.partialUpdateEntity.fulfilled.match(result)).toBe(true);
        }));
        it('dispatches DELETE_PRODUITJOUR actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const arg = 42666;
            const result = yield (0, produit_jour_reducer_1.deleteEntity)(arg)(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(produit_jour_reducer_1.deleteEntity.fulfilled.match(result)).toBe(true);
        }));
        it('dispatches RESET actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            yield store.dispatch((0, produit_jour_reducer_1.reset)());
            expect(store.getState()).toEqual([expect.any(Object), expect.objectContaining((0, produit_jour_reducer_1.reset)())]);
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3BjY28wNTYvRG9jdW1lbnRzL0NvdXJzIElUVS9yaWJvdWNob24vbWFnaWN2ZW50ZXN0b2NrL3NyYy9tYWluL3dlYmFwcC9hcHAvZW50aXRpZXMvcHJvZHVpdC1qb3VyL3Byb2R1aXQtam91ci1yZWR1Y2VyLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsMERBQTBCO0FBRTFCLDhDQUFrRDtBQUNsRCwwREFBMEI7QUFHMUIsNEVBQWlGO0FBQ2pGLHVGQVFnQztBQUVoQyxRQUFRLENBQUMsd0JBQXdCLEVBQUUsR0FBRyxFQUFFO0lBQ3RDLFNBQVMsT0FBTyxDQUFDLE9BQU87UUFDdEIsSUFBSSxPQUFPLFlBQVksS0FBSyxFQUFFLENBQUM7WUFDN0IsT0FBTyxPQUFPLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztRQUM5QixDQUFDO2FBQU0sQ0FBQztZQUNOLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDO1FBQzNDLENBQUM7SUFDSCxDQUFDO0lBRUQsTUFBTSxZQUFZLEdBQThCO1FBQzlDLE9BQU8sRUFBRSxLQUFLO1FBQ2QsWUFBWSxFQUFFLElBQUk7UUFDbEIsUUFBUSxFQUFFLEVBQUU7UUFDWixNQUFNLEVBQUUsaUNBQVk7UUFDcEIsVUFBVSxFQUFFLENBQUM7UUFDYixRQUFRLEVBQUUsS0FBSztRQUNmLGFBQWEsRUFBRSxLQUFLO0tBQ3JCLENBQUM7SUFFRixTQUFTLGdCQUFnQixDQUFDLEtBQUs7UUFDN0IsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLGFBQWEsQ0FBQztZQUMxQixPQUFPLEVBQUUsS0FBSztZQUNkLFlBQVksRUFBRSxJQUFJO1lBQ2xCLFFBQVEsRUFBRSxLQUFLO1lBQ2YsYUFBYSxFQUFFLEtBQUs7U0FDckIsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUNoQyxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FB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QUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzRixDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvcGNjbzA1Ni9Eb2N1bWVudHMvQ291cnMgSVRVL3JpYm91Y2hvbi9tYWdpY3ZlbnRlc3RvY2svc3JjL21haW4vd2ViYXBwL2FwcC9lbnRpdGllcy9wcm9kdWl0LWpvdXIvcHJvZHVpdC1qb3VyLXJlZHVjZXIuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuXG5pbXBvcnQgeyBjb25maWd1cmVTdG9yZSB9IGZyb20gJ0ByZWR1eGpzL3Rvb2xraXQnO1xuaW1wb3J0IHNpbm9uIGZyb20gJ3Npbm9uJztcblxuaW1wb3J0IHsgRW50aXR5U3RhdGUgfSBmcm9tICdhcHAvc2hhcmVkL3JlZHVjZXJzL3JlZHVjZXIudXRpbHMnO1xuaW1wb3J0IHsgSVByb2R1aXRKb3VyLCBkZWZhdWx0VmFsdWUgfSBmcm9tICdhcHAvc2hhcmVkL21vZGVsL3Byb2R1aXQtam91ci5tb2RlbCc7XG5pbXBvcnQgcmVkdWNlciwge1xuICBjcmVhdGVFbnRpdHksXG4gIGRlbGV0ZUVudGl0eSxcbiAgZ2V0RW50aXRpZXMsXG4gIGdldEVudGl0eSxcbiAgdXBkYXRlRW50aXR5LFxuICBwYXJ0aWFsVXBkYXRlRW50aXR5LFxuICByZXNldCxcbn0gZnJvbSAnLi9wcm9kdWl0LWpvdXIucmVkdWNlcic7XG5cbmRlc2NyaWJlKCdFbnRpdGllcyByZWR1Y2VyIHRlc3RzJywgKCkgPT4ge1xuICBmdW5jdGlvbiBpc0VtcHR5KGVsZW1lbnQpOiBib29sZWFuIHtcbiAgICBpZiAoZWxlbWVudCBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICByZXR1cm4gZWxlbWVudC5sZW5ndGggPT09IDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBPYmplY3Qua2V5cyhlbGVtZW50KS5sZW5ndGggPT09IDA7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgaW5pdGlhbFN0YXRlOiBFbnRpdHlTdGF0ZTxJUHJvZHVpdEpvdXI+ID0ge1xuICAgIGxvYWRpbmc6IGZhbHNlLFxuICAgIGVycm9yTWVzc2FnZTogbnVsbCxcbiAgICBlbnRpdGllczogW10sXG4gICAgZW50aXR5OiBkZWZhdWx0VmFsdWUsXG4gICAgdG90YWxJdGVtczogMCxcbiAgICB1cGRhdGluZzogZmFsc2UsXG4gICAgdXBkYXRlU3VjY2VzczogZmFsc2UsXG4gIH07XG5cbiAgZnVuY3Rpb24gdGVzdEluaXRpYWxTdGF0ZShzdGF0ZSkge1xuICAgIGV4cGVjdChzdGF0ZSkudG9NYXRjaE9iamVjdCh7XG4gICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgIGVycm9yTWVzc2FnZTogbnVsbCxcbiAgICAgIHVwZGF0aW5nOiBmYWxzZSxcbiAgICAgIHVwZGF0ZVN1Y2Nlc3M6IGZhbHNlLFxuICAgIH0pO1xuICAgIGV4cGVjdChpc0VtcHR5KHN0YXRlLmVudGl0aWVzKSk7XG4gICAgZXhwZWN0KGlzRW1wdHkoc3RhdGUuZW50aXR5KSk7XG4gIH1cblxuICBmdW5jdGlvbiB0ZXN0TXVsdGlwbGVUeXBlcyh0eXBlcywgcGF5bG9hZCwgdGVzdEZ1bmN0aW9uLCBlcnJvcj8pIHtcbiAgICB0eXBlcy5mb3JFYWNoKGUgPT4ge1xuICAgICAgdGVzdEZ1bmN0aW9uKHJlZHVjZXIodW5kZWZpbmVkLCB7IHR5cGU6IGUsIHBheWxvYWQsIGVycm9yIH0pKTtcbiAgICB9KTtcbiAgfVxuXG4gIGRlc2NyaWJlKCdDb21tb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdGhlIGluaXRpYWwgc3RhdGUnLCAoKSA9PiB7XG4gICAgICB0ZXN0SW5pdGlhbFN0YXRlKHJlZHVjZXIodW5kZWZpbmVkLCB7IHR5cGU6ICcnIH0pKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1JlcXVlc3RzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc2V0IHN0YXRlIHRvIGxvYWRpbmcnLCAoKSA9PiB7XG4gICAgICB0ZXN0TXVsdGlwbGVUeXBlcyhbZ2V0RW50aXRpZXMucGVuZGluZy50eXBlLCBnZXRFbnRpdHkucGVuZGluZy50eXBlXSwge30sIHN0YXRlID0+IHtcbiAgICAgICAgZXhwZWN0KHN0YXRlKS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgICBlcnJvck1lc3NhZ2U6IG51bGwsXG4gICAgICAgICAgdXBkYXRlU3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbG9hZGluZzogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2V0IHN0YXRlIHRvIHVwZGF0aW5nJywgKCkgPT4ge1xuICAgICAgdGVzdE11bHRpcGxlVHlwZXMoXG4gICAgICAgIFtjcmVhdGVFbnRpdHkucGVuZGluZy50eXBlLCB1cGRhdGVFbnRpdHkucGVuZGluZy50eXBlLCBwYXJ0aWFsVXBkYXRlRW50aXR5LnBlbmRpbmcudHlwZSwgZGVsZXRlRW50aXR5LnBlbmRpbmcudHlwZV0sXG4gICAgICAgIHt9LFxuICAgICAgICBzdGF0ZSA9PiB7XG4gICAgICAgICAgZXhwZWN0KHN0YXRlKS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgICAgIGVycm9yTWVzc2FnZTogbnVsbCxcbiAgICAgICAgICAgIHVwZGF0ZVN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgdXBkYXRpbmc6IHRydWUsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXNldCB0aGUgc3RhdGUnLCAoKSA9PiB7XG4gICAgICBleHBlY3QocmVkdWNlcih7IC4uLmluaXRpYWxTdGF0ZSwgbG9hZGluZzogdHJ1ZSB9LCByZXNldCgpKSkudG9FcXVhbCh7XG4gICAgICAgIC4uLmluaXRpYWxTdGF0ZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRmFpbHVyZXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzZXQgYSBtZXNzYWdlIGluIGVycm9yTWVzc2FnZScsICgpID0+IHtcbiAgICAgIHRlc3RNdWx0aXBsZVR5cGVzKFxuICAgICAgICBbXG4gICAgICAgICAgZ2V0RW50aXRpZXMucmVqZWN0ZWQudHlwZSxcbiAgICAgICAgICBnZXRFbnRpdHkucmVqZWN0ZWQudHlwZSxcbiAgICAgICAgICBjcmVhdGVFbnRpdHkucmVqZWN0ZWQudHlwZSxcbiAgICAgICAgICB1cGRhdGVFbnRpdHkucmVqZWN0ZWQudHlwZSxcbiAgICAgICAgICBwYXJ0aWFsVXBkYXRlRW50aXR5LnJlamVjdGVkLnR5cGUsXG4gICAgICAgICAgZGVsZXRlRW50aXR5LnJlamVjdGVkLnR5cGUsXG4gICAgICAgIF0sXG4gICAgICAgICdzb21lIG1lc3NhZ2UnLFxuICAgICAgICBzdGF0ZSA9PiB7XG4gICAgICAgICAgZXhwZWN0KHN0YXRlKS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgICAgIGVycm9yTWVzc2FnZTogbnVsbCxcbiAgICAgICAgICAgIHVwZGF0ZVN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgdXBkYXRpbmc6IGZhbHNlLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbWVzc2FnZTogJ2Vycm9yIG1lc3NhZ2UnLFxuICAgICAgICB9LFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1N1Y2Nlc3NlcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGZldGNoIGFsbCBlbnRpdGllcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHBheWxvYWQgPSB7IGRhdGE6IFt7IDE6ICdmYWtlMScgfSwgeyAyOiAnZmFrZTInIH1dLCBoZWFkZXJzOiB7ICd4LXRvdGFsLWNvdW50JzogMTIzIH0gfTtcbiAgICAgIGV4cGVjdChcbiAgICAgICAgcmVkdWNlcih1bmRlZmluZWQsIHtcbiAgICAgICAgICB0eXBlOiBnZXRFbnRpdGllcy5mdWxmaWxsZWQudHlwZSxcbiAgICAgICAgICBwYXlsb2FkLFxuICAgICAgICB9KSxcbiAgICAgICkudG9FcXVhbCh7XG4gICAgICAgIC4uLmluaXRpYWxTdGF0ZSxcbiAgICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICAgIHRvdGFsSXRlbXM6IHBheWxvYWQuaGVhZGVyc1sneC10b3RhbC1jb3VudCddLFxuICAgICAgICBlbnRpdGllczogcGF5bG9hZC5kYXRhLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZldGNoIGEgc2luZ2xlIGVudGl0eScsICgpID0+IHtcbiAgICAgIGNvbnN0IHBheWxvYWQgPSB7IGRhdGE6IHsgMTogJ2Zha2UxJyB9IH07XG4gICAgICBleHBlY3QoXG4gICAgICAgIHJlZHVjZXIodW5kZWZpbmVkLCB7XG4gICAgICAgICAgdHlwZTogZ2V0RW50aXR5LmZ1bGZpbGxlZC50eXBlLFxuICAgICAgICAgIHBheWxvYWQsXG4gICAgICAgIH0pLFxuICAgICAgKS50b0VxdWFsKHtcbiAgICAgICAgLi4uaW5pdGlhbFN0YXRlLFxuICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgZW50aXR5OiBwYXlsb2FkLmRhdGEsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlL3VwZGF0ZSBlbnRpdHknLCAoKSA9PiB7XG4gICAgICBjb25zdCBwYXlsb2FkID0geyBkYXRhOiAnZmFrZSBwYXlsb2FkJyB9O1xuICAgICAgZXhwZWN0KFxuICAgICAgICByZWR1Y2VyKHVuZGVmaW5lZCwge1xuICAgICAgICAgIHR5cGU6IGNyZWF0ZUVudGl0eS5mdWxmaWxsZWQudHlwZSxcbiAgICAgICAgICBwYXlsb2FkLFxuICAgICAgICB9KSxcbiAgICAgICkudG9FcXVhbCh7XG4gICAgICAgIC4uLmluaXRpYWxTdGF0ZSxcbiAgICAgICAgdXBkYXRpbmc6IGZhbHNlLFxuICAgICAgICB1cGRhdGVTdWNjZXNzOiB0cnVlLFxuICAgICAgICBlbnRpdHk6IHBheWxvYWQuZGF0YSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZWxldGUgZW50aXR5JywgKCkgPT4ge1xuICAgICAgY29uc3QgcGF5bG9hZCA9ICdmYWtlIHBheWxvYWQnO1xuICAgICAgY29uc3QgdG9UZXN0ID0gcmVkdWNlcih1bmRlZmluZWQsIHtcbiAgICAgICAgdHlwZTogZGVsZXRlRW50aXR5LmZ1bGZpbGxlZC50eXBlLFxuICAgICAgICBwYXlsb2FkLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QodG9UZXN0KS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgdXBkYXRpbmc6IGZhbHNlLFxuICAgICAgICB1cGRhdGVTdWNjZXNzOiB0cnVlLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBY3Rpb25zJywgKCkgPT4ge1xuICAgIGxldCBzdG9yZTtcblxuICAgIGNvbnN0IHJlc29sdmVkT2JqZWN0ID0geyB2YWx1ZTogJ3doYXRldmVyJyB9O1xuICAgIGNvbnN0IGdldFN0YXRlID0gamVzdC5mbigpO1xuICAgIGNvbnN0IGRpc3BhdGNoID0gamVzdC5mbigpO1xuICAgIGNvbnN0IGV4dHJhID0ge307XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBzdG9yZSA9IGNvbmZpZ3VyZVN0b3JlKHtcbiAgICAgICAgcmVkdWNlcjogKHN0YXRlID0gW10sIGFjdGlvbikgPT4gWy4uLnN0YXRlLCBhY3Rpb25dLFxuICAgICAgfSk7XG4gICAgICBheGlvcy5nZXQgPSBzaW5vbi5zdHViKCkucmV0dXJucyhQcm9taXNlLnJlc29sdmUocmVzb2x2ZWRPYmplY3QpKTtcbiAgICAgIGF4aW9zLnBvc3QgPSBzaW5vbi5zdHViKCkucmV0dXJucyhQcm9taXNlLnJlc29sdmUocmVzb2x2ZWRPYmplY3QpKTtcbiAgICAgIGF4aW9zLnB1dCA9IHNpbm9uLnN0dWIoKS5yZXR1cm5zKFByb21pc2UucmVzb2x2ZShyZXNvbHZlZE9iamVjdCkpO1xuICAgICAgYXhpb3MucGF0Y2ggPSBzaW5vbi5zdHViKCkucmV0dXJucyhQcm9taXNlLnJlc29sdmUocmVzb2x2ZWRPYmplY3QpKTtcbiAgICAgIGF4aW9zLmRlbGV0ZSA9IHNpbm9uLnN0dWIoKS5yZXR1cm5zKFByb21pc2UucmVzb2x2ZShyZXNvbHZlZE9iamVjdCkpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2Rpc3BhdGNoZXMgRkVUQ0hfUFJPRFVJVEpPVVJfTElTVCBhY3Rpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYXJnID0ge307XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldEVudGl0aWVzKGFyZykoZGlzcGF0Y2gsIGdldFN0YXRlLCBleHRyYSk7XG5cbiAgICAgIGNvbnN0IHBlbmRpbmdBY3Rpb24gPSBkaXNwYXRjaC5tb2NrLmNhbGxzWzBdWzBdO1xuICAgICAgZXhwZWN0KHBlbmRpbmdBY3Rpb24ubWV0YS5yZXF1ZXN0U3RhdHVzKS50b0JlKCdwZW5kaW5nJyk7XG4gICAgICBleHBlY3QoZ2V0RW50aXRpZXMuZnVsZmlsbGVkLm1hdGNoKHJlc3VsdCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGlzcGF0Y2hlcyBGRVRDSF9QUk9EVUlUSk9VUiBhY3Rpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYXJnID0gNDI2NjY7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldEVudGl0eShhcmcpKGRpc3BhdGNoLCBnZXRTdGF0ZSwgZXh0cmEpO1xuXG4gICAgICBjb25zdCBwZW5kaW5nQWN0aW9uID0gZGlzcGF0Y2gubW9jay5jYWxsc1swXVswXTtcbiAgICAgIGV4cGVjdChwZW5kaW5nQWN0aW9uLm1ldGEucmVxdWVzdFN0YXR1cykudG9CZSgncGVuZGluZycpO1xuICAgICAgZXhwZWN0KGdldEVudGl0eS5mdWxmaWxsZWQubWF0Y2gocmVzdWx0KSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkaXNwYXRjaGVzIENSRUFURV9QUk9EVUlUSk9VUiBhY3Rpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYXJnID0geyBpZDogNDU2IH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNyZWF0ZUVudGl0eShhcmcpKGRpc3BhdGNoLCBnZXRTdGF0ZSwgZXh0cmEpO1xuXG4gICAgICBjb25zdCBwZW5kaW5nQWN0aW9uID0gZGlzcGF0Y2gubW9jay5jYWxsc1swXVswXTtcbiAgICAgIGV4cGVjdChwZW5kaW5nQWN0aW9uLm1ldGEucmVxdWVzdFN0YXR1cykudG9CZSgncGVuZGluZycpO1xuICAgICAgZXhwZWN0KGNyZWF0ZUVudGl0eS5mdWxmaWxsZWQubWF0Y2gocmVzdWx0KSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkaXNwYXRjaGVzIFVQREFURV9QUk9EVUlUSk9VUiBhY3Rpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYXJnID0geyBpZDogNDU2IH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVwZGF0ZUVudGl0eShhcmcpKGRpc3BhdGNoLCBnZXRTdGF0ZSwgZXh0cmEpO1xuXG4gICAgICBjb25zdCBwZW5kaW5nQWN0aW9uID0gZGlzcGF0Y2gubW9jay5jYWxsc1swXVswXTtcbiAgICAgIGV4cGVjdChwZW5kaW5nQWN0aW9uLm1ldGEucmVxdWVzdFN0YXR1cykudG9CZSgncGVuZGluZycpO1xuICAgICAgZXhwZWN0KHVwZGF0ZUVudGl0eS5mdWxmaWxsZWQubWF0Y2gocmVzdWx0KSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkaXNwYXRjaGVzIFBBUlRJQUxfVVBEQVRFX1BST0RVSVRKT1VSIGFjdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhcmcgPSB7IGlkOiAxMjMgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGFydGlhbFVwZGF0ZUVudGl0eShhcmcpKGRpc3BhdGNoLCBnZXRTdGF0ZSwgZXh0cmEpO1xuXG4gICAgICBjb25zdCBwZW5kaW5nQWN0aW9uID0gZGlzcGF0Y2gubW9jay5jYWxsc1swXVswXTtcbiAgICAgIGV4cGVjdChwZW5kaW5nQWN0aW9uLm1ldGEucmVxdWVzdFN0YXR1cykudG9CZSgncGVuZGluZycpO1xuICAgICAgZXhwZWN0KHBhcnRpYWxVcGRhdGVFbnRpdHkuZnVsZmlsbGVkLm1hdGNoKHJlc3VsdCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGlzcGF0Y2hlcyBERUxFVEVfUFJPRFVJVEpPVVIgYWN0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGFyZyA9IDQyNjY2O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkZWxldGVFbnRpdHkoYXJnKShkaXNwYXRjaCwgZ2V0U3RhdGUsIGV4dHJhKTtcblxuICAgICAgY29uc3QgcGVuZGluZ0FjdGlvbiA9IGRpc3BhdGNoLm1vY2suY2FsbHNbMF1bMF07XG4gICAgICBleHBlY3QocGVuZGluZ0FjdGlvbi5tZXRhLnJlcXVlc3RTdGF0dXMpLnRvQmUoJ3BlbmRpbmcnKTtcbiAgICAgIGV4cGVjdChkZWxldGVFbnRpdHkuZnVsZmlsbGVkLm1hdGNoKHJlc3VsdCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGlzcGF0Y2hlcyBSRVNFVCBhY3Rpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgc3RvcmUuZGlzcGF0Y2gocmVzZXQoKSk7XG4gICAgICBleHBlY3Qoc3RvcmUuZ2V0U3RhdGUoKSkudG9FcXVhbChbZXhwZWN0LmFueShPYmplY3QpLCBleHBlY3Qub2JqZWN0Q29udGFpbmluZyhyZXNldCgpKV0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9