526cc420e9cb53fb7eceb47c54b5db09
/* -*- Mode: js; js-indent-level: 2; -*- */
/*
 * Copyright 2011 Mozilla Foundation and contributors
 * Licensed under the New BSD license. See LICENSE or:
 * http://opensource.org/licenses/BSD-3-Clause
 */

var SourceMapGenerator = require('./source-map-generator').SourceMapGenerator;
var util = require('./util');

// Matches a Windows-style `\r\n` newline or a `\n` newline used by all other
// operating systems these days (capturing the result).
var REGEX_NEWLINE = /(\r?\n)/;

// Newline character code for charCodeAt() comparisons
var NEWLINE_CODE = 10;

// Private symbol for identifying `SourceNode`s when multiple versions of
// the source-map library are loaded. This MUST NOT CHANGE across
// versions!
var isSourceNode = "$$$isSourceNode$$$";

/**
 * SourceNodes provide a way to abstract over interpolating/concatenating
 * snippets of generated JavaScript source code while maintaining the line and
 * column information associated with the original source code.
 *
 * @param aLine The original line number.
 * @param aColumn The original column number.
 * @param aSource The original source's filename.
 * @param aChunks Optional. An array of strings which are snippets of
 *        generated JS, or other SourceNodes.
 * @param aName The original identifier.
 */
function SourceNode(aLine, aColumn, aSource, aChunks, aName) {
  this.children = [];
  this.sourceContents = {};
  this.line = aLine == null ? null : aLine;
  this.column = aColumn == null ? null : aColumn;
  this.source = aSource == null ? null : aSource;
  this.name = aName == null ? null : aName;
  this[isSourceNode] = true;
  if (aChunks != null) this.add(aChunks);
}

/**
 * Creates a SourceNode from generated code and a SourceMapConsumer.
 *
 * @param aGeneratedCode The generated code
 * @param aSourceMapConsumer The SourceMap for the generated code
 * @param aRelativePath Optional. The path that relative sources in the
 *        SourceMapConsumer should be relative to.
 */
SourceNode.fromStringWithSourceMap = function SourceNode_fromStringWithSourceMap(aGeneratedCode, aSourceMapConsumer, aRelativePath) {
  // The SourceNode we want to fill with the generated code
  // and the SourceMap
  var node = new SourceNode();

  // All even indices of this array are one line of the generated code,
  // while all odd indices are the newlines between two adjacent lines
  // (since `REGEX_NEWLINE` captures its match).
  // Processed fragments are accessed by calling `shiftNextLine`.
  var remainingLines = aGeneratedCode.split(REGEX_NEWLINE);
  var remainingLinesIndex = 0;
  var shiftNextLine = function () {
    var lineContents = getNextLine();
    // The last line of a file might not have a newline.
    var newLine = getNextLine() || "";
    return lineContents + newLine;
    function getNextLine() {
      return remainingLinesIndex < remainingLines.length ? remainingLines[remainingLinesIndex++] : undefined;
    }
  };

  // We need to remember the position of "remainingLines"
  var lastGeneratedLine = 1,
    lastGeneratedColumn = 0;

  // The generate SourceNodes we need a code range.
  // To extract it current and last mapping is used.
  // Here we store the last mapping.
  var lastMapping = null;
  aSourceMapConsumer.eachMapping(function (mapping) {
    if (lastMapping !== null) {
      // We add the code from "lastMapping" to "mapping":
      // First check if there is a new line in between.
      if (lastGeneratedLine < mapping.generatedLine) {
        // Associate first line with "lastMapping"
        addMappingWithCode(lastMapping, shiftNextLine());
        lastGeneratedLine++;
        lastGeneratedColumn = 0;
        // The remaining code is added without mapping
      } else {
        // There is no new line in between.
        // Associate the code between "lastGeneratedColumn" and
        // "mapping.generatedColumn" with "lastMapping"
        var nextLine = remainingLines[remainingLinesIndex] || '';
        var code = nextLine.substr(0, mapping.generatedColumn - lastGeneratedColumn);
        remainingLines[remainingLinesIndex] = nextLine.substr(mapping.generatedColumn - lastGeneratedColumn);
        lastGeneratedColumn = mapping.generatedColumn;
        addMappingWithCode(lastMapping, code);
        // No more remaining code, continue
        lastMapping = mapping;
        return;
      }
    }
    // We add the generated code until the first mapping
    // to the SourceNode without any mapping.
    // Each line is added as separate string.
    while (lastGeneratedLine < mapping.generatedLine) {
      node.add(shiftNextLine());
      lastGeneratedLine++;
    }
    if (lastGeneratedColumn < mapping.generatedColumn) {
      var nextLine = remainingLines[remainingLinesIndex] || '';
      node.add(nextLine.substr(0, mapping.generatedColumn));
      remainingLines[remainingLinesIndex] = nextLine.substr(mapping.generatedColumn);
      lastGeneratedColumn = mapping.generatedColumn;
    }
    lastMapping = mapping;
  }, this);
  // We have processed all mappings.
  if (remainingLinesIndex < remainingLines.length) {
    if (lastMapping) {
      // Associate the remaining code in the current line with "lastMapping"
      addMappingWithCode(lastMapping, shiftNextLine());
    }
    // and add the remaining lines without any mapping
    node.add(remainingLines.splice(remainingLinesIndex).join(""));
  }

  // Copy sourcesContent into SourceNode
  aSourceMapConsumer.sources.forEach(function (sourceFile) {
    var content = aSourceMapConsumer.sourceContentFor(sourceFile);
    if (content != null) {
      if (aRelativePath != null) {
        sourceFile = util.join(aRelativePath, sourceFile);
      }
      node.setSourceContent(sourceFile, content);
    }
  });
  return node;
  function addMappingWithCode(mapping, code) {
    if (mapping === null || mapping.source === undefined) {
      node.add(code);
    } else {
      var source = aRelativePath ? util.join(aRelativePath, mapping.source) : mapping.source;
      node.add(new SourceNode(mapping.originalLine, mapping.originalColumn, source, code, mapping.name));
    }
  }
};

/**
 * Add a chunk of generated JS to this source node.
 *
 * @param aChunk A string snippet of generated JS code, another instance of
 *        SourceNode, or an array where each member is one of those things.
 */
SourceNode.prototype.add = function SourceNode_add(aChunk) {
  if (Array.isArray(aChunk)) {
    aChunk.forEach(function (chunk) {
      this.add(chunk);
    }, this);
  } else if (aChunk[isSourceNode] || typeof aChunk === "string") {
    if (aChunk) {
      this.children.push(aChunk);
    }
  } else {
    throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got " + aChunk);
  }
  return this;
};

/**
 * Add a chunk of generated JS to the beginning of this source node.
 *
 * @param aChunk A string snippet of generated JS code, another instance of
 *        SourceNode, or an array where each member is one of those things.
 */
SourceNode.prototype.prepend = function SourceNode_prepend(aChunk) {
  if (Array.isArray(aChunk)) {
    for (var i = aChunk.length - 1; i >= 0; i--) {
      this.prepend(aChunk[i]);
    }
  } else if (aChunk[isSourceNode] || typeof aChunk === "string") {
    this.children.unshift(aChunk);
  } else {
    throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got " + aChunk);
  }
  return this;
};

/**
 * Walk over the tree of JS snippets in this node and its children. The
 * walking function is called once for each snippet of JS and is passed that
 * snippet and the its original associated source's line/column location.
 *
 * @param aFn The traversal function.
 */
SourceNode.prototype.walk = function SourceNode_walk(aFn) {
  var chunk;
  for (var i = 0, len = this.children.length; i < len; i++) {
    chunk = this.children[i];
    if (chunk[isSourceNode]) {
      chunk.walk(aFn);
    } else {
      if (chunk !== '') {
        aFn(chunk, {
          source: this.source,
          line: this.line,
          column: this.column,
          name: this.name
        });
      }
    }
  }
};

/**
 * Like `String.prototype.join` except for SourceNodes. Inserts `aStr` between
 * each of `this.children`.
 *
 * @param aSep The separator.
 */
SourceNode.prototype.join = function SourceNode_join(aSep) {
  var newChildren;
  var i;
  var len = this.children.length;
  if (len > 0) {
    newChildren = [];
    for (i = 0; i < len - 1; i++) {
      newChildren.push(this.children[i]);
      newChildren.push(aSep);
    }
    newChildren.push(this.children[i]);
    this.children = newChildren;
  }
  return this;
};

/**
 * Call String.prototype.replace on the very right-most source snippet. Useful
 * for trimming whitespace from the end of a source node, etc.
 *
 * @param aPattern The pattern to replace.
 * @param aReplacement The thing to replace the pattern with.
 */
SourceNode.prototype.replaceRight = function SourceNode_replaceRight(aPattern, aReplacement) {
  var lastChild = this.children[this.children.length - 1];
  if (lastChild[isSourceNode]) {
    lastChild.replaceRight(aPattern, aReplacement);
  } else if (typeof lastChild === 'string') {
    this.children[this.children.length - 1] = lastChild.replace(aPattern, aReplacement);
  } else {
    this.children.push(''.replace(aPattern, aReplacement));
  }
  return this;
};

/**
 * Set the source content for a source file. This will be added to the SourceMapGenerator
 * in the sourcesContent field.
 *
 * @param aSourceFile The filename of the source file
 * @param aSourceContent The content of the source file
 */
SourceNode.prototype.setSourceContent = function SourceNode_setSourceContent(aSourceFile, aSourceContent) {
  this.sourceContents[util.toSetString(aSourceFile)] = aSourceContent;
};

/**
 * Walk over the tree of SourceNodes. The walking function is called for each
 * source file content and is passed the filename and source content.
 *
 * @param aFn The traversal function.
 */
SourceNode.prototype.walkSourceContents = function SourceNode_walkSourceContents(aFn) {
  for (var i = 0, len = this.children.length; i < len; i++) {
    if (this.children[i][isSourceNode]) {
      this.children[i].walkSourceContents(aFn);
    }
  }
  var sources = Object.keys(this.sourceContents);
  for (var i = 0, len = sources.length; i < len; i++) {
    aFn(util.fromSetString(sources[i]), this.sourceContents[sources[i]]);
  }
};

/**
 * Return the string representation of this source node. Walks over the tree
 * and concatenates all the various snippets together to one string.
 */
SourceNode.prototype.toString = function SourceNode_toString() {
  var str = "";
  this.walk(function (chunk) {
    str += chunk;
  });
  return str;
};

/**
 * Returns the string representation of this source node along with a source
 * map.
 */
SourceNode.prototype.toStringWithSourceMap = function SourceNode_toStringWithSourceMap(aArgs) {
  var generated = {
    code: "",
    line: 1,
    column: 0
  };
  var map = new SourceMapGenerator(aArgs);
  var sourceMappingActive = false;
  var lastOriginalSource = null;
  var lastOriginalLine = null;
  var lastOriginalColumn = null;
  var lastOriginalName = null;
  this.walk(function (chunk, original) {
    generated.code += chunk;
    if (original.source !== null && original.line !== null && original.column !== null) {
      if (lastOriginalSource !== original.source || lastOriginalLine !== original.line || lastOriginalColumn !== original.column || lastOriginalName !== original.name) {
        map.addMapping({
          source: original.source,
          original: {
            line: original.line,
            column: original.column
          },
          generated: {
            line: generated.line,
            column: generated.column
          },
          name: original.name
        });
      }
      lastOriginalSource = original.source;
      lastOriginalLine = original.line;
      lastOriginalColumn = original.column;
      lastOriginalName = original.name;
      sourceMappingActive = true;
    } else if (sourceMappingActive) {
      map.addMapping({
        generated: {
          line: generated.line,
          column: generated.column
        }
      });
      lastOriginalSource = null;
      sourceMappingActive = false;
    }
    for (var idx = 0, length = chunk.length; idx < length; idx++) {
      if (chunk.charCodeAt(idx) === NEWLINE_CODE) {
        generated.line++;
        generated.column = 0;
        // Mappings end at eol
        if (idx + 1 === length) {
          lastOriginalSource = null;
          sourceMappingActive = false;
        } else if (sourceMappingActive) {
          map.addMapping({
            source: original.source,
            original: {
              line: original.line,
              column: original.column
            },
            generated: {
              line: generated.line,
              column: generated.column
            },
            name: original.name
          });
        }
      } else {
        generated.column++;
      }
    }
  });
  this.walkSourceContents(function (sourceFile, sourceContent) {
    map.setSourceContent(sourceFile, sourceContent);
  });
  return {
    code: generated.code,
    map: map
  };
};
exports.SourceNode = SourceNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTb3VyY2VNYXBHZW5lcmF0b3IiLCJyZXF1aXJlIiwidXRpbCIsIlJFR0VYX05FV0xJTkUiLCJORVdMSU5FX0NPREUiLCJpc1NvdXJjZU5vZGUiLCJTb3VyY2VOb2RlIiwiYUxpbmUiLCJhQ29sdW1uIiwiYVNvdXJjZSIsImFDaHVua3MiLCJhTmFtZSIsImNoaWxkcmVuIiwic291cmNlQ29udGVudHMiLCJsaW5lIiwiY29sdW1uIiwic291cmNlIiwibmFtZSIsImFkZCIsImZyb21TdHJpbmdXaXRoU291cmNlTWFwIiwiU291cmNlTm9kZV9mcm9tU3RyaW5nV2l0aFNvdXJjZU1hcCIsImFHZW5lcmF0ZWRDb2RlIiwiYVNvdXJjZU1hcENvbnN1bWVyIiwiYVJlbGF0aXZlUGF0aCIsIm5vZGUiLCJyZW1haW5pbmdMaW5lcyIsInNwbGl0IiwicmVtYWluaW5nTGluZXNJbmRleCIsInNoaWZ0TmV4dExpbmUiLCJsaW5lQ29udGVudHMiLCJnZXROZXh0TGluZSIsIm5ld0xpbmUiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJsYXN0R2VuZXJhdGVkTGluZSIsImxhc3RHZW5lcmF0ZWRDb2x1bW4iLCJsYXN0TWFwcGluZyIsImVhY2hNYXBwaW5nIiwibWFwcGluZyIsImdlbmVyYXRlZExpbmUiLCJhZGRNYXBwaW5nV2l0aENvZGUiLCJuZXh0TGluZSIsImNvZGUiLCJzdWJzdHIiLCJnZW5lcmF0ZWRDb2x1bW4iLCJzcGxpY2UiLCJqb2luIiwic291cmNlcyIsImZvckVhY2giLCJzb3VyY2VGaWxlIiwiY29udGVudCIsInNvdXJjZUNvbnRlbnRGb3IiLCJzZXRTb3VyY2VDb250ZW50Iiwib3JpZ2luYWxMaW5lIiwib3JpZ2luYWxDb2x1bW4iLCJwcm90b3R5cGUiLCJTb3VyY2VOb2RlX2FkZCIsImFDaHVuayIsIkFycmF5IiwiaXNBcnJheSIsImNodW5rIiwicHVzaCIsIlR5cGVFcnJvciIsInByZXBlbmQiLCJTb3VyY2VOb2RlX3ByZXBlbmQiLCJpIiwidW5zaGlmdCIsIndhbGsiLCJTb3VyY2VOb2RlX3dhbGsiLCJhRm4iLCJsZW4iLCJTb3VyY2VOb2RlX2pvaW4iLCJhU2VwIiwibmV3Q2hpbGRyZW4iLCJyZXBsYWNlUmlnaHQiLCJTb3VyY2VOb2RlX3JlcGxhY2VSaWdodCIsImFQYXR0ZXJuIiwiYVJlcGxhY2VtZW50IiwibGFzdENoaWxkIiwicmVwbGFjZSIsIlNvdXJjZU5vZGVfc2V0U291cmNlQ29udGVudCIsImFTb3VyY2VGaWxlIiwiYVNvdXJjZUNvbnRlbnQiLCJ0b1NldFN0cmluZyIsIndhbGtTb3VyY2VDb250ZW50cyIsIlNvdXJjZU5vZGVfd2Fsa1NvdXJjZUNvbnRlbnRzIiwiT2JqZWN0Iiwia2V5cyIsImZyb21TZXRTdHJpbmciLCJ0b1N0cmluZyIsIlNvdXJjZU5vZGVfdG9TdHJpbmciLCJzdHIiLCJ0b1N0cmluZ1dpdGhTb3VyY2VNYXAiLCJTb3VyY2VOb2RlX3RvU3RyaW5nV2l0aFNvdXJjZU1hcCIsImFBcmdzIiwiZ2VuZXJhdGVkIiwibWFwIiwic291cmNlTWFwcGluZ0FjdGl2ZSIsImxhc3RPcmlnaW5hbFNvdXJjZSIsImxhc3RPcmlnaW5hbExpbmUiLCJsYXN0T3JpZ2luYWxDb2x1bW4iLCJsYXN0T3JpZ2luYWxOYW1lIiwib3JpZ2luYWwiLCJhZGRNYXBwaW5nIiwiaWR4IiwiY2hhckNvZGVBdCIsInNvdXJjZUNvbnRlbnQiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsic291cmNlLW5vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyogLSotIE1vZGU6IGpzOyBqcy1pbmRlbnQtbGV2ZWw6IDI7IC0qLSAqL1xuLypcbiAqIENvcHlyaWdodCAyMDExIE1vemlsbGEgRm91bmRhdGlvbiBhbmQgY29udHJpYnV0b3JzXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTmV3IEJTRCBsaWNlbnNlLiBTZWUgTElDRU5TRSBvcjpcbiAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9CU0QtMy1DbGF1c2VcbiAqL1xuXG52YXIgU291cmNlTWFwR2VuZXJhdG9yID0gcmVxdWlyZSgnLi9zb3VyY2UtbWFwLWdlbmVyYXRvcicpLlNvdXJjZU1hcEdlbmVyYXRvcjtcbnZhciB1dGlsID0gcmVxdWlyZSgnLi91dGlsJyk7XG5cbi8vIE1hdGNoZXMgYSBXaW5kb3dzLXN0eWxlIGBcXHJcXG5gIG5ld2xpbmUgb3IgYSBgXFxuYCBuZXdsaW5lIHVzZWQgYnkgYWxsIG90aGVyXG4vLyBvcGVyYXRpbmcgc3lzdGVtcyB0aGVzZSBkYXlzIChjYXB0dXJpbmcgdGhlIHJlc3VsdCkuXG52YXIgUkVHRVhfTkVXTElORSA9IC8oXFxyP1xcbikvO1xuXG4vLyBOZXdsaW5lIGNoYXJhY3RlciBjb2RlIGZvciBjaGFyQ29kZUF0KCkgY29tcGFyaXNvbnNcbnZhciBORVdMSU5FX0NPREUgPSAxMDtcblxuLy8gUHJpdmF0ZSBzeW1ib2wgZm9yIGlkZW50aWZ5aW5nIGBTb3VyY2VOb2RlYHMgd2hlbiBtdWx0aXBsZSB2ZXJzaW9ucyBvZlxuLy8gdGhlIHNvdXJjZS1tYXAgbGlicmFyeSBhcmUgbG9hZGVkLiBUaGlzIE1VU1QgTk9UIENIQU5HRSBhY3Jvc3Ncbi8vIHZlcnNpb25zIVxudmFyIGlzU291cmNlTm9kZSA9IFwiJCQkaXNTb3VyY2VOb2RlJCQkXCI7XG5cbi8qKlxuICogU291cmNlTm9kZXMgcHJvdmlkZSBhIHdheSB0byBhYnN0cmFjdCBvdmVyIGludGVycG9sYXRpbmcvY29uY2F0ZW5hdGluZ1xuICogc25pcHBldHMgb2YgZ2VuZXJhdGVkIEphdmFTY3JpcHQgc291cmNlIGNvZGUgd2hpbGUgbWFpbnRhaW5pbmcgdGhlIGxpbmUgYW5kXG4gKiBjb2x1bW4gaW5mb3JtYXRpb24gYXNzb2NpYXRlZCB3aXRoIHRoZSBvcmlnaW5hbCBzb3VyY2UgY29kZS5cbiAqXG4gKiBAcGFyYW0gYUxpbmUgVGhlIG9yaWdpbmFsIGxpbmUgbnVtYmVyLlxuICogQHBhcmFtIGFDb2x1bW4gVGhlIG9yaWdpbmFsIGNvbHVtbiBudW1iZXIuXG4gKiBAcGFyYW0gYVNvdXJjZSBUaGUgb3JpZ2luYWwgc291cmNlJ3MgZmlsZW5hbWUuXG4gKiBAcGFyYW0gYUNodW5rcyBPcHRpb25hbC4gQW4gYXJyYXkgb2Ygc3RyaW5ncyB3aGljaCBhcmUgc25pcHBldHMgb2ZcbiAqICAgICAgICBnZW5lcmF0ZWQgSlMsIG9yIG90aGVyIFNvdXJjZU5vZGVzLlxuICogQHBhcmFtIGFOYW1lIFRoZSBvcmlnaW5hbCBpZGVudGlmaWVyLlxuICovXG5mdW5jdGlvbiBTb3VyY2VOb2RlKGFMaW5lLCBhQ29sdW1uLCBhU291cmNlLCBhQ2h1bmtzLCBhTmFtZSkge1xuICB0aGlzLmNoaWxkcmVuID0gW107XG4gIHRoaXMuc291cmNlQ29udGVudHMgPSB7fTtcbiAgdGhpcy5saW5lID0gYUxpbmUgPT0gbnVsbCA/IG51bGwgOiBhTGluZTtcbiAgdGhpcy5jb2x1bW4gPSBhQ29sdW1uID09IG51bGwgPyBudWxsIDogYUNvbHVtbjtcbiAgdGhpcy5zb3VyY2UgPSBhU291cmNlID09IG51bGwgPyBudWxsIDogYVNvdXJjZTtcbiAgdGhpcy5uYW1lID0gYU5hbWUgPT0gbnVsbCA/IG51bGwgOiBhTmFtZTtcbiAgdGhpc1tpc1NvdXJjZU5vZGVdID0gdHJ1ZTtcbiAgaWYgKGFDaHVua3MgIT0gbnVsbCkgdGhpcy5hZGQoYUNodW5rcyk7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIFNvdXJjZU5vZGUgZnJvbSBnZW5lcmF0ZWQgY29kZSBhbmQgYSBTb3VyY2VNYXBDb25zdW1lci5cbiAqXG4gKiBAcGFyYW0gYUdlbmVyYXRlZENvZGUgVGhlIGdlbmVyYXRlZCBjb2RlXG4gKiBAcGFyYW0gYVNvdXJjZU1hcENvbnN1bWVyIFRoZSBTb3VyY2VNYXAgZm9yIHRoZSBnZW5lcmF0ZWQgY29kZVxuICogQHBhcmFtIGFSZWxhdGl2ZVBhdGggT3B0aW9uYWwuIFRoZSBwYXRoIHRoYXQgcmVsYXRpdmUgc291cmNlcyBpbiB0aGVcbiAqICAgICAgICBTb3VyY2VNYXBDb25zdW1lciBzaG91bGQgYmUgcmVsYXRpdmUgdG8uXG4gKi9cblNvdXJjZU5vZGUuZnJvbVN0cmluZ1dpdGhTb3VyY2VNYXAgPVxuICBmdW5jdGlvbiBTb3VyY2VOb2RlX2Zyb21TdHJpbmdXaXRoU291cmNlTWFwKGFHZW5lcmF0ZWRDb2RlLCBhU291cmNlTWFwQ29uc3VtZXIsIGFSZWxhdGl2ZVBhdGgpIHtcbiAgICAvLyBUaGUgU291cmNlTm9kZSB3ZSB3YW50IHRvIGZpbGwgd2l0aCB0aGUgZ2VuZXJhdGVkIGNvZGVcbiAgICAvLyBhbmQgdGhlIFNvdXJjZU1hcFxuICAgIHZhciBub2RlID0gbmV3IFNvdXJjZU5vZGUoKTtcblxuICAgIC8vIEFsbCBldmVuIGluZGljZXMgb2YgdGhpcyBhcnJheSBhcmUgb25lIGxpbmUgb2YgdGhlIGdlbmVyYXRlZCBjb2RlLFxuICAgIC8vIHdoaWxlIGFsbCBvZGQgaW5kaWNlcyBhcmUgdGhlIG5ld2xpbmVzIGJldHdlZW4gdHdvIGFkamFjZW50IGxpbmVzXG4gICAgLy8gKHNpbmNlIGBSRUdFWF9ORVdMSU5FYCBjYXB0dXJlcyBpdHMgbWF0Y2gpLlxuICAgIC8vIFByb2Nlc3NlZCBmcmFnbWVudHMgYXJlIGFjY2Vzc2VkIGJ5IGNhbGxpbmcgYHNoaWZ0TmV4dExpbmVgLlxuICAgIHZhciByZW1haW5pbmdMaW5lcyA9IGFHZW5lcmF0ZWRDb2RlLnNwbGl0KFJFR0VYX05FV0xJTkUpO1xuICAgIHZhciByZW1haW5pbmdMaW5lc0luZGV4ID0gMDtcbiAgICB2YXIgc2hpZnROZXh0TGluZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGxpbmVDb250ZW50cyA9IGdldE5leHRMaW5lKCk7XG4gICAgICAvLyBUaGUgbGFzdCBsaW5lIG9mIGEgZmlsZSBtaWdodCBub3QgaGF2ZSBhIG5ld2xpbmUuXG4gICAgICB2YXIgbmV3TGluZSA9IGdldE5leHRMaW5lKCkgfHwgXCJcIjtcbiAgICAgIHJldHVybiBsaW5lQ29udGVudHMgKyBuZXdMaW5lO1xuXG4gICAgICBmdW5jdGlvbiBnZXROZXh0TGluZSgpIHtcbiAgICAgICAgcmV0dXJuIHJlbWFpbmluZ0xpbmVzSW5kZXggPCByZW1haW5pbmdMaW5lcy5sZW5ndGggP1xuICAgICAgICAgICAgcmVtYWluaW5nTGluZXNbcmVtYWluaW5nTGluZXNJbmRleCsrXSA6IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gV2UgbmVlZCB0byByZW1lbWJlciB0aGUgcG9zaXRpb24gb2YgXCJyZW1haW5pbmdMaW5lc1wiXG4gICAgdmFyIGxhc3RHZW5lcmF0ZWRMaW5lID0gMSwgbGFzdEdlbmVyYXRlZENvbHVtbiA9IDA7XG5cbiAgICAvLyBUaGUgZ2VuZXJhdGUgU291cmNlTm9kZXMgd2UgbmVlZCBhIGNvZGUgcmFuZ2UuXG4gICAgLy8gVG8gZXh0cmFjdCBpdCBjdXJyZW50IGFuZCBsYXN0IG1hcHBpbmcgaXMgdXNlZC5cbiAgICAvLyBIZXJlIHdlIHN0b3JlIHRoZSBsYXN0IG1hcHBpbmcuXG4gICAgdmFyIGxhc3RNYXBwaW5nID0gbnVsbDtcblxuICAgIGFTb3VyY2VNYXBDb25zdW1lci5lYWNoTWFwcGluZyhmdW5jdGlvbiAobWFwcGluZykge1xuICAgICAgaWYgKGxhc3RNYXBwaW5nICE9PSBudWxsKSB7XG4gICAgICAgIC8vIFdlIGFkZCB0aGUgY29kZSBmcm9tIFwibGFzdE1hcHBpbmdcIiB0byBcIm1hcHBpbmdcIjpcbiAgICAgICAgLy8gRmlyc3QgY2hlY2sgaWYgdGhlcmUgaXMgYSBuZXcgbGluZSBpbiBiZXR3ZWVuLlxuICAgICAgICBpZiAobGFzdEdlbmVyYXRlZExpbmUgPCBtYXBwaW5nLmdlbmVyYXRlZExpbmUpIHtcbiAgICAgICAgICAvLyBBc3NvY2lhdGUgZmlyc3QgbGluZSB3aXRoIFwibGFzdE1hcHBpbmdcIlxuICAgICAgICAgIGFkZE1hcHBpbmdXaXRoQ29kZShsYXN0TWFwcGluZywgc2hpZnROZXh0TGluZSgpKTtcbiAgICAgICAgICBsYXN0R2VuZXJhdGVkTGluZSsrO1xuICAgICAgICAgIGxhc3RHZW5lcmF0ZWRDb2x1bW4gPSAwO1xuICAgICAgICAgIC8vIFRoZSByZW1haW5pbmcgY29kZSBpcyBhZGRlZCB3aXRob3V0IG1hcHBpbmdcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBUaGVyZSBpcyBubyBuZXcgbGluZSBpbiBiZXR3ZWVuLlxuICAgICAgICAgIC8vIEFzc29jaWF0ZSB0aGUgY29kZSBiZXR3ZWVuIFwibGFzdEdlbmVyYXRlZENvbHVtblwiIGFuZFxuICAgICAgICAgIC8vIFwibWFwcGluZy5nZW5lcmF0ZWRDb2x1bW5cIiB3aXRoIFwibGFzdE1hcHBpbmdcIlxuICAgICAgICAgIHZhciBuZXh0TGluZSA9IHJlbWFpbmluZ0xpbmVzW3JlbWFpbmluZ0xpbmVzSW5kZXhdIHx8ICcnO1xuICAgICAgICAgIHZhciBjb2RlID0gbmV4dExpbmUuc3Vic3RyKDAsIG1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uIC1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0R2VuZXJhdGVkQ29sdW1uKTtcbiAgICAgICAgICByZW1haW5pbmdMaW5lc1tyZW1haW5pbmdMaW5lc0luZGV4XSA9IG5leHRMaW5lLnN1YnN0cihtYXBwaW5nLmdlbmVyYXRlZENvbHVtbiAtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdEdlbmVyYXRlZENvbHVtbik7XG4gICAgICAgICAgbGFzdEdlbmVyYXRlZENvbHVtbiA9IG1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uO1xuICAgICAgICAgIGFkZE1hcHBpbmdXaXRoQ29kZShsYXN0TWFwcGluZywgY29kZSk7XG4gICAgICAgICAgLy8gTm8gbW9yZSByZW1haW5pbmcgY29kZSwgY29udGludWVcbiAgICAgICAgICBsYXN0TWFwcGluZyA9IG1hcHBpbmc7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBXZSBhZGQgdGhlIGdlbmVyYXRlZCBjb2RlIHVudGlsIHRoZSBmaXJzdCBtYXBwaW5nXG4gICAgICAvLyB0byB0aGUgU291cmNlTm9kZSB3aXRob3V0IGFueSBtYXBwaW5nLlxuICAgICAgLy8gRWFjaCBsaW5lIGlzIGFkZGVkIGFzIHNlcGFyYXRlIHN0cmluZy5cbiAgICAgIHdoaWxlIChsYXN0R2VuZXJhdGVkTGluZSA8IG1hcHBpbmcuZ2VuZXJhdGVkTGluZSkge1xuICAgICAgICBub2RlLmFkZChzaGlmdE5leHRMaW5lKCkpO1xuICAgICAgICBsYXN0R2VuZXJhdGVkTGluZSsrO1xuICAgICAgfVxuICAgICAgaWYgKGxhc3RHZW5lcmF0ZWRDb2x1bW4gPCBtYXBwaW5nLmdlbmVyYXRlZENvbHVtbikge1xuICAgICAgICB2YXIgbmV4dExpbmUgPSByZW1haW5pbmdMaW5lc1tyZW1haW5pbmdMaW5lc0luZGV4XSB8fCAnJztcbiAgICAgICAgbm9kZS5hZGQobmV4dExpbmUuc3Vic3RyKDAsIG1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uKSk7XG4gICAgICAgIHJlbWFpbmluZ0xpbmVzW3JlbWFpbmluZ0xpbmVzSW5kZXhdID0gbmV4dExpbmUuc3Vic3RyKG1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uKTtcbiAgICAgICAgbGFzdEdlbmVyYXRlZENvbHVtbiA9IG1hcHBpbmcuZ2VuZXJhdGVkQ29sdW1uO1xuICAgICAgfVxuICAgICAgbGFzdE1hcHBpbmcgPSBtYXBwaW5nO1xuICAgIH0sIHRoaXMpO1xuICAgIC8vIFdlIGhhdmUgcHJvY2Vzc2VkIGFsbCBtYXBwaW5ncy5cbiAgICBpZiAocmVtYWluaW5nTGluZXNJbmRleCA8IHJlbWFpbmluZ0xpbmVzLmxlbmd0aCkge1xuICAgICAgaWYgKGxhc3RNYXBwaW5nKSB7XG4gICAgICAgIC8vIEFzc29jaWF0ZSB0aGUgcmVtYWluaW5nIGNvZGUgaW4gdGhlIGN1cnJlbnQgbGluZSB3aXRoIFwibGFzdE1hcHBpbmdcIlxuICAgICAgICBhZGRNYXBwaW5nV2l0aENvZGUobGFzdE1hcHBpbmcsIHNoaWZ0TmV4dExpbmUoKSk7XG4gICAgICB9XG4gICAgICAvLyBhbmQgYWRkIHRoZSByZW1haW5pbmcgbGluZXMgd2l0aG91dCBhbnkgbWFwcGluZ1xuICAgICAgbm9kZS5hZGQocmVtYWluaW5nTGluZXMuc3BsaWNlKHJlbWFpbmluZ0xpbmVzSW5kZXgpLmpvaW4oXCJcIikpO1xuICAgIH1cblxuICAgIC8vIENvcHkgc291cmNlc0NvbnRlbnQgaW50byBTb3VyY2VOb2RlXG4gICAgYVNvdXJjZU1hcENvbnN1bWVyLnNvdXJjZXMuZm9yRWFjaChmdW5jdGlvbiAoc291cmNlRmlsZSkge1xuICAgICAgdmFyIGNvbnRlbnQgPSBhU291cmNlTWFwQ29uc3VtZXIuc291cmNlQ29udGVudEZvcihzb3VyY2VGaWxlKTtcbiAgICAgIGlmIChjb250ZW50ICE9IG51bGwpIHtcbiAgICAgICAgaWYgKGFSZWxhdGl2ZVBhdGggIT0gbnVsbCkge1xuICAgICAgICAgIHNvdXJjZUZpbGUgPSB1dGlsLmpvaW4oYVJlbGF0aXZlUGF0aCwgc291cmNlRmlsZSk7XG4gICAgICAgIH1cbiAgICAgICAgbm9kZS5zZXRTb3VyY2VDb250ZW50KHNvdXJjZUZpbGUsIGNvbnRlbnQpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG5vZGU7XG5cbiAgICBmdW5jdGlvbiBhZGRNYXBwaW5nV2l0aENvZGUobWFwcGluZywgY29kZSkge1xuICAgICAgaWYgKG1hcHBpbmcgPT09IG51bGwgfHwgbWFwcGluZy5zb3VyY2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBub2RlLmFkZChjb2RlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBzb3VyY2UgPSBhUmVsYXRpdmVQYXRoXG4gICAgICAgICAgPyB1dGlsLmpvaW4oYVJlbGF0aXZlUGF0aCwgbWFwcGluZy5zb3VyY2UpXG4gICAgICAgICAgOiBtYXBwaW5nLnNvdXJjZTtcbiAgICAgICAgbm9kZS5hZGQobmV3IFNvdXJjZU5vZGUobWFwcGluZy5vcmlnaW5hbExpbmUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcHBpbmcub3JpZ2luYWxDb2x1bW4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwcGluZy5uYW1lKSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4vKipcbiAqIEFkZCBhIGNodW5rIG9mIGdlbmVyYXRlZCBKUyB0byB0aGlzIHNvdXJjZSBub2RlLlxuICpcbiAqIEBwYXJhbSBhQ2h1bmsgQSBzdHJpbmcgc25pcHBldCBvZiBnZW5lcmF0ZWQgSlMgY29kZSwgYW5vdGhlciBpbnN0YW5jZSBvZlxuICogICAgICAgIFNvdXJjZU5vZGUsIG9yIGFuIGFycmF5IHdoZXJlIGVhY2ggbWVtYmVyIGlzIG9uZSBvZiB0aG9zZSB0aGluZ3MuXG4gKi9cblNvdXJjZU5vZGUucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIFNvdXJjZU5vZGVfYWRkKGFDaHVuaykge1xuICBpZiAoQXJyYXkuaXNBcnJheShhQ2h1bmspKSB7XG4gICAgYUNodW5rLmZvckVhY2goZnVuY3Rpb24gKGNodW5rKSB7XG4gICAgICB0aGlzLmFkZChjaHVuayk7XG4gICAgfSwgdGhpcyk7XG4gIH1cbiAgZWxzZSBpZiAoYUNodW5rW2lzU291cmNlTm9kZV0gfHwgdHlwZW9mIGFDaHVuayA9PT0gXCJzdHJpbmdcIikge1xuICAgIGlmIChhQ2h1bmspIHtcbiAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChhQ2h1bmspO1xuICAgIH1cbiAgfVxuICBlbHNlIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFxuICAgICAgXCJFeHBlY3RlZCBhIFNvdXJjZU5vZGUsIHN0cmluZywgb3IgYW4gYXJyYXkgb2YgU291cmNlTm9kZXMgYW5kIHN0cmluZ3MuIEdvdCBcIiArIGFDaHVua1xuICAgICk7XG4gIH1cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG4vKipcbiAqIEFkZCBhIGNodW5rIG9mIGdlbmVyYXRlZCBKUyB0byB0aGUgYmVnaW5uaW5nIG9mIHRoaXMgc291cmNlIG5vZGUuXG4gKlxuICogQHBhcmFtIGFDaHVuayBBIHN0cmluZyBzbmlwcGV0IG9mIGdlbmVyYXRlZCBKUyBjb2RlLCBhbm90aGVyIGluc3RhbmNlIG9mXG4gKiAgICAgICAgU291cmNlTm9kZSwgb3IgYW4gYXJyYXkgd2hlcmUgZWFjaCBtZW1iZXIgaXMgb25lIG9mIHRob3NlIHRoaW5ncy5cbiAqL1xuU291cmNlTm9kZS5wcm90b3R5cGUucHJlcGVuZCA9IGZ1bmN0aW9uIFNvdXJjZU5vZGVfcHJlcGVuZChhQ2h1bmspIHtcbiAgaWYgKEFycmF5LmlzQXJyYXkoYUNodW5rKSkge1xuICAgIGZvciAodmFyIGkgPSBhQ2h1bmsubGVuZ3RoLTE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICB0aGlzLnByZXBlbmQoYUNodW5rW2ldKTtcbiAgICB9XG4gIH1cbiAgZWxzZSBpZiAoYUNodW5rW2lzU291cmNlTm9kZV0gfHwgdHlwZW9mIGFDaHVuayA9PT0gXCJzdHJpbmdcIikge1xuICAgIHRoaXMuY2hpbGRyZW4udW5zaGlmdChhQ2h1bmspO1xuICB9XG4gIGVsc2Uge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXG4gICAgICBcIkV4cGVjdGVkIGEgU291cmNlTm9kZSwgc3RyaW5nLCBvciBhbiBhcnJheSBvZiBTb3VyY2VOb2RlcyBhbmQgc3RyaW5ncy4gR290IFwiICsgYUNodW5rXG4gICAgKTtcbiAgfVxuICByZXR1cm4gdGhpcztcbn07XG5cbi8qKlxuICogV2FsayBvdmVyIHRoZSB0cmVlIG9mIEpTIHNuaXBwZXRzIGluIHRoaXMgbm9kZSBhbmQgaXRzIGNoaWxkcmVuLiBUaGVcbiAqIHdhbGtpbmcgZnVuY3Rpb24gaXMgY2FsbGVkIG9uY2UgZm9yIGVhY2ggc25pcHBldCBvZiBKUyBhbmQgaXMgcGFzc2VkIHRoYXRcbiAqIHNuaXBwZXQgYW5kIHRoZSBpdHMgb3JpZ2luYWwgYXNzb2NpYXRlZCBzb3VyY2UncyBsaW5lL2NvbHVtbiBsb2NhdGlvbi5cbiAqXG4gKiBAcGFyYW0gYUZuIFRoZSB0cmF2ZXJzYWwgZnVuY3Rpb24uXG4gKi9cblNvdXJjZU5vZGUucHJvdG90eXBlLndhbGsgPSBmdW5jdGlvbiBTb3VyY2VOb2RlX3dhbGsoYUZuKSB7XG4gIHZhciBjaHVuaztcbiAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICBjaHVuayA9IHRoaXMuY2hpbGRyZW5baV07XG4gICAgaWYgKGNodW5rW2lzU291cmNlTm9kZV0pIHtcbiAgICAgIGNodW5rLndhbGsoYUZuKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBpZiAoY2h1bmsgIT09ICcnKSB7XG4gICAgICAgIGFGbihjaHVuaywgeyBzb3VyY2U6IHRoaXMuc291cmNlLFxuICAgICAgICAgICAgICAgICAgICAgbGluZTogdGhpcy5saW5lLFxuICAgICAgICAgICAgICAgICAgICAgY29sdW1uOiB0aGlzLmNvbHVtbixcbiAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRoaXMubmFtZSB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbi8qKlxuICogTGlrZSBgU3RyaW5nLnByb3RvdHlwZS5qb2luYCBleGNlcHQgZm9yIFNvdXJjZU5vZGVzLiBJbnNlcnRzIGBhU3RyYCBiZXR3ZWVuXG4gKiBlYWNoIG9mIGB0aGlzLmNoaWxkcmVuYC5cbiAqXG4gKiBAcGFyYW0gYVNlcCBUaGUgc2VwYXJhdG9yLlxuICovXG5Tb3VyY2VOb2RlLnByb3RvdHlwZS5qb2luID0gZnVuY3Rpb24gU291cmNlTm9kZV9qb2luKGFTZXApIHtcbiAgdmFyIG5ld0NoaWxkcmVuO1xuICB2YXIgaTtcbiAgdmFyIGxlbiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoO1xuICBpZiAobGVuID4gMCkge1xuICAgIG5ld0NoaWxkcmVuID0gW107XG4gICAgZm9yIChpID0gMDsgaSA8IGxlbi0xOyBpKyspIHtcbiAgICAgIG5ld0NoaWxkcmVuLnB1c2godGhpcy5jaGlsZHJlbltpXSk7XG4gICAgICBuZXdDaGlsZHJlbi5wdXNoKGFTZXApO1xuICAgIH1cbiAgICBuZXdDaGlsZHJlbi5wdXNoKHRoaXMuY2hpbGRyZW5baV0pO1xuICAgIHRoaXMuY2hpbGRyZW4gPSBuZXdDaGlsZHJlbjtcbiAgfVxuICByZXR1cm4gdGhpcztcbn07XG5cbi8qKlxuICogQ2FsbCBTdHJpbmcucHJvdG90eXBlLnJlcGxhY2Ugb24gdGhlIHZlcnkgcmlnaHQtbW9zdCBzb3VyY2Ugc25pcHBldC4gVXNlZnVsXG4gKiBmb3IgdHJpbW1pbmcgd2hpdGVzcGFjZSBmcm9tIHRoZSBlbmQgb2YgYSBzb3VyY2Ugbm9kZSwgZXRjLlxuICpcbiAqIEBwYXJhbSBhUGF0dGVybiBUaGUgcGF0dGVybiB0byByZXBsYWNlLlxuICogQHBhcmFtIGFSZXBsYWNlbWVudCBUaGUgdGhpbmcgdG8gcmVwbGFjZSB0aGUgcGF0dGVybiB3aXRoLlxuICovXG5Tb3VyY2VOb2RlLnByb3RvdHlwZS5yZXBsYWNlUmlnaHQgPSBmdW5jdGlvbiBTb3VyY2VOb2RlX3JlcGxhY2VSaWdodChhUGF0dGVybiwgYVJlcGxhY2VtZW50KSB7XG4gIHZhciBsYXN0Q2hpbGQgPSB0aGlzLmNoaWxkcmVuW3RoaXMuY2hpbGRyZW4ubGVuZ3RoIC0gMV07XG4gIGlmIChsYXN0Q2hpbGRbaXNTb3VyY2VOb2RlXSkge1xuICAgIGxhc3RDaGlsZC5yZXBsYWNlUmlnaHQoYVBhdHRlcm4sIGFSZXBsYWNlbWVudCk7XG4gIH1cbiAgZWxzZSBpZiAodHlwZW9mIGxhc3RDaGlsZCA9PT0gJ3N0cmluZycpIHtcbiAgICB0aGlzLmNoaWxkcmVuW3RoaXMuY2hpbGRyZW4ubGVuZ3RoIC0gMV0gPSBsYXN0Q2hpbGQucmVwbGFjZShhUGF0dGVybiwgYVJlcGxhY2VtZW50KTtcbiAgfVxuICBlbHNlIHtcbiAgICB0aGlzLmNoaWxkcmVuLnB1c2goJycucmVwbGFjZShhUGF0dGVybiwgYVJlcGxhY2VtZW50KSk7XG4gIH1cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG4vKipcbiAqIFNldCB0aGUgc291cmNlIGNvbnRlbnQgZm9yIGEgc291cmNlIGZpbGUuIFRoaXMgd2lsbCBiZSBhZGRlZCB0byB0aGUgU291cmNlTWFwR2VuZXJhdG9yXG4gKiBpbiB0aGUgc291cmNlc0NvbnRlbnQgZmllbGQuXG4gKlxuICogQHBhcmFtIGFTb3VyY2VGaWxlIFRoZSBmaWxlbmFtZSBvZiB0aGUgc291cmNlIGZpbGVcbiAqIEBwYXJhbSBhU291cmNlQ29udGVudCBUaGUgY29udGVudCBvZiB0aGUgc291cmNlIGZpbGVcbiAqL1xuU291cmNlTm9kZS5wcm90b3R5cGUuc2V0U291cmNlQ29udGVudCA9XG4gIGZ1bmN0aW9uIFNvdXJjZU5vZGVfc2V0U291cmNlQ29udGVudChhU291cmNlRmlsZSwgYVNvdXJjZUNvbnRlbnQpIHtcbiAgICB0aGlzLnNvdXJjZUNvbnRlbnRzW3V0aWwudG9TZXRTdHJpbmcoYVNvdXJjZUZpbGUpXSA9IGFTb3VyY2VDb250ZW50O1xuICB9O1xuXG4vKipcbiAqIFdhbGsgb3ZlciB0aGUgdHJlZSBvZiBTb3VyY2VOb2Rlcy4gVGhlIHdhbGtpbmcgZnVuY3Rpb24gaXMgY2FsbGVkIGZvciBlYWNoXG4gKiBzb3VyY2UgZmlsZSBjb250ZW50IGFuZCBpcyBwYXNzZWQgdGhlIGZpbGVuYW1lIGFuZCBzb3VyY2UgY29udGVudC5cbiAqXG4gKiBAcGFyYW0gYUZuIFRoZSB0cmF2ZXJzYWwgZnVuY3Rpb24uXG4gKi9cblNvdXJjZU5vZGUucHJvdG90eXBlLndhbGtTb3VyY2VDb250ZW50cyA9XG4gIGZ1bmN0aW9uIFNvdXJjZU5vZGVfd2Fsa1NvdXJjZUNvbnRlbnRzKGFGbikge1xuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICBpZiAodGhpcy5jaGlsZHJlbltpXVtpc1NvdXJjZU5vZGVdKSB7XG4gICAgICAgIHRoaXMuY2hpbGRyZW5baV0ud2Fsa1NvdXJjZUNvbnRlbnRzKGFGbik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIHNvdXJjZXMgPSBPYmplY3Qua2V5cyh0aGlzLnNvdXJjZUNvbnRlbnRzKTtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gc291cmNlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgYUZuKHV0aWwuZnJvbVNldFN0cmluZyhzb3VyY2VzW2ldKSwgdGhpcy5zb3VyY2VDb250ZW50c1tzb3VyY2VzW2ldXSk7XG4gICAgfVxuICB9O1xuXG4vKipcbiAqIFJldHVybiB0aGUgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgc291cmNlIG5vZGUuIFdhbGtzIG92ZXIgdGhlIHRyZWVcbiAqIGFuZCBjb25jYXRlbmF0ZXMgYWxsIHRoZSB2YXJpb3VzIHNuaXBwZXRzIHRvZ2V0aGVyIHRvIG9uZSBzdHJpbmcuXG4gKi9cblNvdXJjZU5vZGUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gU291cmNlTm9kZV90b1N0cmluZygpIHtcbiAgdmFyIHN0ciA9IFwiXCI7XG4gIHRoaXMud2FsayhmdW5jdGlvbiAoY2h1bmspIHtcbiAgICBzdHIgKz0gY2h1bms7XG4gIH0pO1xuICByZXR1cm4gc3RyO1xufTtcblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBzb3VyY2Ugbm9kZSBhbG9uZyB3aXRoIGEgc291cmNlXG4gKiBtYXAuXG4gKi9cblNvdXJjZU5vZGUucHJvdG90eXBlLnRvU3RyaW5nV2l0aFNvdXJjZU1hcCA9IGZ1bmN0aW9uIFNvdXJjZU5vZGVfdG9TdHJpbmdXaXRoU291cmNlTWFwKGFBcmdzKSB7XG4gIHZhciBnZW5lcmF0ZWQgPSB7XG4gICAgY29kZTogXCJcIixcbiAgICBsaW5lOiAxLFxuICAgIGNvbHVtbjogMFxuICB9O1xuICB2YXIgbWFwID0gbmV3IFNvdXJjZU1hcEdlbmVyYXRvcihhQXJncyk7XG4gIHZhciBzb3VyY2VNYXBwaW5nQWN0aXZlID0gZmFsc2U7XG4gIHZhciBsYXN0T3JpZ2luYWxTb3VyY2UgPSBudWxsO1xuICB2YXIgbGFzdE9yaWdpbmFsTGluZSA9IG51bGw7XG4gIHZhciBsYXN0T3JpZ2luYWxDb2x1bW4gPSBudWxsO1xuICB2YXIgbGFzdE9yaWdpbmFsTmFtZSA9IG51bGw7XG4gIHRoaXMud2FsayhmdW5jdGlvbiAoY2h1bmssIG9yaWdpbmFsKSB7XG4gICAgZ2VuZXJhdGVkLmNvZGUgKz0gY2h1bms7XG4gICAgaWYgKG9yaWdpbmFsLnNvdXJjZSAhPT0gbnVsbFxuICAgICAgICAmJiBvcmlnaW5hbC5saW5lICE9PSBudWxsXG4gICAgICAgICYmIG9yaWdpbmFsLmNvbHVtbiAhPT0gbnVsbCkge1xuICAgICAgaWYobGFzdE9yaWdpbmFsU291cmNlICE9PSBvcmlnaW5hbC5zb3VyY2VcbiAgICAgICAgIHx8IGxhc3RPcmlnaW5hbExpbmUgIT09IG9yaWdpbmFsLmxpbmVcbiAgICAgICAgIHx8IGxhc3RPcmlnaW5hbENvbHVtbiAhPT0gb3JpZ2luYWwuY29sdW1uXG4gICAgICAgICB8fCBsYXN0T3JpZ2luYWxOYW1lICE9PSBvcmlnaW5hbC5uYW1lKSB7XG4gICAgICAgIG1hcC5hZGRNYXBwaW5nKHtcbiAgICAgICAgICBzb3VyY2U6IG9yaWdpbmFsLnNvdXJjZSxcbiAgICAgICAgICBvcmlnaW5hbDoge1xuICAgICAgICAgICAgbGluZTogb3JpZ2luYWwubGluZSxcbiAgICAgICAgICAgIGNvbHVtbjogb3JpZ2luYWwuY29sdW1uXG4gICAgICAgICAgfSxcbiAgICAgICAgICBnZW5lcmF0ZWQ6IHtcbiAgICAgICAgICAgIGxpbmU6IGdlbmVyYXRlZC5saW5lLFxuICAgICAgICAgICAgY29sdW1uOiBnZW5lcmF0ZWQuY29sdW1uXG4gICAgICAgICAgfSxcbiAgICAgICAgICBuYW1lOiBvcmlnaW5hbC5uYW1lXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgbGFzdE9yaWdpbmFsU291cmNlID0gb3JpZ2luYWwuc291cmNlO1xuICAgICAgbGFzdE9yaWdpbmFsTGluZSA9IG9yaWdpbmFsLmxpbmU7XG4gICAgICBsYXN0T3JpZ2luYWxDb2x1bW4gPSBvcmlnaW5hbC5jb2x1bW47XG4gICAgICBsYXN0T3JpZ2luYWxOYW1lID0gb3JpZ2luYWwubmFtZTtcbiAgICAgIHNvdXJjZU1hcHBpbmdBY3RpdmUgPSB0cnVlO1xuICAgIH0gZWxzZSBpZiAoc291cmNlTWFwcGluZ0FjdGl2ZSkge1xuICAgICAgbWFwLmFkZE1hcHBpbmcoe1xuICAgICAgICBnZW5lcmF0ZWQ6IHtcbiAgICAgICAgICBsaW5lOiBnZW5lcmF0ZWQubGluZSxcbiAgICAgICAgICBjb2x1bW46IGdlbmVyYXRlZC5jb2x1bW5cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBsYXN0T3JpZ2luYWxTb3VyY2UgPSBudWxsO1xuICAgICAgc291cmNlTWFwcGluZ0FjdGl2ZSA9IGZhbHNlO1xuICAgIH1cbiAgICBmb3IgKHZhciBpZHggPSAwLCBsZW5ndGggPSBjaHVuay5sZW5ndGg7IGlkeCA8IGxlbmd0aDsgaWR4KyspIHtcbiAgICAgIGlmIChjaHVuay5jaGFyQ29kZUF0KGlkeCkgPT09IE5FV0xJTkVfQ09ERSkge1xuICAgICAgICBnZW5lcmF0ZWQubGluZSsrO1xuICAgICAgICBnZW5lcmF0ZWQuY29sdW1uID0gMDtcbiAgICAgICAgLy8gTWFwcGluZ3MgZW5kIGF0IGVvbFxuICAgICAgICBpZiAoaWR4ICsgMSA9PT0gbGVuZ3RoKSB7XG4gICAgICAgICAgbGFzdE9yaWdpbmFsU291cmNlID0gbnVsbDtcbiAgICAgICAgICBzb3VyY2VNYXBwaW5nQWN0aXZlID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSBpZiAoc291cmNlTWFwcGluZ0FjdGl2ZSkge1xuICAgICAgICAgIG1hcC5hZGRNYXBwaW5nKHtcbiAgICAgICAgICAgIHNvdXJjZTogb3JpZ2luYWwuc291cmNlLFxuICAgICAgICAgICAgb3JpZ2luYWw6IHtcbiAgICAgICAgICAgICAgbGluZTogb3JpZ2luYWwubGluZSxcbiAgICAgICAgICAgICAgY29sdW1uOiBvcmlnaW5hbC5jb2x1bW5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZW5lcmF0ZWQ6IHtcbiAgICAgICAgICAgICAgbGluZTogZ2VuZXJhdGVkLmxpbmUsXG4gICAgICAgICAgICAgIGNvbHVtbjogZ2VuZXJhdGVkLmNvbHVtblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG5hbWU6IG9yaWdpbmFsLm5hbWVcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZ2VuZXJhdGVkLmNvbHVtbisrO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIHRoaXMud2Fsa1NvdXJjZUNvbnRlbnRzKGZ1bmN0aW9uIChzb3VyY2VGaWxlLCBzb3VyY2VDb250ZW50KSB7XG4gICAgbWFwLnNldFNvdXJjZUNvbnRlbnQoc291cmNlRmlsZSwgc291cmNlQ29udGVudCk7XG4gIH0pO1xuXG4gIHJldHVybiB7IGNvZGU6IGdlbmVyYXRlZC5jb2RlLCBtYXA6IG1hcCB9O1xufTtcblxuZXhwb3J0cy5Tb3VyY2VOb2RlID0gU291cmNlTm9kZTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLElBQUlBLGtCQUFrQixHQUFHQyxPQUFPLENBQUMsd0JBQXdCLENBQUMsQ0FBQ0Qsa0JBQWtCO0FBQzdFLElBQUlFLElBQUksR0FBR0QsT0FBTyxDQUFDLFFBQVEsQ0FBQzs7QUFFNUI7QUFDQTtBQUNBLElBQUlFLGFBQWEsR0FBRyxTQUFTOztBQUU3QjtBQUNBLElBQUlDLFlBQVksR0FBRyxFQUFFOztBQUVyQjtBQUNBO0FBQ0E7QUFDQSxJQUFJQyxZQUFZLEdBQUcsb0JBQW9COztBQUV2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTQyxVQUFVQSxDQUFDQyxLQUFLLEVBQUVDLE9BQU8sRUFBRUMsT0FB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