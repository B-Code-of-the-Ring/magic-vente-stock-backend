abb4eafff0f814f771328dfa22c0a90e
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const axios_1 = tslib_1.__importDefault(require("axios"));
const sinon_1 = tslib_1.__importDefault(require("sinon"));
const toolkit_1 = require("@reduxjs/toolkit");
const password_reducer_1 = tslib_1.__importStar(require("./password.reducer"));
describe('Password reducer tests', () => {
    describe('Common tests', () => {
        it('should return the initial state', () => {
            const toTest = (0, password_reducer_1.default)(undefined, { type: '' });
            expect(toTest).toMatchObject({
                loading: false,
                errorMessage: null,
                updateSuccess: false,
                updateFailure: false,
            });
        });
    });
    describe('Password update', () => {
        it('should detect a request', () => {
            const toTest = (0, password_reducer_1.default)(undefined, { type: password_reducer_1.savePassword.pending.type });
            expect(toTest).toMatchObject({
                updateSuccess: false,
                updateFailure: false,
                loading: true,
            });
        });
        it('should detect a success', () => {
            const toTest = (0, password_reducer_1.default)(undefined, { type: password_reducer_1.savePassword.fulfilled.type });
            expect(toTest).toMatchObject({
                updateSuccess: true,
                updateFailure: false,
                loading: false,
            });
        });
        it('should detect a failure', () => {
            const toTest = (0, password_reducer_1.default)(undefined, { type: password_reducer_1.savePassword.rejected.type });
            expect(toTest).toMatchObject({
                updateSuccess: false,
                updateFailure: true,
                loading: false,
            });
        });
        it('should reset the state', () => {
            const initialState = {
                loading: false,
                errorMessage: null,
                successMessage: null,
                updateSuccess: false,
                updateFailure: false,
            };
            expect((0, password_reducer_1.default)(Object.assign(Object.assign({}, initialState), { loading: true }), password_reducer_1.reset)).toEqual(Object.assign({}, initialState));
        });
    });
    describe('Actions', () => {
        let store;
        const resolvedObject = { value: 'whatever' };
        const getState = jest.fn();
        const dispatch = jest.fn();
        const extra = {};
        beforeEach(() => {
            store = (0, toolkit_1.configureStore)({
                reducer: (state = [], action) => [...state, action],
            });
            axios_1.default.post = sinon_1.default.stub().returns(Promise.resolve(resolvedObject));
        });
        it('dispatches UPDATE_PASSWORD_PENDING and UPDATE_PASSWORD_FULFILLED actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const arg = { currentPassword: '', newPassword: '' };
            const result = yield (0, password_reducer_1.savePassword)(arg)(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(password_reducer_1.savePassword.fulfilled.match(result)).toBe(true);
        }));
        it('dispatches RESET actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            yield store.dispatch((0, password_reducer_1.reset)());
            expect(store.getState()).toEqual([expect.any(Object), expect.objectContaining((0, password_reducer_1.reset)())]);
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3BjY28wNTYvRG9jdW1lbnRzL0NvdXJzIElUVS9yaWJvdWNob24vbWFnaWN2ZW50ZXN0b2NrL3NyYy9tYWluL3dlYmFwcC9hcHAvbW9kdWxlcy9hY2NvdW50L3Bhc3N3b3JkL3Bhc3N3b3JkLnJlZHVjZXIuc3BlYy50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSwwREFBMEI7QUFDMUIsMERBQTBCO0FBQzFCLDhDQUFrRDtBQUVsRCwrRUFBbUU7QUFFbkUsUUFBUSxDQUFDLHdCQUF3QixFQUFFLEdBQUcsRUFBRTtJQUN0QyxRQUFRLENBQUMsY0FBYyxFQUFFLEdBQUcsRUFBRTtRQUM1QixFQUFFLENBQUMsaUNBQWlDLEVBQUUsR0FBRyxFQUFFO1lBQ3pDLE1BQU0sTUFBTSxHQUFHLElBQUEsMEJBQVEsRUFBQyxTQUFTLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUNqRCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsYUFBYSxDQUFDO2dCQUMzQixPQUFPLEVBQUUsS0FBSztnQkFDZCxZQUFZLEVBQUUsSUFBSTtnQkFDbEIsYUFBYSxFQUFFLEtBQUs7Z0JBQ3BCLGFBQWEsRUFBRSxLQUFLO2FBQ3JCLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFO1FBQy9CLEVBQUUsQ0FBQyx5QkFBeUIsRUFBRSxHQUFHLEVBQUU7WUFDakMsTUFBTSxNQUFNLEdBQUcsSUFBQSwwQkFBUSxFQUFDLFNBQVMsRUFBRSxFQUFFLElBQUksRUFBRSwrQkFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBQ3hFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxhQUFhLENBQUM7Z0JBQzNCLGFBQWEsRUFBRSxLQUFLO2dCQUNwQixhQUFhLEVBQUUsS0FBSztnQkFDcEIsT0FBTyxFQUFFLElBQUk7YUFDZCxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMs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LENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFELENBQUMsQ0FBQSxDQUFDLENBQUM7UUFDSCxFQUFFLENBQUMsMEJBQTBCLEVBQUUsR0FBUyxFQUFFO1lBQ3hDLE1BQU0sS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFBLHdCQUFLLEdBQUUsQ0FBQyxDQUFDO1lBQzlCLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFBLHdCQUFLLEdBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzRixDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvcGNjbzA1Ni9Eb2N1bWVudHMvQ291cnMgSVRVL3JpYm91Y2hvbi9tYWdpY3ZlbnRlc3RvY2svc3JjL21haW4vd2ViYXBwL2FwcC9tb2R1bGVzL2FjY291bnQvcGFzc3dvcmQvcGFzc3dvcmQucmVkdWNlci5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7XG5pbXBvcnQgc2lub24gZnJvbSAnc2lub24nO1xuaW1wb3J0IHsgY29uZmlndXJlU3RvcmUgfSBmcm9tICdAcmVkdXhqcy90b29sa2l0JztcblxuaW1wb3J0IHBhc3N3b3JkLCB7IHNhdmVQYXNzd29yZCwgcmVzZXQgfSBmcm9tICcuL3Bhc3N3b3JkLnJlZHVjZXInO1xuXG5kZXNjcmliZSgnUGFzc3dvcmQgcmVkdWNlciB0ZXN0cycsICgpID0+IHtcbiAgZGVzY3JpYmUoJ0NvbW1vbiB0ZXN0cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB0aGUgaW5pdGlhbCBzdGF0ZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHRvVGVzdCA9IHBhc3N3b3JkKHVuZGVmaW5lZCwgeyB0eXBlOiAnJyB9KTtcbiAgICAgIGV4cGVjdCh0b1Rlc3QpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgZXJyb3JNZXNzYWdlOiBudWxsLFxuICAgICAgICB1cGRhdGVTdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgdXBkYXRlRmFpbHVyZTogZmFsc2UsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1Bhc3N3b3JkIHVwZGF0ZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGRldGVjdCBhIHJlcXVlc3QnLCAoKSA9PiB7XG4gICAgICBjb25zdCB0b1Rlc3QgPSBwYXNzd29yZCh1bmRlZmluZWQsIHsgdHlwZTogc2F2ZVBhc3N3b3JkLnBlbmRpbmcudHlwZSB9KTtcbiAgICAgIGV4cGVjdCh0b1Rlc3QpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICB1cGRhdGVTdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgdXBkYXRlRmFpbHVyZTogZmFsc2UsXG4gICAgICAgIGxvYWRpbmc6IHRydWUsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGRldGVjdCBhIHN1Y2Nlc3MnLCAoKSA9PiB7XG4gICAgICBjb25zdCB0b1Rlc3QgPSBwYXNzd29yZCh1bmRlZmluZWQsIHsgdHlwZTogc2F2ZVBhc3N3b3JkLmZ1bGZpbGxlZC50eXBlIH0pO1xuICAgICAgZXhwZWN0KHRvVGVzdCkudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIHVwZGF0ZVN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHVwZGF0ZUZhaWx1cmU6IGZhbHNlLFxuICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZGV0ZWN0IGEgZmFpbHVyZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHRvVGVzdCA9IHBhc3N3b3JkKHVuZGVmaW5lZCwgeyB0eXBlOiBzYXZlUGFzc3dvcmQucmVqZWN0ZWQudHlwZSB9KTtcbiAgICAgIGV4cGVjdCh0b1Rlc3QpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICB1cGRhdGVTdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgdXBkYXRlRmFpbHVyZTogdHJ1ZSxcbiAgICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVzZXQgdGhlIHN0YXRlJywgKCkgPT4ge1xuICAgICAgY29uc3QgaW5pdGlhbFN0YXRlID0ge1xuICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgZXJyb3JNZXNzYWdlOiBudWxsLFxuICAgICAgICBzdWNjZXNzTWVzc2FnZTogbnVsbCxcbiAgICAgICAgdXBkYXRlU3VjY2VzczogZmFsc2UsXG4gICAgICAgIHVwZGF0ZUZhaWx1cmU6IGZhbHNlLFxuICAgICAgfTtcbiAgICAgIGV4cGVjdChwYXNzd29yZCh7IC4uLmluaXRpYWxTdGF0ZSwgbG9hZGluZzogdHJ1ZSB9LCByZXNldCkpLnRvRXF1YWwoe1xuICAgICAgICAuLi5pbml0aWFsU3RhdGUsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0FjdGlvbnMnLCAoKSA9PiB7XG4gICAgbGV0IHN0b3JlO1xuXG4gICAgY29uc3QgcmVzb2x2ZWRPYmplY3QgPSB7IHZhbHVlOiAnd2hhdGV2ZXInIH07XG4gICAgY29uc3QgZ2V0U3RhdGUgPSBqZXN0LmZuKCk7XG4gICAgY29uc3QgZGlzcGF0Y2ggPSBqZXN0LmZuKCk7XG4gICAgY29uc3QgZXh0cmEgPSB7fTtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIHN0b3JlID0gY29uZmlndXJlU3RvcmUoe1xuICAgICAgICByZWR1Y2VyOiAoc3RhdGUgPSBbXSwgYWN0aW9uKSA9PiBbLi4uc3RhdGUsIGFjdGlvbl0sXG4gICAgICB9KTtcbiAgICAgIGF4aW9zLnBvc3QgPSBzaW5vbi5zdHViKCkucmV0dXJucyhQcm9taXNlLnJlc29sdmUocmVzb2x2ZWRPYmplY3QpKTtcbiAgICB9KTtcblxuICAgIGl0KCdkaXNwYXRjaGVzIFVQREFURV9QQVNTV09SRF9QRU5ESU5HIGFuZCBVUERBVEVfUEFTU1dPUkRfRlVMRklMTEVEIGFjdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhcmcgPSB7IGN1cnJlbnRQYXNzd29yZDogJycsIG5ld1Bhc3N3b3JkOiAnJyB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzYXZlUGFzc3dvcmQoYXJnKShkaXNwYXRjaCwgZ2V0U3RhdGUsIGV4dHJhKTtcblxuICAgICAgY29uc3QgcGVuZGluZ0FjdGlvbiA9IGRpc3BhdGNoLm1vY2suY2FsbHNbMF1bMF07XG4gICAgICBleHBlY3QocGVuZGluZ0FjdGlvbi5tZXRhLnJlcXVlc3RTdGF0dXMpLnRvQmUoJ3BlbmRpbmcnKTtcbiAgICAgIGV4cGVjdChzYXZlUGFzc3dvcmQuZnVsZmlsbGVkLm1hdGNoKHJlc3VsdCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gICAgaXQoJ2Rpc3BhdGNoZXMgUkVTRVQgYWN0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHN0b3JlLmRpc3BhdGNoKHJlc2V0KCkpO1xuICAgICAgZXhwZWN0KHN0b3JlLmdldFN0YXRlKCkpLnRvRXF1YWwoW2V4cGVjdC5hbnkoT2JqZWN0KSwgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcocmVzZXQoKSldKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==