0effa1175a40cc34d8a412b0868cf5d0
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const axios_1 = tslib_1.__importDefault(require("axios"));
const sinon_1 = tslib_1.__importDefault(require("sinon"));
const toolkit_1 = require("@reduxjs/toolkit");
const administration_reducer_1 = tslib_1.__importStar(require("./administration.reducer"));
describe('Administration reducer tests', () => {
    function isEmpty(element) {
        if (element instanceof Array) {
            return element.length === 0;
        }
        return Object.keys(element).length === 0;
    }
    function testInitialState(state) {
        expect(state).toMatchObject({
            loading: false,
            errorMessage: null,
            totalItems: 0,
        });
        expect(isEmpty(state.logs.loggers));
        expect(isEmpty(state.threadDump));
    }
    function testMultipleTypes(types, payload, testFunction, error) {
        types.forEach(e => {
            testFunction((0, administration_reducer_1.default)(undefined, { type: e, payload, error }));
        });
    }
    describe('Common', () => {
        it('should return the initial state', () => {
            testInitialState((0, administration_reducer_1.default)(undefined, { type: '' }));
        });
    });
    describe('Requests', () => {
        it('should set state to loading', () => {
            testMultipleTypes([
                administration_reducer_1.getLoggers.pending.type,
                administration_reducer_1.getSystemHealth.pending.type,
                administration_reducer_1.getSystemMetrics.pending.type,
                administration_reducer_1.getSystemThreadDump.pending.type,
                administration_reducer_1.getConfigurations.pending.type,
                administration_reducer_1.getEnv.pending.type,
            ], {}, state => {
                expect(state).toMatchObject({
                    errorMessage: null,
                    loading: true,
                });
            });
        });
    });
    describe('Failures', () => {
        it('should set state to failed and put an error message in errorMessage', () => {
            testMultipleTypes([
                administration_reducer_1.getLoggers.rejected.type,
                administration_reducer_1.getSystemHealth.rejected.type,
                administration_reducer_1.getSystemMetrics.rejected.type,
                administration_reducer_1.getSystemThreadDump.rejected.type,
                administration_reducer_1.getConfigurations.rejected.type,
                administration_reducer_1.getEnv.rejected.type,
            ], 'something happened', state => {
                expect(state).toMatchObject({
                    loading: false,
                    errorMessage: 'error',
                });
            }, {
                message: 'error',
            });
        });
    });
    describe('Success', () => {
        it('should update state according to a successful fetch logs request', () => {
            const payload = {
                data: {
                    loggers: {
                        main: {
                            effectiveLevel: 'WARN',
                        },
                    },
                },
            };
            const toTest = (0, administration_reducer_1.default)(undefined, { type: administration_reducer_1.getLoggers.fulfilled.type, payload });
            expect(toTest).toMatchObject({
                loading: false,
                logs: payload.data,
            });
        });
        it('should update state according to a successful fetch health request', () => {
            const payload = { data: { status: 'UP' } };
            const toTest = (0, administration_reducer_1.default)(undefined, { type: administration_reducer_1.getSystemHealth.fulfilled.type, payload });
            expect(toTest).toMatchObject({
                loading: false,
                health: payload.data,
            });
        });
        it('should update state according to a successful fetch metrics request', () => {
            const payload = { data: { version: '3.1.3', gauges: {} } };
            const toTest = (0, administration_reducer_1.default)(undefined, { type: administration_reducer_1.getSystemMetrics.fulfilled.type, payload });
            expect(toTest).toMatchObject({
                loading: false,
                metrics: payload.data,
            });
        });
        it('should update state according to a successful fetch thread dump request', () => {
            const payload = { data: [{ threadName: 'hz.gateway.cached.thread-6', threadId: 9266 }] };
            const toTest = (0, administration_reducer_1.default)(undefined, { type: administration_reducer_1.getSystemThreadDump.fulfilled.type, payload });
            expect(toTest).toMatchObject({
                loading: false,
                threadDump: payload.data,
            });
        });
        it('should update state according to a successful fetch configurations request', () => {
            const payload = { data: { contexts: { jhipster: { beans: {} } } } };
            const toTest = (0, administration_reducer_1.default)(undefined, { type: administration_reducer_1.getConfigurations.fulfilled.type, payload });
            expect(toTest).toMatchObject({
                loading: false,
                configuration: {
                    configProps: payload.data,
                    env: {},
                },
            });
        });
        it('should update state according to a successful fetch env request', () => {
            const payload = { data: { activeProfiles: ['api-docs', 'dev'] } };
            const toTest = (0, administration_reducer_1.default)(undefined, { type: administration_reducer_1.getEnv.fulfilled.type, payload });
            expect(toTest).toMatchObject({
                loading: false,
                configuration: {
                    configProps: {},
                    env: payload.data,
                },
            });
        });
    });
    describe('Actions', () => {
        let store;
        const resolvedObject = { value: 'whatever' };
        const getState = jest.fn();
        const dispatch = jest.fn();
        const extra = {};
        beforeEach(() => {
            store = (0, toolkit_1.configureStore)({
                reducer: (state = [], action) => [...state, action],
            });
            axios_1.default.get = sinon_1.default.stub().returns(Promise.resolve(resolvedObject));
            axios_1.default.post = sinon_1.default.stub().returns(Promise.resolve(resolvedObject));
        });
        it('dispatches FETCH_HEALTH_PENDING and FETCH_HEALTH_FULFILLED actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const result = yield (0, administration_reducer_1.getSystemHealth)()(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(administration_reducer_1.getSystemHealth.fulfilled.match(result)).toBe(true);
            expect(result.payload).toBe(resolvedObject);
        }));
        it('dispatches FETCH_METRICS_PENDING and FETCH_METRICS_FULFILLED actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const result = yield (0, administration_reducer_1.getSystemMetrics)()(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(administration_reducer_1.getSystemMetrics.fulfilled.match(result)).toBe(true);
        }));
        it('dispatches FETCH_THREAD_DUMP_PENDING and FETCH_THREAD_DUMP_FULFILLED actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const result = yield (0, administration_reducer_1.getSystemThreadDump)()(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(administration_reducer_1.getSystemThreadDump.fulfilled.match(result)).toBe(true);
        }));
        it('dispatches FETCH_LOGS_PENDING and FETCH_LOGS_FULFILLED actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const result = yield (0, administration_reducer_1.getLoggers)()(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(administration_reducer_1.getLoggers.fulfilled.match(result)).toBe(true);
        }));
        it('dispatches FETCH_LOGS_CHANGE_LEVEL_PENDING and FETCH_LOGS_CHANGE_LEVEL_FULFILLED actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const result = yield (0, administration_reducer_1.setLoggers)({ name: 'ROOT', configuredLevel: 'DEBUG' })(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(administration_reducer_1.setLoggers.fulfilled.match(result)).toBe(true);
        }));
        it('dispatches FETCH_CONFIGURATIONS_PENDING and FETCH_CONFIGURATIONS_FULFILLED actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const result = yield (0, administration_reducer_1.getConfigurations)()(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(administration_reducer_1.getConfigurations.fulfilled.match(result)).toBe(true);
        }));
        it('dispatches FETCH_ENV_PENDING and FETCH_ENV_FULFILLED actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const result = yield (0, administration_reducer_1.getEnv)()(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(administration_reducer_1.getEnv.fulfilled.match(result)).toBe(true);
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3BjY28wNTYvRG9jdW1lbnRzL0NvdXJzIElUVS9yaWJvdWNob24vbWFnaWN2ZW50ZXN0b2NrL3NyYy9tYWluL3dlYmFwcC9hcHAvbW9kdWxlcy9hZG1pbmlzdHJhdGlvbi9hZG1pbmlzdHJhdGlvbi5yZWR1Y2VyLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQUEsMERBQTBCO0FBQzFCLDBEQUEwQjtBQUMxQiw4Q0FBa0Q7QUFFbEQsMkZBUWtDO0FBRWxDLFFBQVEsQ0FBQyw4QkFBOEIsRUFBRSxHQUFHLEVBQUU7SUFDNUMsU0FBUyxPQUFPLENBQUMsT0FBTztRQUN0QixJQUFJLE9BQU8sWUFBWSxLQUFLLEVBQUUsQ0FBQztZQUM3QixPQUFPLE9BQU8sQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDO1FBQzlCLENBQUM7UUFDRCxPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztJQUMzQyxDQUFDO0lBRUQsU0FBUyxnQkFBZ0IsQ0FBQyxLQUFLO1FBQzdCLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxhQUFhLENBQUM7WUFDMUIsT0FBTyxFQUFFLEtBQUs7WUFDZCxZQUFZLEVBQUUsSUFBSTtZQUNsQixVQUFVLEVBQUUsQ0FBQztTQUNkLENBQUMsQ0FBQztRQUNILE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ3BDLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7SUFDcEMsQ0FBQztJQUVELFNBQVMsaUJBQWlCLENBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxZQUFZLEVBQUUsS0FBTTtRQUM3RCxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFO1lBQ2hCLFlBQVksQ0FBQyxJQUFBLGdDQUFjLEVBQUMsU0FBUyxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFF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QyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvcGNjbzA1Ni9Eb2N1bWVudHMvQ291cnMgSVRVL3JpYm91Y2hvbi9tYWdpY3ZlbnRlc3RvY2svc3JjL21haW4vd2ViYXBwL2FwcC9tb2R1bGVzL2FkbWluaXN0cmF0aW9uL2FkbWluaXN0cmF0aW9uLnJlZHVjZXIuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuaW1wb3J0IHNpbm9uIGZyb20gJ3Npbm9uJztcbmltcG9ydCB7IGNvbmZpZ3VyZVN0b3JlIH0gZnJvbSAnQHJlZHV4anMvdG9vbGtpdCc7XG5cbmltcG9ydCBhZG1pbmlzdHJhdGlvbiwge1xuICBnZXRTeXN0ZW1IZWFsdGgsXG4gIGdldFN5c3RlbU1ldHJpY3MsXG4gIGdldFN5c3RlbVRocmVhZER1bXAsXG4gIGdldExvZ2dlcnMsXG4gIGdldENvbmZpZ3VyYXRpb25zLFxuICBnZXRFbnYsXG4gIHNldExvZ2dlcnMsXG59IGZyb20gJy4vYWRtaW5pc3RyYXRpb24ucmVkdWNlcic7XG5cbmRlc2NyaWJlKCdBZG1pbmlzdHJhdGlvbiByZWR1Y2VyIHRlc3RzJywgKCkgPT4ge1xuICBmdW5jdGlvbiBpc0VtcHR5KGVsZW1lbnQpOiBib29sZWFuIHtcbiAgICBpZiAoZWxlbWVudCBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICByZXR1cm4gZWxlbWVudC5sZW5ndGggPT09IDA7XG4gICAgfVxuICAgIHJldHVybiBPYmplY3Qua2V5cyhlbGVtZW50KS5sZW5ndGggPT09IDA7XG4gIH1cblxuICBmdW5jdGlvbiB0ZXN0SW5pdGlhbFN0YXRlKHN0YXRlKSB7XG4gICAgZXhwZWN0KHN0YXRlKS50b01hdGNoT2JqZWN0KHtcbiAgICAgIGxvYWRpbmc6IGZhbHNlLFxuICAgICAgZXJyb3JNZXNzYWdlOiBudWxsLFxuICAgICAgdG90YWxJdGVtczogMCxcbiAgICB9KTtcbiAgICBleHBlY3QoaXNFbXB0eShzdGF0ZS5sb2dzLmxvZ2dlcnMpKTtcbiAgICBleHBlY3QoaXNFbXB0eShzdGF0ZS50aHJlYWREdW1wKSk7XG4gIH1cblxuICBmdW5jdGlvbiB0ZXN0TXVsdGlwbGVUeXBlcyh0eXBlcywgcGF5bG9hZCwgdGVzdEZ1bmN0aW9uLCBlcnJvcj8pIHtcbiAgICB0eXBlcy5mb3JFYWNoKGUgPT4ge1xuICAgICAgdGVzdEZ1bmN0aW9uKGFkbWluaXN0cmF0aW9uKHVuZGVmaW5lZCwgeyB0eXBlOiBlLCBwYXlsb2FkLCBlcnJvciB9KSk7XG4gICAgfSk7XG4gIH1cblxuICBkZXNjcmliZSgnQ29tbW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRoZSBpbml0aWFsIHN0YXRlJywgKCkgPT4ge1xuICAgICAgdGVzdEluaXRpYWxTdGF0ZShhZG1pbmlzdHJhdGlvbih1bmRlZmluZWQsIHsgdHlwZTogJycgfSkpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUmVxdWVzdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzZXQgc3RhdGUgdG8gbG9hZGluZycsICgpID0+IHtcbiAgICAgIHRlc3RNdWx0aXBsZVR5cGVzKFxuICAgICAgICBbXG4gICAgICAgICAgZ2V0TG9nZ2Vycy5wZW5kaW5nLnR5cGUsXG4gICAgICAgICAgZ2V0U3lzdGVtSGVhbHRoLnBlbmRpbmcudHlwZSxcbiAgICAgICAgICBnZXRTeXN0ZW1NZXRyaWNzLnBlbmRpbmcudHlwZSxcbiAgICAgICAgICBnZXRTeXN0ZW1UaHJlYWREdW1wLnBlbmRpbmcudHlwZSxcbiAgICAgICAgICBnZXRDb25maWd1cmF0aW9ucy5wZW5kaW5nLnR5cGUsXG4gICAgICAgICAgZ2V0RW52LnBlbmRpbmcudHlwZSxcbiAgICAgICAgXSxcbiAgICAgICAge30sXG4gICAgICAgIHN0YXRlID0+IHtcbiAgICAgICAgICBleHBlY3Qoc3RhdGUpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICAgICAgZXJyb3JNZXNzYWdlOiBudWxsLFxuICAgICAgICAgICAgbG9hZGluZzogdHJ1ZSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdGYWlsdXJlcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNldCBzdGF0ZSB0byBmYWlsZWQgYW5kIHB1dCBhbiBlcnJvciBtZXNzYWdlIGluIGVycm9yTWVzc2FnZScsICgpID0+IHtcbiAgICAgIHRlc3RNdWx0aXBsZVR5cGVzKFxuICAgICAgICBbXG4gICAgICAgICAgZ2V0TG9nZ2Vycy5yZWplY3RlZC50eXBlLFxuICAgICAgICAgIGdldFN5c3RlbUhlYWx0aC5yZWplY3RlZC50eXBlLFxuICAgICAgICAgIGdldFN5c3RlbU1ldHJpY3MucmVqZWN0ZWQudHlwZSxcbiAgICAgICAgICBnZXRTeXN0ZW1UaHJlYWREdW1wLnJlamVjdGVkLnR5cGUsXG4gICAgICAgICAgZ2V0Q29uZmlndXJhdGlvbnMucmVqZWN0ZWQudHlwZSxcbiAgICAgICAgICBnZXRFbnYucmVqZWN0ZWQudHlwZSxcbiAgICAgICAgXSxcbiAgICAgICAgJ3NvbWV0aGluZyBoYXBwZW5lZCcsXG4gICAgICAgIHN0YXRlID0+IHtcbiAgICAgICAgICBleHBlY3Qoc3RhdGUpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgICBlcnJvck1lc3NhZ2U6ICdlcnJvcicsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBtZXNzYWdlOiAnZXJyb3InLFxuICAgICAgICB9LFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1N1Y2Nlc3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgc3RhdGUgYWNjb3JkaW5nIHRvIGEgc3VjY2Vzc2Z1bCBmZXRjaCBsb2dzIHJlcXVlc3QnLCAoKSA9PiB7XG4gICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgbG9nZ2Vyczoge1xuICAgICAgICAgICAgbWFpbjoge1xuICAgICAgICAgICAgICBlZmZlY3RpdmVMZXZlbDogJ1dBUk4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICAgIGNvbnN0IHRvVGVzdCA9IGFkbWluaXN0cmF0aW9uKHVuZGVmaW5lZCwgeyB0eXBlOiBnZXRMb2dnZXJzLmZ1bGZpbGxlZC50eXBlLCBwYXlsb2FkIH0pO1xuXG4gICAgICBleHBlY3QodG9UZXN0KS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICAgIGxvZ3M6IHBheWxvYWQuZGF0YSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgc3RhdGUgYWNjb3JkaW5nIHRvIGEgc3VjY2Vzc2Z1bCBmZXRjaCBoZWFsdGggcmVxdWVzdCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHBheWxvYWQgPSB7IGRhdGE6IHsgc3RhdHVzOiAnVVAnIH0gfTtcbiAgICAgIGNvbnN0IHRvVGVzdCA9IGFkbWluaXN0cmF0aW9uKHVuZGVmaW5lZCwgeyB0eXBlOiBnZXRTeXN0ZW1IZWFsdGguZnVsZmlsbGVkLnR5cGUsIHBheWxvYWQgfSk7XG5cbiAgICAgIGV4cGVjdCh0b1Rlc3QpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgaGVhbHRoOiBwYXlsb2FkLmRhdGEsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXBkYXRlIHN0YXRlIGFjY29yZGluZyB0byBhIHN1Y2Nlc3NmdWwgZmV0Y2ggbWV0cmljcyByZXF1ZXN0JywgKCkgPT4ge1xuICAgICAgY29uc3QgcGF5bG9hZCA9IHsgZGF0YTogeyB2ZXJzaW9uOiAnMy4xLjMnLCBnYXVnZXM6IHt9IH0gfTtcbiAgICAgIGNvbnN0IHRvVGVzdCA9IGFkbWluaXN0cmF0aW9uKHVuZGVmaW5lZCwgeyB0eXBlOiBnZXRTeXN0ZW1NZXRyaWNzLmZ1bGZpbGxlZC50eXBlLCBwYXlsb2FkIH0pO1xuXG4gICAgICBleHBlY3QodG9UZXN0KS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICAgIG1ldHJpY3M6IHBheWxvYWQuZGF0YSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgc3RhdGUgYWNjb3JkaW5nIHRvIGEgc3VjY2Vzc2Z1bCBmZXRjaCB0aHJlYWQgZHVtcCByZXF1ZXN0JywgKCkgPT4ge1xuICAgICAgY29uc3QgcGF5bG9hZCA9IHsgZGF0YTogW3sgdGhyZWFkTmFtZTogJ2h6LmdhdGV3YXkuY2FjaGVkLnRocmVhZC02JywgdGhyZWFkSWQ6IDkyNjYgfV0gfTtcbiAgICAgIGNvbnN0IHRvVGVzdCA9IGFkbWluaXN0cmF0aW9uKHVuZGVmaW5lZCwgeyB0eXBlOiBnZXRTeXN0ZW1UaHJlYWREdW1wLmZ1bGZpbGxlZC50eXBlLCBwYXlsb2FkIH0pO1xuXG4gICAgICBleHBlY3QodG9UZXN0KS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICAgIHRocmVhZER1bXA6IHBheWxvYWQuZGF0YSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgc3RhdGUgYWNjb3JkaW5nIHRvIGEgc3VjY2Vzc2Z1bCBmZXRjaCBjb25maWd1cmF0aW9ucyByZXF1ZXN0JywgKCkgPT4ge1xuICAgICAgY29uc3QgcGF5bG9hZCA9IHsgZGF0YTogeyBjb250ZXh0czogeyBqaGlwc3RlcjogeyBiZWFuczoge30gfSB9IH0gfTtcbiAgICAgIGNvbnN0IHRvVGVzdCA9IGFkbWluaXN0cmF0aW9uKHVuZGVmaW5lZCwgeyB0eXBlOiBnZXRDb25maWd1cmF0aW9ucy5mdWxmaWxsZWQudHlwZSwgcGF5bG9hZCB9KTtcblxuICAgICAgZXhwZWN0KHRvVGVzdCkudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIGxvYWRpbmc6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgY29uZmlnUHJvcHM6IHBheWxvYWQuZGF0YSxcbiAgICAgICAgICBlbnY6IHt9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBzdGF0ZSBhY2NvcmRpbmcgdG8gYSBzdWNjZXNzZnVsIGZldGNoIGVudiByZXF1ZXN0JywgKCkgPT4ge1xuICAgICAgY29uc3QgcGF5bG9hZCA9IHsgZGF0YTogeyBhY3RpdmVQcm9maWxlczogWydhcGktZG9jcycsICdkZXYnXSB9IH07XG4gICAgICBjb25zdCB0b1Rlc3QgPSBhZG1pbmlzdHJhdGlvbih1bmRlZmluZWQsIHsgdHlwZTogZ2V0RW52LmZ1bGZpbGxlZC50eXBlLCBwYXlsb2FkIH0pO1xuXG4gICAgICBleHBlY3QodG9UZXN0KS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICBjb25maWdQcm9wczoge30sXG4gICAgICAgICAgZW52OiBwYXlsb2FkLmRhdGEsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG4gIGRlc2NyaWJlKCdBY3Rpb25zJywgKCkgPT4ge1xuICAgIGxldCBzdG9yZTtcblxuICAgIGNvbnN0IHJlc29sdmVkT2JqZWN0ID0geyB2YWx1ZTogJ3doYXRldmVyJyB9O1xuICAgIGNvbnN0IGdldFN0YXRlID0gamVzdC5mbigpO1xuICAgIGNvbnN0IGRpc3BhdGNoID0gamVzdC5mbigpO1xuICAgIGNvbnN0IGV4dHJhID0ge307XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBzdG9yZSA9IGNvbmZpZ3VyZVN0b3JlKHtcbiAgICAgICAgcmVkdWNlcjogKHN0YXRlID0gW10sIGFjdGlvbikgPT4gWy4uLnN0YXRlLCBhY3Rpb25dLFxuICAgICAgfSk7XG4gICAgICBheGlvcy5nZXQgPSBzaW5vbi5zdHViKCkucmV0dXJucyhQcm9taXNlLnJlc29sdmUocmVzb2x2ZWRPYmplY3QpKTtcbiAgICAgIGF4aW9zLnBvc3QgPSBzaW5vbi5zdHViKCkucmV0dXJucyhQcm9taXNlLnJlc29sdmUocmVzb2x2ZWRPYmplY3QpKTtcbiAgICB9KTtcbiAgICBpdCgnZGlzcGF0Y2hlcyBGRVRDSF9IRUFMVEhfUEVORElORyBhbmQgRkVUQ0hfSEVBTFRIX0ZVTEZJTExFRCBhY3Rpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0U3lzdGVtSGVhbHRoKCkoZGlzcGF0Y2gsIGdldFN0YXRlLCBleHRyYSk7XG5cbiAgICAgIGNvbnN0IHBlbmRpbmdBY3Rpb24gPSBkaXNwYXRjaC5tb2NrLmNhbGxzWzBdWzBdO1xuICAgICAgZXhwZWN0KHBlbmRpbmdBY3Rpb24ubWV0YS5yZXF1ZXN0U3RhdHVzKS50b0JlKCdwZW5kaW5nJyk7XG4gICAgICBleHBlY3QoZ2V0U3lzdGVtSGVhbHRoLmZ1bGZpbGxlZC5tYXRjaChyZXN1bHQpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5wYXlsb2FkKS50b0JlKHJlc29sdmVkT2JqZWN0KTtcbiAgICB9KTtcbiAgICBpdCgnZGlzcGF0Y2hlcyBGRVRDSF9NRVRSSUNTX1BFTkRJTkcgYW5kIEZFVENIX01FVFJJQ1NfRlVMRklMTEVEIGFjdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRTeXN0ZW1NZXRyaWNzKCkoZGlzcGF0Y2gsIGdldFN0YXRlLCBleHRyYSk7XG5cbiAgICAgIGNvbnN0IHBlbmRpbmdBY3Rpb24gPSBkaXNwYXRjaC5tb2NrLmNhbGxzWzBdWzBdO1xuICAgICAgZXhwZWN0KHBlbmRpbmdBY3Rpb24ubWV0YS5yZXF1ZXN0U3RhdHVzKS50b0JlKCdwZW5kaW5nJyk7XG4gICAgICBleHBlY3QoZ2V0U3lzdGVtTWV0cmljcy5mdWxmaWxsZWQubWF0Y2gocmVzdWx0KSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgICBpdCgnZGlzcGF0Y2hlcyBGRVRDSF9USFJFQURfRFVNUF9QRU5ESU5HIGFuZCBGRVRDSF9USFJFQURfRFVNUF9GVUxGSUxMRUQgYWN0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldFN5c3RlbVRocmVhZER1bXAoKShkaXNwYXRjaCwgZ2V0U3RhdGUsIGV4dHJhKTtcblxuICAgICAgY29uc3QgcGVuZGluZ0FjdGlvbiA9IGRpc3BhdGNoLm1vY2suY2FsbHNbMF1bMF07XG4gICAgICBleHBlY3QocGVuZGluZ0FjdGlvbi5tZXRhLnJlcXVlc3RTdGF0dXMpLnRvQmUoJ3BlbmRpbmcnKTtcbiAgICAgIGV4cGVjdChnZXRTeXN0ZW1UaHJlYWREdW1wLmZ1bGZpbGxlZC5tYXRjaChyZXN1bHQpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICAgIGl0KCdkaXNwYXRjaGVzIEZFVENIX0xPR1NfUEVORElORyBhbmQgRkVUQ0hfTE9HU19GVUxGSUxMRUQgYWN0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGdldExvZ2dlcnMoKShkaXNwYXRjaCwgZ2V0U3RhdGUsIGV4dHJhKTtcblxuICAgICAgY29uc3QgcGVuZGluZ0FjdGlvbiA9IGRpc3BhdGNoLm1vY2suY2FsbHNbMF1bMF07XG4gICAgICBleHBlY3QocGVuZGluZ0FjdGlvbi5tZXRhLnJlcXVlc3RTdGF0dXMpLnRvQmUoJ3BlbmRpbmcnKTtcbiAgICAgIGV4cGVjdChnZXRMb2dnZXJzLmZ1bGZpbGxlZC5tYXRjaChyZXN1bHQpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICAgIGl0KCdkaXNwYXRjaGVzIEZFVENIX0xPR1NfQ0hBTkdFX0xFVkVMX1BFTkRJTkcgYW5kIEZFVENIX0xPR1NfQ0hBTkdFX0xFVkVMX0ZVTEZJTExFRCBhY3Rpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2V0TG9nZ2Vycyh7IG5hbWU6ICdST09UJywgY29uZmlndXJlZExldmVsOiAnREVCVUcnIH0pKGRpc3BhdGNoLCBnZXRTdGF0ZSwgZXh0cmEpO1xuXG4gICAgICBjb25zdCBwZW5kaW5nQWN0aW9uID0gZGlzcGF0Y2gubW9jay5jYWxsc1swXVswXTtcbiAgICAgIGV4cGVjdChwZW5kaW5nQWN0aW9uLm1ldGEucmVxdWVzdFN0YXR1cykudG9CZSgncGVuZGluZycpO1xuICAgICAgZXhwZWN0KHNldExvZ2dlcnMuZnVsZmlsbGVkLm1hdGNoKHJlc3VsdCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gICAgaXQoJ2Rpc3BhdGNoZXMgRkVUQ0hfQ09ORklHVVJBVElPTlNfUEVORElORyBhbmQgRkVUQ0hfQ09ORklHVVJBVElPTlNfRlVMRklMTEVEIGFjdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRDb25maWd1cmF0aW9ucygpKGRpc3BhdGNoLCBnZXRTdGF0ZSwgZXh0cmEpO1xuXG4gICAgICBjb25zdCBwZW5kaW5nQWN0aW9uID0gZGlzcGF0Y2gubW9jay5jYWxsc1swXVswXTtcbiAgICAgIGV4cGVjdChwZW5kaW5nQWN0aW9uLm1ldGEucmVxdWVzdFN0YXR1cykudG9CZSgncGVuZGluZycpO1xuICAgICAgZXhwZWN0KGdldENvbmZpZ3VyYXRpb25zLmZ1bGZpbGxlZC5tYXRjaChyZXN1bHQpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICAgIGl0KCdkaXNwYXRjaGVzIEZFVENIX0VOVl9QRU5ESU5HIGFuZCBGRVRDSF9FTlZfRlVMRklMTEVEIGFjdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRFbnYoKShkaXNwYXRjaCwgZ2V0U3RhdGUsIGV4dHJhKTtcblxuICAgICAgY29uc3QgcGVuZGluZ0FjdGlvbiA9IGRpc3BhdGNoLm1vY2suY2FsbHNbMF1bMF07XG4gICAgICBleHBlY3QocGVuZGluZ0FjdGlvbi5tZXRhLnJlcXVlc3RTdGF0dXMpLnRvQmUoJ3BlbmRpbmcnKTtcbiAgICAgIGV4cGVjdChnZXRFbnYuZnVsZmlsbGVkLm1hdGNoKHJlc3VsdCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=