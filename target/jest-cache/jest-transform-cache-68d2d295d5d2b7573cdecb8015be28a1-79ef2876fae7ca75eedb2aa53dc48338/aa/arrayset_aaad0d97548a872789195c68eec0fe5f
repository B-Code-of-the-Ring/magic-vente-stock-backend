e19b55a3412585387c2d80ba333d40b3
/* -*- Mode: js; js-indent-level: 2; -*- */
/*
 * Copyright 2011 Mozilla Foundation and contributors
 * Licensed under the New BSD license. See LICENSE or:
 * http://opensource.org/licenses/BSD-3-Clause
 */

var util = require('./util');
var has = Object.prototype.hasOwnProperty;
var hasNativeMap = typeof Map !== "undefined";

/**
 * A data structure which is a combination of an array and a set. Adding a new
 * member is O(1), testing for membership is O(1), and finding the index of an
 * element is O(1). Removing elements from the set is not supported. Only
 * strings are supported for membership.
 */
function ArraySet() {
  this._array = [];
  this._set = hasNativeMap ? new Map() : Object.create(null);
}

/**
 * Static method for creating ArraySet instances from an existing array.
 */
ArraySet.fromArray = function ArraySet_fromArray(aArray, aAllowDuplicates) {
  var set = new ArraySet();
  for (var i = 0, len = aArray.length; i < len; i++) {
    set.add(aArray[i], aAllowDuplicates);
  }
  return set;
};

/**
 * Return how many unique items are in this ArraySet. If duplicates have been
 * added, than those do not count towards the size.
 *
 * @returns Number
 */
ArraySet.prototype.size = function ArraySet_size() {
  return hasNativeMap ? this._set.size : Object.getOwnPropertyNames(this._set).length;
};

/**
 * Add the given string to this set.
 *
 * @param String aStr
 */
ArraySet.prototype.add = function ArraySet_add(aStr, aAllowDuplicates) {
  var sStr = hasNativeMap ? aStr : util.toSetString(aStr);
  var isDuplicate = hasNativeMap ? this.has(aStr) : has.call(this._set, sStr);
  var idx = this._array.length;
  if (!isDuplicate || aAllowDuplicates) {
    this._array.push(aStr);
  }
  if (!isDuplicate) {
    if (hasNativeMap) {
      this._set.set(aStr, idx);
    } else {
      this._set[sStr] = idx;
    }
  }
};

/**
 * Is the given string a member of this set?
 *
 * @param String aStr
 */
ArraySet.prototype.has = function ArraySet_has(aStr) {
  if (hasNativeMap) {
    return this._set.has(aStr);
  } else {
    var sStr = util.toSetString(aStr);
    return has.call(this._set, sStr);
  }
};

/**
 * What is the index of the given string in the array?
 *
 * @param String aStr
 */
ArraySet.prototype.indexOf = function ArraySet_indexOf(aStr) {
  if (hasNativeMap) {
    var idx = this._set.get(aStr);
    if (idx >= 0) {
      return idx;
    }
  } else {
    var sStr = util.toSetString(aStr);
    if (has.call(this._set, sStr)) {
      return this._set[sStr];
    }
  }
  throw new Error('"' + aStr + '" is not in the set.');
};

/**
 * What is the element at the given index?
 *
 * @param Number aIdx
 */
ArraySet.prototype.at = function ArraySet_at(aIdx) {
  if (aIdx >= 0 && aIdx < this._array.length) {
    return this._array[aIdx];
  }
  throw new Error('No element indexed by ' + aIdx);
};

/**
 * Returns the array representation of this set (which has the proper indices
 * indicated by indexOf). Note that this is a copy of the internal array used
 * for storing the members so that no one can mess with internal state.
 */
ArraySet.prototype.toArray = function ArraySet_toArray() {
  return this._array.slice();
};
exports.ArraySet = ArraySet;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ1dGlsIiwicmVxdWlyZSIsImhhcyIsIk9iamVjdCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiaGFzTmF0aXZlTWFwIiwiTWFwIiwiQXJyYXlTZXQiLCJfYXJyYXkiLCJfc2V0IiwiY3JlYXRlIiwiZnJvbUFycmF5IiwiQXJyYXlTZXRfZnJvbUFycmF5IiwiYUFycmF5IiwiYUFsbG93RHVwbGljYXRlcyIsInNldCIsImkiLCJsZW4iLCJsZW5ndGgiLCJhZGQiLCJzaXplIiwiQXJyYXlTZXRfc2l6ZSIsImdldE93blByb3BlcnR5TmFtZXMiLCJBcnJheVNldF9hZGQiLCJhU3RyIiwic1N0ciIsInRvU2V0U3RyaW5nIiwiaXNEdXBsaWNhdGUiLCJjYWxsIiwiaWR4IiwicHVzaCIsIkFycmF5U2V0X2hhcyIsImluZGV4T2YiLCJBcnJheVNldF9pbmRleE9mIiwiZ2V0IiwiRXJyb3IiLCJhdCIsIkFycmF5U2V0X2F0IiwiYUlkeCIsInRvQXJyYXkiLCJBcnJheVNldF90b0FycmF5Iiwic2xpY2UiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiYXJyYXktc2V0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIC0qLSBNb2RlOiBqczsganMtaW5kZW50LWxldmVsOiAyOyAtKi0gKi9cbi8qXG4gKiBDb3B5cmlnaHQgMjAxMSBNb3ppbGxhIEZvdW5kYXRpb24gYW5kIGNvbnRyaWJ1dG9yc1xuICogTGljZW5zZWQgdW5kZXIgdGhlIE5ldyBCU0QgbGljZW5zZS4gU2VlIExJQ0VOU0Ugb3I6XG4gKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvQlNELTMtQ2xhdXNlXG4gKi9cblxudmFyIHV0aWwgPSByZXF1aXJlKCcuL3V0aWwnKTtcbnZhciBoYXMgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5O1xudmFyIGhhc05hdGl2ZU1hcCA9IHR5cGVvZiBNYXAgIT09IFwidW5kZWZpbmVkXCI7XG5cbi8qKlxuICogQSBkYXRhIHN0cnVjdHVyZSB3aGljaCBpcyBhIGNvbWJpbmF0aW9uIG9mIGFuIGFycmF5IGFuZCBhIHNldC4gQWRkaW5nIGEgbmV3XG4gKiBtZW1iZXIgaXMgTygxKSwgdGVzdGluZyBmb3IgbWVtYmVyc2hpcCBpcyBPKDEpLCBhbmQgZmluZGluZyB0aGUgaW5kZXggb2YgYW5cbiAqIGVsZW1lbnQgaXMgTygxKS4gUmVtb3ZpbmcgZWxlbWVudHMgZnJvbSB0aGUgc2V0IGlzIG5vdCBzdXBwb3J0ZWQuIE9ubHlcbiAqIHN0cmluZ3MgYXJlIHN1cHBvcnRlZCBmb3IgbWVtYmVyc2hpcC5cbiAqL1xuZnVuY3Rpb24gQXJyYXlTZXQoKSB7XG4gIHRoaXMuX2FycmF5ID0gW107XG4gIHRoaXMuX3NldCA9IGhhc05hdGl2ZU1hcCA/IG5ldyBNYXAoKSA6IE9iamVjdC5jcmVhdGUobnVsbCk7XG59XG5cbi8qKlxuICogU3RhdGljIG1ldGhvZCBmb3IgY3JlYXRpbmcgQXJyYXlTZXQgaW5zdGFuY2VzIGZyb20gYW4gZXhpc3RpbmcgYXJyYXkuXG4gKi9cbkFycmF5U2V0LmZyb21BcnJheSA9IGZ1bmN0aW9uIEFycmF5U2V0X2Zyb21BcnJheShhQXJyYXksIGFBbGxvd0R1cGxpY2F0ZXMpIHtcbiAgdmFyIHNldCA9IG5ldyBBcnJheVNldCgpO1xuICBmb3IgKHZhciBpID0gMCwgbGVuID0gYUFycmF5Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgc2V0LmFkZChhQXJyYXlbaV0sIGFBbGxvd0R1cGxpY2F0ZXMpO1xuICB9XG4gIHJldHVybiBzZXQ7XG59O1xuXG4vKipcbiAqIFJldHVybiBob3cgbWFueSB1bmlxdWUgaXRlbXMgYXJlIGluIHRoaXMgQXJyYXlTZXQuIElmIGR1cGxpY2F0ZXMgaGF2ZSBiZWVuXG4gKiBhZGRlZCwgdGhhbiB0aG9zZSBkbyBub3QgY291bnQgdG93YXJkcyB0aGUgc2l6ZS5cbiAqXG4gKiBAcmV0dXJucyBOdW1iZXJcbiAqL1xuQXJyYXlTZXQucHJvdG90eXBlLnNpemUgPSBmdW5jdGlvbiBBcnJheVNldF9zaXplKCkge1xuICByZXR1cm4gaGFzTmF0aXZlTWFwID8gdGhpcy5fc2V0LnNpemUgOiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0aGlzLl9zZXQpLmxlbmd0aDtcbn07XG5cbi8qKlxuICogQWRkIHRoZSBnaXZlbiBzdHJpbmcgdG8gdGhpcyBzZXQuXG4gKlxuICogQHBhcmFtIFN0cmluZyBhU3RyXG4gKi9cbkFycmF5U2V0LnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiBBcnJheVNldF9hZGQoYVN0ciwgYUFsbG93RHVwbGljYXRlcykge1xuICB2YXIgc1N0ciA9IGhhc05hdGl2ZU1hcCA/IGFTdHIgOiB1dGlsLnRvU2V0U3RyaW5nKGFTdHIpO1xuICB2YXIgaXNEdXBsaWNhdGUgPSBoYXNOYXRpdmVNYXAgPyB0aGlzLmhhcyhhU3RyKSA6IGhhcy5jYWxsKHRoaXMuX3NldCwgc1N0cik7XG4gIHZhciBpZHggPSB0aGlzLl9hcnJheS5sZW5ndGg7XG4gIGlmICghaXNEdXBsaWNhdGUgfHwgYUFsbG93RHVwbGljYXRlcykge1xuICAgIHRoaXMuX2FycmF5LnB1c2goYVN0cik7XG4gIH1cbiAgaWYgKCFpc0R1cGxpY2F0ZSkge1xuICAgIGlmIChoYXNOYXRpdmVNYXApIHtcbiAgICAgIHRoaXMuX3NldC5zZXQoYVN0ciwgaWR4KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fc2V0W3NTdHJdID0gaWR4O1xuICAgIH1cbiAgfVxufTtcblxuLyoqXG4gKiBJcyB0aGUgZ2l2ZW4gc3RyaW5nIGEgbWVtYmVyIG9mIHRoaXMgc2V0P1xuICpcbiAqIEBwYXJhbSBTdHJpbmcgYVN0clxuICovXG5BcnJheVNldC5wcm90b3R5cGUuaGFzID0gZnVuY3Rpb24gQXJyYXlTZXRfaGFzKGFTdHIpIHtcbiAgaWYgKGhhc05hdGl2ZU1hcCkge1xuICAgIHJldHVybiB0aGlzLl9zZXQuaGFzKGFTdHIpO1xuICB9IGVsc2Uge1xuICAgIHZhciBzU3RyID0gdXRpbC50b1NldFN0cmluZyhhU3RyKTtcbiAgICByZXR1cm4gaGFzLmNhbGwodGhpcy5fc2V0LCBzU3RyKTtcbiAgfVxufTtcblxuLyoqXG4gKiBXaGF0IGlzIHRoZSBpbmRleCBvZiB0aGUgZ2l2ZW4gc3RyaW5nIGluIHRoZSBhcnJheT9cbiAqXG4gKiBAcGFyYW0gU3RyaW5nIGFTdHJcbiAqL1xuQXJyYXlTZXQucHJvdG90eXBlLmluZGV4T2YgPSBmdW5jdGlvbiBBcnJheVNldF9pbmRleE9mKGFTdHIpIHtcbiAgaWYgKGhhc05hdGl2ZU1hcCkge1xuICAgIHZhciBpZHggPSB0aGlzLl9zZXQuZ2V0KGFTdHIpO1xuICAgIGlmIChpZHggPj0gMCkge1xuICAgICAgICByZXR1cm4gaWR4O1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICB2YXIgc1N0ciA9IHV0aWwudG9TZXRTdHJpbmcoYVN0cik7XG4gICAgaWYgKGhhcy5jYWxsKHRoaXMuX3NldCwgc1N0cikpIHtcbiAgICAgIHJldHVybiB0aGlzLl9zZXRbc1N0cl07XG4gICAgfVxuICB9XG5cbiAgdGhyb3cgbmV3IEVycm9yKCdcIicgKyBhU3RyICsgJ1wiIGlzIG5vdCBpbiB0aGUgc2V0LicpO1xufTtcblxuLyoqXG4gKiBXaGF0IGlzIHRoZSBlbGVtZW50IGF0IHRoZSBnaXZlbiBpbmRleD9cbiAqXG4gKiBAcGFyYW0gTnVtYmVyIGFJZHhcbiAqL1xuQXJyYXlTZXQucHJvdG90eXBlLmF0ID0gZnVuY3Rpb24gQXJyYXlTZXRfYXQoYUlkeCkge1xuICBpZiAoYUlkeCA+PSAwICYmIGFJZHggPCB0aGlzLl9hcnJheS5sZW5ndGgpIHtcbiAgICByZXR1cm4gdGhpcy5fYXJyYXlbYUlkeF07XG4gIH1cbiAgdGhyb3cgbmV3IEVycm9yKCdObyBlbGVtZW50IGluZGV4ZWQgYnkgJyArIGFJZHgpO1xufTtcblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBhcnJheSByZXByZXNlbnRhdGlvbiBvZiB0aGlzIHNldCAod2hpY2ggaGFzIHRoZSBwcm9wZXIgaW5kaWNlc1xuICogaW5kaWNhdGVkIGJ5IGluZGV4T2YpLiBOb3RlIHRoYXQgdGhpcyBpcyBhIGNvcHkgb2YgdGhlIGludGVybmFsIGFycmF5IHVzZWRcbiAqIGZvciBzdG9yaW5nIHRoZSBtZW1iZXJzIHNvIHRoYXQgbm8gb25lIGNhbiBtZXNzIHdpdGggaW50ZXJuYWwgc3RhdGUuXG4gKi9cbkFycmF5U2V0LnByb3RvdHlwZS50b0FycmF5ID0gZnVuY3Rpb24gQXJyYXlTZXRfdG9BcnJheSgpIHtcbiAgcmV0dXJuIHRoaXMuX2FycmF5LnNsaWNlKCk7XG59O1xuXG5leHBvcnRzLkFycmF5U2V0ID0gQXJyYXlTZXQ7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxJQUFJQSxJQUFJLEdBQUdDLE9BQU8sQ0FBQyxRQUFRLENBQUM7QUFDNUIsSUFBSUMsR0FBRyxHQUFHQyxNQUFNLENBQUNDLFNBQVMsQ0FBQ0MsY0FBYztBQUN6QyxJQUFJQyxZQUFZLEdBQUcsT0FBT0MsR0FBRyxLQUFLLFdBQVc7O0FBRTdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVNDLFFBQVFBLENBQUEsRUFBRztFQUNsQixJQUFJLENBQUNDLE1BQU0sR0FBRyxFQUFFO0VBQ2hCLElBQUksQ0FBQ0MsSUFBSSxHQUFHSixZQUFZLEdBQUcsSUFBSUMsR0FBRyxDQUFDLENBQUMsR0FBR0osTUFBTSxDQUFDUSxNQUFNLENBQUMsSUFBSSxDQUFDO0FBQzVEOztBQUVBO0FBQ0E7QUFDQTtBQUNBSCxRQUFRLENBQUNJLFNBQVMsR0FBRyxTQUFTQyxrQkFBa0JBLENBQUNDLE1BQU0sRUFBRUMsZ0JBQWdCLEVBQUU7RUFDekUsSUFBSUMsR0FBRyxHQUFHLElBQUlSLFFBQVEsQ0FBQyxDQUFDO0VBQ3hCLEtBQUssSUFBSVMsQ0FBQyxHQUFHLENBQUMsRUFBRUMsR0FBRyxHQUFHSixNQUFNLENBQUNLLE1BQU0sRUFBRUYsQ0FBQyxHQUFHQyxHQUFHLEVBQUVELENBQUMsRUFBRSxFQUFFO0lBQ2pERCxHQUFHLENBQUNJLEdBQUcsQ0FBQ04sTUFBTSxD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