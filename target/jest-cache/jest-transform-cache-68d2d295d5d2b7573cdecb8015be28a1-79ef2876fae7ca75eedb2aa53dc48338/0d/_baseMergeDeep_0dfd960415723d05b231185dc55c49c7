b59018e217ba8bf69ef54369ea799bf3
var assignMergeValue = require('./_assignMergeValue'),
  cloneBuffer = require('./_cloneBuffer'),
  cloneTypedArray = require('./_cloneTypedArray'),
  copyArray = require('./_copyArray'),
  initCloneObject = require('./_initCloneObject'),
  isArguments = require('./isArguments'),
  isArray = require('./isArray'),
  isArrayLikeObject = require('./isArrayLikeObject'),
  isBuffer = require('./isBuffer'),
  isFunction = require('./isFunction'),
  isObject = require('./isObject'),
  isPlainObject = require('./isPlainObject'),
  isTypedArray = require('./isTypedArray'),
  safeGet = require('./_safeGet'),
  toPlainObject = require('./toPlainObject');

/**
 * A specialized version of `baseMerge` for arrays and objects which performs
 * deep merges and tracks traversed objects enabling objects with circular
 * references to be merged.
 *
 * @private
 * @param {Object} object The destination object.
 * @param {Object} source The source object.
 * @param {string} key The key of the value to merge.
 * @param {number} srcIndex The index of `source`.
 * @param {Function} mergeFunc The function to merge values.
 * @param {Function} [customizer] The function to customize assigned values.
 * @param {Object} [stack] Tracks traversed source values and their merged
 *  counterparts.
 */
function baseMergeDeep(object, source, key, srcIndex, mergeFunc, customizer, stack) {
  var objValue = safeGet(object, key),
    srcValue = safeGet(source, key),
    stacked = stack.get(srcValue);
  if (stacked) {
    assignMergeValue(object, key, stacked);
    return;
  }
  var newValue = customizer ? customizer(objValue, srcValue, key + '', object, source, stack) : undefined;
  var isCommon = newValue === undefined;
  if (isCommon) {
    var isArr = isArray(srcValue),
      isBuff = !isArr && isBuffer(srcValue),
      isTyped = !isArr && !isBuff && isTypedArray(srcValue);
    newValue = srcValue;
    if (isArr || isBuff || isTyped) {
      if (isArray(objValue)) {
        newValue = objValue;
      } else if (isArrayLikeObject(objValue)) {
        newValue = copyArray(objValue);
      } else if (isBuff) {
        isCommon = false;
        newValue = cloneBuffer(srcValue, true);
      } else if (isTyped) {
        isCommon = false;
        newValue = cloneTypedArray(srcValue, true);
      } else {
        newValue = [];
      }
    } else if (isPlainObject(srcValue) || isArguments(srcValue)) {
      newValue = objValue;
      if (isArguments(objValue)) {
        newValue = toPlainObject(objValue);
      } else if (!isObject(objValue) || isFunction(objValue)) {
        newValue = initCloneObject(srcValue);
      }
    } else {
      isCommon = false;
    }
  }
  if (isCommon) {
    // Recursively merge objects and arrays (susceptible to call stack limits).
    stack.set(srcValue, newValue);
    mergeFunc(newValue, srcValue, srcIndex, customizer, stack);
    stack['delete'](srcValue);
  }
  assignMergeValue(object, key, newValue);
}
module.exports = baseMergeDeep;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJhc3NpZ25NZXJnZVZhbHVlIiwicmVxdWlyZSIsImNsb25lQnVmZmVyIiwiY2xvbmVUeXBlZEFycmF5IiwiY29weUFycmF5IiwiaW5pdENsb25lT2JqZWN0IiwiaXNBcmd1bWVudHMiLCJpc0FycmF5IiwiaXNBcnJheUxpa2VPYmplY3QiLCJpc0J1ZmZlciIsImlzRnVuY3Rpb24iLCJpc09iamVjdCIsImlzUGxhaW5PYmplY3QiLCJpc1R5cGVkQXJyYXkiLCJzYWZlR2V0IiwidG9QbGFpbk9iamVjdCIsImJhc2VNZXJnZURlZXAiLCJvYmplY3QiLCJzb3VyY2UiLCJrZXkiLCJzcmNJbmRleCIsIm1lcmdlRnVuYyIsImN1c3RvbWl6ZXIiLCJzdGFjayIsIm9ialZhbHVlIiwic3JjVmFsdWUiLCJzdGFja2VkIiwiZ2V0IiwibmV3VmFsdWUiLCJ1bmRlZmluZWQiLCJpc0NvbW1vbiIsImlzQXJyIiwiaXNCdWZmIiwiaXNUeXBlZCIsInNldCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJfYmFzZU1lcmdlRGVlcC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXNzaWduTWVyZ2VWYWx1ZSA9IHJlcXVpcmUoJy4vX2Fzc2lnbk1lcmdlVmFsdWUnKSxcbiAgICBjbG9uZUJ1ZmZlciA9IHJlcXVpcmUoJy4vX2Nsb25lQnVmZmVyJyksXG4gICAgY2xvbmVUeXBlZEFycmF5ID0gcmVxdWlyZSgnLi9fY2xvbmVUeXBlZEFycmF5JyksXG4gICAgY29weUFycmF5ID0gcmVxdWlyZSgnLi9fY29weUFycmF5JyksXG4gICAgaW5pdENsb25lT2JqZWN0ID0gcmVxdWlyZSgnLi9faW5pdENsb25lT2JqZWN0JyksXG4gICAgaXNBcmd1bWVudHMgPSByZXF1aXJlKCcuL2lzQXJndW1lbnRzJyksXG4gICAgaXNBcnJheSA9IHJlcXVpcmUoJy4vaXNBcnJheScpLFxuICAgIGlzQXJyYXlMaWtlT2JqZWN0ID0gcmVxdWlyZSgnLi9pc0FycmF5TGlrZU9iamVjdCcpLFxuICAgIGlzQnVmZmVyID0gcmVxdWlyZSgnLi9pc0J1ZmZlcicpLFxuICAgIGlzRnVuY3Rpb24gPSByZXF1aXJlKCcuL2lzRnVuY3Rpb24nKSxcbiAgICBpc09iamVjdCA9IHJlcXVpcmUoJy4vaXNPYmplY3QnKSxcbiAgICBpc1BsYWluT2JqZWN0ID0gcmVxdWlyZSgnLi9pc1BsYWluT2JqZWN0JyksXG4gICAgaXNUeXBlZEFycmF5ID0gcmVxdWlyZSgnLi9pc1R5cGVkQXJyYXknKSxcbiAgICBzYWZlR2V0ID0gcmVxdWlyZSgnLi9fc2FmZUdldCcpLFxuICAgIHRvUGxhaW5PYmplY3QgPSByZXF1aXJlKCcuL3RvUGxhaW5PYmplY3QnKTtcblxuLyoqXG4gKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYGJhc2VNZXJnZWAgZm9yIGFycmF5cyBhbmQgb2JqZWN0cyB3aGljaCBwZXJmb3Jtc1xuICogZGVlcCBtZXJnZXMgYW5kIHRyYWNrcyB0cmF2ZXJzZWQgb2JqZWN0cyBlbmFibGluZyBvYmplY3RzIHdpdGggY2lyY3VsYXJcbiAqIHJlZmVyZW5jZXMgdG8gYmUgbWVyZ2VkLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBkZXN0aW5hdGlvbiBvYmplY3QuXG4gKiBAcGFyYW0ge09iamVjdH0gc291cmNlIFRoZSBzb3VyY2Ugb2JqZWN0LlxuICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBtZXJnZS5cbiAqIEBwYXJhbSB7bnVtYmVyfSBzcmNJbmRleCBUaGUgaW5kZXggb2YgYHNvdXJjZWAuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBtZXJnZUZ1bmMgVGhlIGZ1bmN0aW9uIHRvIG1lcmdlIHZhbHVlcy5cbiAqIEBwYXJhbSB7RnVuY3Rpb259IFtjdXN0b21pemVyXSBUaGUgZnVuY3Rpb24gdG8gY3VzdG9taXplIGFzc2lnbmVkIHZhbHVlcy5cbiAqIEBwYXJhbSB7T2JqZWN0fSBbc3RhY2tdIFRyYWNrcyB0cmF2ZXJzZWQgc291cmNlIHZhbHVlcyBhbmQgdGhlaXIgbWVyZ2VkXG4gKiAgY291bnRlcnBhcnRzLlxuICovXG5mdW5jdGlvbiBiYXNlTWVyZ2VEZWVwKG9iamVjdCwgc291cmNlLCBrZXksIHNyY0luZGV4LCBtZXJnZUZ1bmMsIGN1c3RvbWl6ZXIsIHN0YWNrKSB7XG4gIHZhciBvYmpWYWx1ZSA9IHNhZmVHZXQob2JqZWN0LCBrZXkpLFxuICAgICAgc3JjVmFsdWUgPSBzYWZlR2V0KHNvdXJjZSwga2V5KSxcbiAgICAgIHN0YWNrZWQgPSBzdGFjay5nZXQoc3JjVmFsdWUpO1xuXG4gIGlmIChzdGFja2VkKSB7XG4gICAgYXNzaWduTWVyZ2VWYWx1ZShvYmplY3QsIGtleSwgc3RhY2tlZCk7XG4gICAgcmV0dXJuO1xuICB9XG4gIHZhciBuZXdWYWx1ZSA9IGN1c3RvbWl6ZXJcbiAgICA/IGN1c3RvbWl6ZXIob2JqVmFsdWUsIHNyY1ZhbHVlLCAoa2V5ICsgJycpLCBvYmplY3QsIHNvdXJjZSwgc3RhY2spXG4gICAgOiB1bmRlZmluZWQ7XG5cbiAgdmFyIGlzQ29tbW9uID0gbmV3VmFsdWUgPT09IHVuZGVmaW5lZDtcblxuICBpZiAoaXNDb21tb24pIHtcbiAgICB2YXIgaXNBcnIgPSBpc0FycmF5KHNyY1ZhbHVlKSxcbiAgICAgICAgaXNCdWZmID0gIWlzQXJyICYmIGlzQnVmZmVyKHNyY1ZhbHVlKSxcbiAgICAgICAgaXNUeXBlZCA9ICFpc0FyciAmJiAhaXNCdWZmICYmIGlzVHlwZWRBcnJheShzcmNWYWx1ZSk7XG5cbiAgICBuZXdWYWx1ZSA9IHNyY1ZhbHVlO1xuICAgIGlmIChpc0FyciB8fCBpc0J1ZmYgfHwgaXNUeXBlZCkge1xuICAgICAgaWYgKGlzQXJyYXkob2JqVmFsdWUpKSB7XG4gICAgICAgIG5ld1ZhbHVlID0gb2JqVmFsdWU7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChpc0FycmF5TGlrZU9iamVjdChvYmpWYWx1ZSkpIHtcbiAgICAgICAgbmV3VmFsdWUgPSBjb3B5QXJyYXkob2JqVmFsdWUpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoaXNCdWZmKSB7XG4gICAgICAgIGlzQ29tbW9uID0gZmFsc2U7XG4gICAgICAgIG5ld1ZhbHVlID0gY2xvbmVCdWZmZXIoc3JjVmFsdWUsIHRydWUpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoaXNUeXBlZCkge1xuICAgICAgICBpc0NvbW1vbiA9IGZhbHNlO1xuICAgICAgICBuZXdWYWx1ZSA9IGNsb25lVHlwZWRBcnJheShzcmNWYWx1ZSwgdHJ1ZSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgbmV3VmFsdWUgPSBbXTtcbiAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoaXNQbGFpbk9iamVjdChzcmNWYWx1ZSkgfHwgaXNBcmd1bWVudHMoc3JjVmFsdWUpKSB7XG4gICAgICBuZXdWYWx1ZSA9IG9ialZhbHVlO1xuICAgICAgaWYgKGlzQXJndW1lbnRzKG9ialZhbHVlKSkge1xuICAgICAgICBuZXdWYWx1ZSA9IHRvUGxhaW5PYmplY3Qob2JqVmFsdWUpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoIWlzT2JqZWN0KG9ialZhbHVlKSB8fCBpc0Z1bmN0aW9uKG9ialZhbHVlKSkge1xuICAgICAgICBuZXdWYWx1ZSA9IGluaXRDbG9uZU9iamVjdChzcmNWYWx1ZSk7XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgaXNDb21tb24gPSBmYWxzZTtcbiAgICB9XG4gIH1cbiAgaWYgKGlzQ29tbW9uKSB7XG4gICAgLy8gUmVjdXJzaXZlbHkgbWVyZ2Ugb2JqZWN0cyBhbmQgYXJyYXlzIChzdXNjZXB0aWJsZSB0byBjYWxsIHN0YWNrIGxpbWl0cykuXG4gICAgc3RhY2suc2V0KHNyY1ZhbHVlLCBuZXdWYWx1ZSk7XG4gICAgbWVyZ2VGdW5jKG5ld1ZhbHVlLCBzcmNWYWx1ZSwgc3JjSW5kZXgsIGN1c3RvbWl6ZXIsIHN0YWNrKTtcbiAgICBzdGFja1snZGVsZXRlJ10oc3JjVmFsdWUpO1xuICB9XG4gIGFzc2lnbk1lcmdlVmFsdWUob2JqZWN0LCBrZXksIG5ld1ZhbHVlKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBiYXNlTWVyZ2VEZWVwO1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFJQSxnQkFBZ0IsR0FBR0MsT0FBTyxDQUFDLHFCQUFxQixDQUFDO0VBQ2pEQyxXQUFXLEdBQUdELE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztFQUN2Q0UsZUFBZSxHQUFHRixPQUFPLENBQUMsb0JBQW9CLENBQUM7RUFDL0NHLFNBQVMsR0FBR0gsT0FBTyxDQUFDLGNBQWMsQ0FBQztFQUNuQ0ksZUFBZSxHQUFHSixPQUFPLENBQUMsb0JBQW9CLENBQUM7RUFDL0NLLFdBQVcsR0FBR0wsT0FBTyxDQUFDLGVBQWUsQ0FBQztFQUN0Q00sT0FBTyxHQUFHTixPQUFPLENBQUMsV0FBVyxDQUFDO0VBQzlCTyxpQkFBaUIsR0FBR1AsT0FBTyxDQUFDLHFCQUFxQixDQUFDO0VBQ2xEUSxRQUFRLEdBQUdSLE9BQU8sQ0FBQyxZQUFZLENBQUM7RUFDaENTLFVBQVUsR0FBR1QsT0FBTyxDQUFDLGNBQWMsQ0FBQztFQUNwQ1UsUUFBUSxHQUFHVixPQUFPLENBQUMsWUFBWSxDQUFDO0VBQ2hDVyxhQUFhLEdBQUdYLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQztFQUMxQ1ksWUFBWSxHQUFHWixPQUFPLENBQUMsZ0JBQWdCLENBQUM7RUFDeENhLE9BQU8sR0FBR2IsT0FBTyxDQUFDLFlBQVksQ0FBQztFQUMvQmMsYUFBYSxHQUFHZCxPQUFPLENBQUMsaUJBQWlCLENBQUM7O0FBRTlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVNlLGFBQWFBLENBQUNDLE1BQU0sRUFBRUMsTUFBTSxFQUFFQyxHQUFHLEVBQUVDLFFBQVEsRUFBRUMsU0FBUyxFQUFFQyxVQUFVLEVBQUVDLEtBQUssRUFBRTtFQUNsRixJQUFJQyxRQUFRLEdBQUdWLE9BQU8sQ0FBQ0csTUFBTSxFQUFF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