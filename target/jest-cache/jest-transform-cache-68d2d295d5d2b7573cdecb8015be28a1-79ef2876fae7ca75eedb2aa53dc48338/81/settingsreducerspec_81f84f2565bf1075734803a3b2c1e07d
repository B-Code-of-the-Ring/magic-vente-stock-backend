d6d820600abf8ea24c6964fcaf9ab019
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const toolkit_1 = require("@reduxjs/toolkit");
const axios_1 = tslib_1.__importDefault(require("axios"));
const sinon_1 = tslib_1.__importDefault(require("sinon"));
const settings_reducer_1 = tslib_1.__importStar(require("./settings.reducer"));
describe('Settings reducer tests', () => {
    describe('Common tests', () => {
        it('should return the initial state', () => {
            const toTest = (0, settings_reducer_1.default)(undefined, { type: '' });
            expect(toTest).toMatchObject({
                loading: false,
                errorMessage: null,
                updateSuccess: false,
                updateFailure: false,
            });
        });
    });
    describe('Settings update', () => {
        it('should detect a request', () => {
            const toTest = (0, settings_reducer_1.default)(undefined, { type: settings_reducer_1.updateAccount.pending.type });
            expect(toTest).toMatchObject({
                updateSuccess: false,
                updateFailure: false,
                loading: true,
            });
        });
        it('should detect a success', () => {
            const toTest = (0, settings_reducer_1.default)(undefined, { type: settings_reducer_1.updateAccount.fulfilled.type });
            expect(toTest).toMatchObject({
                updateSuccess: true,
                updateFailure: false,
                loading: false,
            });
        });
        it('should detect a failure', () => {
            const toTest = (0, settings_reducer_1.default)(undefined, { type: settings_reducer_1.updateAccount.rejected.type });
            expect(toTest).toMatchObject({
                updateSuccess: false,
                updateFailure: true,
                loading: false,
            });
        });
        it('should reset the state', () => {
            const initialState = {
                loading: false,
                errorMessage: null,
                successMessage: null,
                updateSuccess: false,
                updateFailure: false,
            };
            expect((0, settings_reducer_1.default)(Object.assign(Object.assign({}, initialState), { loading: true }), (0, settings_reducer_1.reset)())).toEqual(Object.assign({}, initialState));
        });
    });
    describe('Actions', () => {
        let store;
        const resolvedObject = { value: 'whatever' };
        const getState = jest.fn();
        const dispatch = jest.fn();
        const extra = {};
        beforeEach(() => {
            store = (0, toolkit_1.configureStore)({
                reducer: (state = [], action) => [...state, action],
            });
            axios_1.default.get = sinon_1.default.stub().returns(Promise.resolve(resolvedObject));
            axios_1.default.post = sinon_1.default.stub().returns(Promise.resolve(resolvedObject));
        });
        it('dispatches UPDATE_ACCOUNT_PENDING and UPDATE_ACCOUNT_FULFILLED actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const arg = '';
            const result = yield (0, settings_reducer_1.updateAccount)(arg)(dispatch, getState, extra);
            const pendingAction = dispatch.mock.calls[0][0];
            expect(pendingAction.meta.requestStatus).toBe('pending');
            expect(settings_reducer_1.updateAccount.fulfilled.match(result)).toBe(true);
            expect(result.payload).toBe(resolvedObject);
        }));
        it('dispatches RESET actions', () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            yield store.dispatch((0, settings_reducer_1.reset)());
            expect(store.getState()).toEqual([expect.any(Object), expect.objectContaining((0, settings_reducer_1.reset)())]);
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3BjY28wNTYvRG9jdW1lbnRzL0NvdXJzIElUVS9yaWJvdWNob24vbWFnaWN2ZW50ZXN0b2NrL3NyYy9tYWluL3dlYmFwcC9hcHAvbW9kdWxlcy9hY2NvdW50L3NldHRpbmdzL3NldHRpbmdzLnJlZHVjZXIuc3BlYy50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSw4Q0FBa0Q7QUFDbEQsMERBQTBCO0FBQzFCLDBEQUEwQjtBQUUxQiwrRUFBbUU7QUFFbkUsUUFBUSxDQUFDLHdCQUF3QixFQUFFLEdBQUcsRUFBRTtJQUN0QyxRQUFRLENBQUMsY0FBYyxFQUFFLEdBQUcsRUFBRTtRQUM1QixFQUFFLENBQUMsaUNBQWlDLEVBQUUsR0FBRyxFQUFFO1lBQ3pDLE1BQU0sTUFBTSxHQUFHLElBQUEsMEJBQU8sRUFBQyxTQUFTLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUNoRCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsYUFBYSxDQUFDO2dCQUMzQixPQUFPLEVBQUUsS0FBSztnQkFDZCxZQUFZLEVBQUUsSUFBSTtnQkFDbEIsYUFBYSxFQUFFLEtBQUs7Z0JBQ3BCLGFBQWEsRUFBRSxLQUFLO2FBQ3JCLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFO1FBQy9CLEVBQUUsQ0FBQyx5QkFBeUIsRUFBRSxHQUFHLEVBQUU7WUFDakMsTUFBTSxNQUFNLEdBQUcsSUFBQSwwQkFBTyxFQUFDLFNBQVMsRUFBRSxFQUFFLElBQUksRUFBRSxnQ0FBYSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBQ3hFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxhQUFhLENBQUM7Z0JBQzNCLGFBQWEsRUFBRSxLQUFLO2dCQUNwQixhQUFhLEVBQUUsS0FBSztnQkFDcEIsT0FBTyxFQUFFLElBQUk7YUFDZCxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMs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QUFhLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDekQsTUFBTSxDQUFDLGdDQUFhLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN6RCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUM5QyxDQUFDLENBQUEsQ0FBQyxDQUFDO1FBQ0gsRUFBRSxDQUFDLDBCQUEwQixFQUFFLEdBQVMsRUFBRTtZQUN4QyxNQUFNLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBQSx3QkFBSyxHQUFFLENBQUMsQ0FBQztZQUM5QixNQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxNQUFNLENBQUMsZ0JBQWdCLENBQUMsSUFBQSx3QkFBSyxHQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDM0YsQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL3BjY28wNTYvRG9jdW1lbnRzL0NvdXJzIElUVS9yaWJvdWNob24vbWFnaWN2ZW50ZXN0b2NrL3NyYy9tYWluL3dlYmFwcC9hcHAvbW9kdWxlcy9hY2NvdW50L3NldHRpbmdzL3NldHRpbmdzLnJlZHVjZXIuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb25maWd1cmVTdG9yZSB9IGZyb20gJ0ByZWR1eGpzL3Rvb2xraXQnO1xuaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5cbmltcG9ydCBhY2NvdW50LCB7IHVwZGF0ZUFjY291bnQsIHJlc2V0IH0gZnJvbSAnLi9zZXR0aW5ncy5yZWR1Y2VyJztcblxuZGVzY3JpYmUoJ1NldHRpbmdzIHJlZHVjZXIgdGVzdHMnLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCdDb21tb24gdGVzdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdGhlIGluaXRpYWwgc3RhdGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCB0b1Rlc3QgPSBhY2NvdW50KHVuZGVmaW5lZCwgeyB0eXBlOiAnJyB9KTtcbiAgICAgIGV4cGVjdCh0b1Rlc3QpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgZXJyb3JNZXNzYWdlOiBudWxsLFxuICAgICAgICB1cGRhdGVTdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgdXBkYXRlRmFpbHVyZTogZmFsc2UsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NldHRpbmdzIHVwZGF0ZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGRldGVjdCBhIHJlcXVlc3QnLCAoKSA9PiB7XG4gICAgICBjb25zdCB0b1Rlc3QgPSBhY2NvdW50KHVuZGVmaW5lZCwgeyB0eXBlOiB1cGRhdGVBY2NvdW50LnBlbmRpbmcudHlwZSB9KTtcbiAgICAgIGV4cGVjdCh0b1Rlc3QpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICB1cGRhdGVTdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgdXBkYXRlRmFpbHVyZTogZmFsc2UsXG4gICAgICAgIGxvYWRpbmc6IHRydWUsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGRldGVjdCBhIHN1Y2Nlc3MnLCAoKSA9PiB7XG4gICAgICBjb25zdCB0b1Rlc3QgPSBhY2NvdW50KHVuZGVmaW5lZCwgeyB0eXBlOiB1cGRhdGVBY2NvdW50LmZ1bGZpbGxlZC50eXBlIH0pO1xuICAgICAgZXhwZWN0KHRvVGVzdCkudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIHVwZGF0ZVN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHVwZGF0ZUZhaWx1cmU6IGZhbHNlLFxuICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZGV0ZWN0IGEgZmFpbHVyZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHRvVGVzdCA9IGFjY291bnQodW5kZWZpbmVkLCB7IHR5cGU6IHVwZGF0ZUFjY291bnQucmVqZWN0ZWQudHlwZSB9KTtcbiAgICAgIGV4cGVjdCh0b1Rlc3QpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICB1cGRhdGVTdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgdXBkYXRlRmFpbHVyZTogdHJ1ZSxcbiAgICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVzZXQgdGhlIHN0YXRlJywgKCkgPT4ge1xuICAgICAgY29uc3QgaW5pdGlhbFN0YXRlID0ge1xuICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgZXJyb3JNZXNzYWdlOiBudWxsLFxuICAgICAgICBzdWNjZXNzTWVzc2FnZTogbnVsbCxcbiAgICAgICAgdXBkYXRlU3VjY2VzczogZmFsc2UsXG4gICAgICAgIHVwZGF0ZUZhaWx1cmU6IGZhbHNlLFxuICAgICAgfTtcbiAgICAgIGV4cGVjdChhY2NvdW50KHsgLi4uaW5pdGlhbFN0YXRlLCBsb2FkaW5nOiB0cnVlIH0sIHJlc2V0KCkpKS50b0VxdWFsKHtcbiAgICAgICAgLi4uaW5pdGlhbFN0YXRlLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBY3Rpb25zJywgKCkgPT4ge1xuICAgIGxldCBzdG9yZTtcblxuICAgIGNvbnN0IHJlc29sdmVkT2JqZWN0ID0geyB2YWx1ZTogJ3doYXRldmVyJyB9O1xuICAgIGNvbnN0IGdldFN0YXRlID0gamVzdC5mbigpO1xuICAgIGNvbnN0IGRpc3BhdGNoID0gamVzdC5mbigpO1xuICAgIGNvbnN0IGV4dHJhID0ge307XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBzdG9yZSA9IGNvbmZpZ3VyZVN0b3JlKHtcbiAgICAgICAgcmVkdWNlcjogKHN0YXRlID0gW10sIGFjdGlvbikgPT4gWy4uLnN0YXRlLCBhY3Rpb25dLFxuICAgICAgfSk7XG4gICAgICBheGlvcy5nZXQgPSBzaW5vbi5zdHViKCkucmV0dXJucyhQcm9taXNlLnJlc29sdmUocmVzb2x2ZWRPYmplY3QpKTtcbiAgICAgIGF4aW9zLnBvc3QgPSBzaW5vbi5zdHViKCkucmV0dXJucyhQcm9taXNlLnJlc29sdmUocmVzb2x2ZWRPYmplY3QpKTtcbiAgICB9KTtcblxuICAgIGl0KCdkaXNwYXRjaGVzIFVQREFURV9BQ0NPVU5UX1BFTkRJTkcgYW5kIFVQREFURV9BQ0NPVU5UX0ZVTEZJTExFRCBhY3Rpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYXJnID0gJyc7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVwZGF0ZUFjY291bnQoYXJnKShkaXNwYXRjaCwgZ2V0U3RhdGUsIGV4dHJhKTtcblxuICAgICAgY29uc3QgcGVuZGluZ0FjdGlvbiA9IGRpc3BhdGNoLm1vY2suY2FsbHNbMF1bMF07XG4gICAgICBleHBlY3QocGVuZGluZ0FjdGlvbi5tZXRhLnJlcXVlc3RTdGF0dXMpLnRvQmUoJ3BlbmRpbmcnKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVBY2NvdW50LmZ1bGZpbGxlZC5tYXRjaChyZXN1bHQpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5wYXlsb2FkKS50b0JlKHJlc29sdmVkT2JqZWN0KTtcbiAgICB9KTtcbiAgICBpdCgnZGlzcGF0Y2hlcyBSRVNFVCBhY3Rpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgc3RvcmUuZGlzcGF0Y2gocmVzZXQoKSk7XG4gICAgICBleHBlY3Qoc3RvcmUuZ2V0U3RhdGUoKSkudG9FcXVhbChbZXhwZWN0LmFueShPYmplY3QpLCBleHBlY3Qub2JqZWN0Q29udGFpbmluZyhyZXNldCgpKV0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9