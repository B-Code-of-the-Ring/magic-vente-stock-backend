2521b2105e8eb646095368ee112245db
'use strict';

let pico = require('picocolors');
let terminalHighlight = require('./terminal-highlight');
class CssSyntaxError extends Error {
  constructor(message, line, column, source, file, plugin) {
    super(message);
    this.name = 'CssSyntaxError';
    this.reason = message;
    if (file) {
      this.file = file;
    }
    if (source) {
      this.source = source;
    }
    if (plugin) {
      this.plugin = plugin;
    }
    if (typeof line !== 'undefined' && typeof column !== 'undefined') {
      if (typeof line === 'number') {
        this.line = line;
        this.column = column;
      } else {
        this.line = line.line;
        this.column = line.column;
        this.endLine = column.line;
        this.endColumn = column.column;
      }
    }
    this.setMessage();
    if (Error.captureStackTrace) {
      Error.captureStackTrace(this, CssSyntaxError);
    }
  }
  setMessage() {
    this.message = this.plugin ? this.plugin + ': ' : '';
    this.message += this.file ? this.file : '<css input>';
    if (typeof this.line !== 'undefined') {
      this.message += ':' + this.line + ':' + this.column;
    }
    this.message += ': ' + this.reason;
  }
  showSourceCode(color) {
    if (!this.source) return '';
    let css = this.source;
    if (color == null) color = pico.isColorSupported;
    if (terminalHighlight) {
      if (color) css = terminalHighlight(css);
    }
    let lines = css.split(/\r?\n/);
    let start = Math.max(this.line - 3, 0);
    let end = Math.min(this.line + 2, lines.length);
    let maxWidth = String(end).length;
    let mark, aside;
    if (color) {
      let {
        bold,
        gray,
        red
      } = pico.createColors(true);
      mark = text => bold(red(text));
      aside = text => gray(text);
    } else {
      mark = aside = str => str;
    }
    return lines.slice(start, end).map((line, index) => {
      let number = start + 1 + index;
      let gutter = ' ' + (' ' + number).slice(-maxWidth) + ' | ';
      if (number === this.line) {
        let spacing = aside(gutter.replace(/\d/g, ' ')) + line.slice(0, this.column - 1).replace(/[^\t]/g, ' ');
        return mark('>') + aside(gutter) + line + '\n ' + spacing + mark('^');
      }
      return ' ' + aside(gutter) + line;
    }).join('\n');
  }
  toString() {
    let code = this.showSourceCode();
    if (code) {
      code = '\n\n' + code + '\n';
    }
    return this.name + ': ' + this.message + code;
  }
}
module.exports = CssSyntaxError;
CssSyntaxError.default = CssSyntaxError;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJwaWNvIiwicmVxdWlyZSIsInRlcm1pbmFsSGlnaGxpZ2h0IiwiQ3NzU3ludGF4RXJyb3IiLCJFcnJvciIsImNvbnN0cnVjdG9yIiwibWVzc2FnZSIsImxpbmUiLCJjb2x1bW4iLCJzb3VyY2UiLCJmaWxlIiwicGx1Z2luIiwibmFtZSIsInJlYXNvbiIsImVuZExpbmUiLCJlbmRDb2x1bW4iLCJzZXRNZXNzYWdlIiwiY2FwdHVyZVN0YWNrVHJhY2UiLCJzaG93U291cmNlQ29kZSIsImNvbG9yIiwiY3NzIiwiaXNDb2xvclN1cHBvcnRlZCIsImxpbmVzIiwic3BsaXQiLCJzdGFydCIsIk1hdGgiLCJtYXgiLCJlbmQiLCJtaW4iLCJsZW5ndGgiLCJtYXhXaWR0aCIsIlN0cmluZyIsIm1hcmsiLCJhc2lkZSIsImJvbGQiLCJncmF5IiwicmVkIiwiY3JlYXRlQ29sb3JzIiwidGV4dCIsInN0ciIsInNsaWNlIiwibWFwIiwiaW5kZXgiLCJudW1iZXIiLCJndXR0ZXIiLCJzcGFjaW5nIiwicmVwbGFjZSIsImpvaW4iLCJ0b1N0cmluZyIsImNvZGUiLCJtb2R1bGUiLCJleHBvcnRzIiwiZGVmYXVsdCJdLCJzb3VyY2VzIjpbImNzcy1zeW50YXgtZXJyb3IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnXG5cbmxldCBwaWNvID0gcmVxdWlyZSgncGljb2NvbG9ycycpXG5cbmxldCB0ZXJtaW5hbEhpZ2hsaWdodCA9IHJlcXVpcmUoJy4vdGVybWluYWwtaGlnaGxpZ2h0JylcblxuY2xhc3MgQ3NzU3ludGF4RXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIGxpbmUsIGNvbHVtbiwgc291cmNlLCBmaWxlLCBwbHVnaW4pIHtcbiAgICBzdXBlcihtZXNzYWdlKVxuICAgIHRoaXMubmFtZSA9ICdDc3NTeW50YXhFcnJvcidcbiAgICB0aGlzLnJlYXNvbiA9IG1lc3NhZ2VcblxuICAgIGlmIChmaWxlKSB7XG4gICAgICB0aGlzLmZpbGUgPSBmaWxlXG4gICAgfVxuICAgIGlmIChzb3VyY2UpIHtcbiAgICAgIHRoaXMuc291cmNlID0gc291cmNlXG4gICAgfVxuICAgIGlmIChwbHVnaW4pIHtcbiAgICAgIHRoaXMucGx1Z2luID0gcGx1Z2luXG4gICAgfVxuICAgIGlmICh0eXBlb2YgbGluZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIGNvbHVtbiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIGlmICh0eXBlb2YgbGluZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgdGhpcy5saW5lID0gbGluZVxuICAgICAgICB0aGlzLmNvbHVtbiA9IGNvbHVtblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5saW5lID0gbGluZS5saW5lXG4gICAgICAgIHRoaXMuY29sdW1uID0gbGluZS5jb2x1bW5cbiAgICAgICAgdGhpcy5lbmRMaW5lID0gY29sdW1uLmxpbmVcbiAgICAgICAgdGhpcy5lbmRDb2x1bW4gPSBjb2x1bW4uY29sdW1uXG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5zZXRNZXNzYWdlKClcblxuICAgIGlmIChFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSkge1xuICAgICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgQ3NzU3ludGF4RXJyb3IpXG4gICAgfVxuICB9XG5cbiAgc2V0TWVzc2FnZSgpIHtcbiAgICB0aGlzLm1lc3NhZ2UgPSB0aGlzLnBsdWdpbiA/IHRoaXMucGx1Z2luICsgJzogJyA6ICcnXG4gICAgdGhpcy5tZXNzYWdlICs9IHRoaXMuZmlsZSA/IHRoaXMuZmlsZSA6ICc8Y3NzIGlucHV0PidcbiAgICBpZiAodHlwZW9mIHRoaXMubGluZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHRoaXMubWVzc2FnZSArPSAnOicgKyB0aGlzLmxpbmUgKyAnOicgKyB0aGlzLmNvbHVtblxuICAgIH1cbiAgICB0aGlzLm1lc3NhZ2UgKz0gJzogJyArIHRoaXMucmVhc29uXG4gIH1cblxuICBzaG93U291cmNlQ29kZShjb2xvcikge1xuICAgIGlmICghdGhpcy5zb3VyY2UpIHJldHVybiAnJ1xuXG4gICAgbGV0IGNzcyA9IHRoaXMuc291cmNlXG4gICAgaWYgKGNvbG9yID09IG51bGwpIGNvbG9yID0gcGljby5pc0NvbG9yU3VwcG9ydGVkXG4gICAgaWYgKHRlcm1pbmFsSGlnaGxpZ2h0KSB7XG4gICAgICBpZiAoY29sb3IpIGNzcyA9IHRlcm1pbmFsSGlnaGxpZ2h0KGNzcylcbiAgICB9XG5cbiAgICBsZXQgbGluZXMgPSBjc3Muc3BsaXQoL1xccj9cXG4vKVxuICAgIGxldCBzdGFydCA9IE1hdGgubWF4KHRoaXMubGluZSAtIDMsIDApXG4gICAgbGV0IGVuZCA9IE1hdGgubWluKHRoaXMubGluZSArIDIsIGxpbmVzLmxlbmd0aClcblxuICAgIGxldCBtYXhXaWR0aCA9IFN0cmluZyhlbmQpLmxlbmd0aFxuXG4gICAgbGV0IG1hcmssIGFzaWRlXG4gICAgaWYgKGNvbG9yKSB7XG4gICAgICBsZXQgeyBib2xkLCBncmF5LCByZWQgfSA9IHBpY28uY3JlYXRlQ29sb3JzKHRydWUpXG4gICAgICBtYXJrID0gdGV4dCA9PiBib2xkKHJlZCh0ZXh0KSlcbiAgICAgIGFzaWRlID0gdGV4dCA9PiBncmF5KHRleHQpXG4gICAgfSBlbHNlIHtcbiAgICAgIG1hcmsgPSBhc2lkZSA9IHN0ciA9PiBzdHJcbiAgICB9XG5cbiAgICByZXR1cm4gbGluZXNcbiAgICAgIC5zbGljZShzdGFydCwgZW5kKVxuICAgICAgLm1hcCgobGluZSwgaW5kZXgpID0+IHtcbiAgICAgICAgbGV0IG51bWJlciA9IHN0YXJ0ICsgMSArIGluZGV4XG4gICAgICAgIGxldCBndXR0ZXIgPSAnICcgKyAoJyAnICsgbnVtYmVyKS5zbGljZSgtbWF4V2lkdGgpICsgJyB8ICdcbiAgICAgICAgaWYgKG51bWJlciA9PT0gdGhpcy5saW5lKSB7XG4gICAgICAgICAgbGV0IHNwYWNpbmcgPVxuICAgICAgICAgICAgYXNpZGUoZ3V0dGVyLnJlcGxhY2UoL1xcZC9nLCAnICcpKSArXG4gICAgICAgICAgICBsaW5lLnNsaWNlKDAsIHRoaXMuY29sdW1uIC0gMSkucmVwbGFjZSgvW15cXHRdL2csICcgJylcbiAgICAgICAgICByZXR1cm4gbWFyaygnPicpICsgYXNpZGUoZ3V0dGVyKSArIGxpbmUgKyAnXFxuICcgKyBzcGFjaW5nICsgbWFyaygnXicpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICcgJyArIGFzaWRlKGd1dHRlcikgKyBsaW5lXG4gICAgICB9KVxuICAgICAgLmpvaW4oJ1xcbicpXG4gIH1cblxuICB0b1N0cmluZygpIHtcbiAgICBsZXQgY29kZSA9IHRoaXMuc2hvd1NvdXJjZUNvZGUoKVxuICAgIGlmIChjb2RlKSB7XG4gICAgICBjb2RlID0gJ1xcblxcbicgKyBjb2RlICsgJ1xcbidcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMubmFtZSArICc6ICcgKyB0aGlzLm1lc3NhZ2UgKyBjb2RlXG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBDc3NTeW50YXhFcnJvclxuQ3NzU3ludGF4RXJyb3IuZGVmYXVsdCA9IENzc1N5bnRheEVycm9yXG4iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7O0FBRVosSUFBSUEsSUFBSSxHQUFHQyxPQUFPLENBQUMsWUFBWSxDQUFDO0FBRWhDLElBQUlDLGlCQUFpQixHQUFHRCxPQUFPLENBQUMsc0JBQXNCLENBQUM7QUFFdkQsTUFBTUUsY0FBYyxTQUFTQyxLQUFLLENBQUM7RUFDakNDLFdBQVdBLENBQUNDLE9BQU8sRUFBRUMsSUFBSSxFQUFFQyxNQUFNLEVBQUVDLE1BQU0sRUFBRUMsSUFBSSxFQUFFQyxNQUFNLEVBQUU7SUFDdkQsS0FBSyxDQUFDTCxPQUFPLENBQUM7SUFDZCxJQUFJLENBQUNNLElBQUksR0FBRyxnQkFBZ0I7SUFDNUIsSUFBSSxDQUFDQyxNQUFNLEdBQUdQLE9BQU87SUFFckIsSUFBSUksSUFBSSxFQUFFO01BQ1IsSUFBSSxDQUFDQSxJQUFJLEdBQUdBLElBQUk7SUFDbEI7SUFD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NUIsQ0FBQyxNQUFNO01BQ0xOLElBQUksR0FBR0MsS0FBSyxHQUFHTSxHQUFHLElBQUlBLEdBQUc7SUFDM0I7SUFFQSxPQUFPakIsS0FBSyxDQUNUa0IsS0FBSyxDQUFDaEIsS0FBSyxFQUFFRyxHQUFHLENBQUMsQ0FDakJjLEdBQUcsQ0FBQyxDQUFDbEMsSUFBSSxFQUFFbUMsS0FBSyxLQUFLO01BQ3BCLElBQUlDLE1BQU0sR0FBR25CLEtBQUssR0FBRyxDQUFDLEdBQUdrQixLQUFLO01BQzlCLElBQUlFLE1BQU0sR0FBRyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUdELE1BQU0sRUFBRUgsS0FBSyxDQUFDLENBQUNWLFFBQVEsQ0FBQyxHQUFHLEtBQUs7TUFDMUQsSUFBSWEsTUFBTSxLQUFLLElBQUksQ0FBQ3BDLElBQUksRUFBRTtRQUN4QixJQUFJc0MsT0FBTyxHQUNUWixLQUFLLENBQUNXLE1BQU0sQ0FBQ0UsT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQyxHQUNqQ3ZDLElBQUksQ0FBQ2lDLEtBQUssQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDaEMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDc0MsT0FBTyxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUM7UUFDdkQsT0FBT2QsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHQyxLQUFLLENBQUNXLE1BQU0sQ0FBQyxHQUFHckMsSUFBSSxHQUFHLEtBQUssR0FBR3NDLE9BQU8sR0FBR2IsSUFBSSxDQUFDLEdBQUcsQ0FBQztNQUN2RTtNQUNBLE9BQU8sR0FBRyxHQUFHQyxLQUFLLENBQUNXLE1BQU0sQ0FBQyxHQUFHckMsSUFBSTtJQUNuQyxDQUFDLENBQUMsQ0FDRHdDLElBQUksQ0FBQyxJQUFJLENBQUM7RUFDZjtFQUVBQyxRQUFRQSxDQUFBLEVBQUc7SUFDVCxJQUFJQyxJQUFJLEdBQUcsSUFBSSxDQUFDL0IsY0FBYyxDQUFDLENBQUM7SUFDaEMsSUFBSStCLElBQUksRUFBRTtNQUNSQSxJQUFJLEdBQUcsTUFBTSxHQUFHQSxJQUFJLEdBQUcsSUFBSTtJQUM3QjtJQUNBLE9BQU8sSUFBSSxDQUFDckMsSUFBSSxHQUFHLElBQUksR0FBRyxJQUFJLENBQUNOLE9BQU8sR0FBRzJDLElBQUk7RUFDL0M7QUFDRjtBQUVBQyxNQUFNLENBQUNDLE9BQU8sR0FBR2hELGNBQWM7QUFDL0JBLGNBQWMsQ0FBQ2lELE9BQU8sR0FBR2pELGNBQWMiLCJpZ25vcmVMaXN0IjpbXX0=